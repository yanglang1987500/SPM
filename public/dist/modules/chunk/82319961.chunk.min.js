webpackJsonp([1,3],{

/***/ 112:
/***/ function(module, exports) {

	/**
	 * git do not control webim.config.js
	 * everyone should copy webim.config.js.demo to webim.config.js
	 * and have their own configs.
	 * In this way , others won't be influenced by this config while git pull.
	 *
	 */
	var WebIM = window.WebIM = {};
	WebIM.config = {
	    /*
	     * XMPP server
	     */
	    xmppURL: 'im-api.easemob.com',
	    /*
	     * Backend REST API URL
	     */
	    apiURL: (location.protocol === 'https:' ? 'https:' : 'http:') + '//a1.easemob.com',
	    /*
	     * Application AppKey
	     */
	    appkey: '1112161208178849#spmchat',
	    /*
	     * Whether to use wss
	     * @parameter {Boolean} true or false
	     */
	    https: false,
	    /*
	     * isMultiLoginSessions
	     * true: A visitor can sign in to multiple webpages and receive messages at all the webpages.
	     * false: A visitor can sign in to only one webpage and receive messages at the webpage.
	     */
	    isMultiLoginSessions: true,
	    /*
	     * Set to auto sign-in
	     */
	    isAutoLogin: true,
	    /**
	     * Whether to use window.doQuery()
	     * @parameter {Boolean} true or false
	     */
	    isWindowSDK: false,
	    /**
	     * isSandBox=true:  xmppURL: 'im-api.sandbox.easemob.com',  apiURL: '//a1.sdb.easemob.com',
	     * isSandBox=false: xmppURL: 'im-api.easemob.com',          apiURL: '//a1.easemob.com',
	     * @parameter {Boolean} true or false
	     */
	    isSandBox: false,
	    /**
	     * Whether to console.log in strophe.log()
	     * @parameter {Boolean} true or false
	     */
	    isDebug: false,
	    /**
	     * will auto connect the xmpp server autoReconnectNumMax times in background when client is offline.
	     * won't auto connect if autoReconnectNumMax=0.
	     */
	    autoReconnectNumMax: 2,
	    /**
	     * the interval secons between each atuo reconnectting.
	     * works only if autoReconnectMaxNum >= 2.
	     */
	    autoReconnectInterval: 2,
	    /**
	     * webrtc supports WebKit and https only
	     */
	    isWebRTC: /WebKit/.test(navigator.userAgent) && /^https\:$/.test(window.location.protocol),
	    /**
	     * while http access,use ip directly,instead of ServerName,avoiding DNS problem.
	     */
	    isHttpDNS: false
	};


/***/ },

/***/ 113:
/***/ function(module, exports, __webpack_require__) {

	var __WEBPACK_LOCAL_MODULE_0__;var __WEBPACK_LOCAL_MODULE_1__;var __WEBPACK_LOCAL_MODULE_2__;var __WEBPACK_LOCAL_MODULE_3__;var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_LOCAL_MODULE_4__;var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_LOCAL_MODULE_5__;var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_LOCAL_MODULE_6__;var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_LOCAL_MODULE_7__;var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_LOCAL_MODULE_8__;/*! strophe.js v1.2.8 - built on 16-09-2016 */
	!function(a){if(function(a,b){ true?!(__WEBPACK_LOCAL_MODULE_0__ = function(){return b()}.call(exports, __webpack_require__, exports, module)):a.Base64=b()}(this,function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b={encode:function(b){var c,d,e,f,g,h,i,j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?(g=(3&c)<<4,h=i=64):isNaN(e)&&(i=64),j=j+a.charAt(f)+a.charAt(g)+a.charAt(h)+a.charAt(i);while(k<b.length);return j},decode:function(b){var c,d,e,f,g,h,i,j="",k=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),h=a.indexOf(b.charAt(k++)),i=a.indexOf(b.charAt(k++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(c),64!=h&&(j+=String.fromCharCode(d)),64!=i&&(j+=String.fromCharCode(e));while(k<b.length);return j}};return b}),function(a,b){ true?!(__WEBPACK_LOCAL_MODULE_1__ = function(){return b()}.call(exports, __webpack_require__, exports, module)):a.SHA1=b()}(this,function(){function a(a,d){a[d>>5]|=128<<24-d%32,a[(d+64>>9<<4)+15]=d;var g,h,i,j,k,l,m,n,o=new Array(80),p=1732584193,q=-271733879,r=-1732584194,s=271733878,t=-1009589776;for(g=0;g<a.length;g+=16){for(j=p,k=q,l=r,m=s,n=t,h=0;80>h;h++)16>h?o[h]=a[g+h]:o[h]=f(o[h-3]^o[h-8]^o[h-14]^o[h-16],1),i=e(e(f(p,5),b(h,q,r,s)),e(e(t,o[h]),c(h))),t=s,s=r,r=f(q,30),q=p,p=i;p=e(p,j),q=e(q,k),r=e(r,l),s=e(s,m),t=e(t,n)}return[p,q,r,s,t]}function b(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function c(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function d(b,c){var d=g(b);d.length>16&&(d=a(d,8*b.length));for(var e=new Array(16),f=new Array(16),h=0;16>h;h++)e[h]=909522486^d[h],f[h]=1549556828^d[h];var i=a(e.concat(g(c)),512+8*c.length);return a(f.concat(i),672)}function e(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function f(a,b){return a<<b|a>>>32-b}function g(a){for(var b=[],c=255,d=0;d<8*a.length;d+=8)b[d>>5]|=(a.charCodeAt(d/8)&c)<<24-d%32;return b}function h(a){for(var b="",c=255,d=0;d<32*a.length;d+=8)b+=String.fromCharCode(a[d>>5]>>>24-d%32&c);return b}function i(a){for(var b,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e="",f=0;f<4*a.length;f+=3)for(b=(a[f>>2]>>8*(3-f%4)&255)<<16|(a[f+1>>2]>>8*(3-(f+1)%4)&255)<<8|a[f+2>>2]>>8*(3-(f+2)%4)&255,c=0;4>c;c++)e+=8*f+6*c>32*a.length?"=":d.charAt(b>>6*(3-c)&63);return e}return{b64_hmac_sha1:function(a,b){return i(d(a,b))},b64_sha1:function(b){return i(a(g(b),8*b.length))},binb2str:h,core_hmac_sha1:d,str_hmac_sha1:function(a,b){return h(d(a,b))},str_sha1:function(b){return h(a(g(b),8*b.length))}}}),function(a,b){ true?!(__WEBPACK_LOCAL_MODULE_2__ = function(){return b()}.call(exports, __webpack_require__, exports, module)):a.MD5=b()}(this,function(a){var b=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},c=function(a,b){return a<<b|a>>>32-b},d=function(a){for(var b=[],c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b},e=function(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b},f=function(a){for(var b="0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15);return c},g=function(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)},h=function(a,b,c,d,e,f,h){return g(b&c|~b&d,a,b,e,f,h)},i=function(a,b,c,d,e,f,h){return g(b&d|c&~d,a,b,e,f,h)},j=function(a,b,c,d,e,f,h){return g(b^c^d,a,b,e,f,h)},k=function(a,b,c,d,e,f,h){return g(c^(b|~d),a,b,e,f,h)},l=function(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;for(var d,e,f,g,l=1732584193,m=-271733879,n=-1732584194,o=271733878,p=0;p<a.length;p+=16)d=l,e=m,f=n,g=o,l=h(l,m,n,o,a[p+0],7,-680876936),o=h(o,l,m,n,a[p+1],12,-389564586),n=h(n,o,l,m,a[p+2],17,606105819),m=h(m,n,o,l,a[p+3],22,-1044525330),l=h(l,m,n,o,a[p+4],7,-176418897),o=h(o,l,m,n,a[p+5],12,1200080426),n=h(n,o,l,m,a[p+6],17,-1473231341),m=h(m,n,o,l,a[p+7],22,-45705983),l=h(l,m,n,o,a[p+8],7,1770035416),o=h(o,l,m,n,a[p+9],12,-1958414417),n=h(n,o,l,m,a[p+10],17,-42063),m=h(m,n,o,l,a[p+11],22,-1990404162),l=h(l,m,n,o,a[p+12],7,1804603682),o=h(o,l,m,n,a[p+13],12,-40341101),n=h(n,o,l,m,a[p+14],17,-1502002290),m=h(m,n,o,l,a[p+15],22,1236535329),l=i(l,m,n,o,a[p+1],5,-165796510),o=i(o,l,m,n,a[p+6],9,-1069501632),n=i(n,o,l,m,a[p+11],14,643717713),m=i(m,n,o,l,a[p+0],20,-373897302),l=i(l,m,n,o,a[p+5],5,-701558691),o=i(o,l,m,n,a[p+10],9,38016083),n=i(n,o,l,m,a[p+15],14,-660478335),m=i(m,n,o,l,a[p+4],20,-405537848),l=i(l,m,n,o,a[p+9],5,568446438),o=i(o,l,m,n,a[p+14],9,-1019803690),n=i(n,o,l,m,a[p+3],14,-187363961),m=i(m,n,o,l,a[p+8],20,1163531501),l=i(l,m,n,o,a[p+13],5,-1444681467),o=i(o,l,m,n,a[p+2],9,-51403784),n=i(n,o,l,m,a[p+7],14,1735328473),m=i(m,n,o,l,a[p+12],20,-1926607734),l=j(l,m,n,o,a[p+5],4,-378558),o=j(o,l,m,n,a[p+8],11,-2022574463),n=j(n,o,l,m,a[p+11],16,1839030562),m=j(m,n,o,l,a[p+14],23,-35309556),l=j(l,m,n,o,a[p+1],4,-1530992060),o=j(o,l,m,n,a[p+4],11,1272893353),n=j(n,o,l,m,a[p+7],16,-155497632),m=j(m,n,o,l,a[p+10],23,-1094730640),l=j(l,m,n,o,a[p+13],4,681279174),o=j(o,l,m,n,a[p+0],11,-358537222),n=j(n,o,l,m,a[p+3],16,-722521979),m=j(m,n,o,l,a[p+6],23,76029189),l=j(l,m,n,o,a[p+9],4,-640364487),o=j(o,l,m,n,a[p+12],11,-421815835),n=j(n,o,l,m,a[p+15],16,530742520),m=j(m,n,o,l,a[p+2],23,-995338651),l=k(l,m,n,o,a[p+0],6,-198630844),o=k(o,l,m,n,a[p+7],10,1126891415),n=k(n,o,l,m,a[p+14],15,-1416354905),m=k(m,n,o,l,a[p+5],21,-57434055),l=k(l,m,n,o,a[p+12],6,1700485571),o=k(o,l,m,n,a[p+3],10,-1894986606),n=k(n,o,l,m,a[p+10],15,-1051523),m=k(m,n,o,l,a[p+1],21,-2054922799),l=k(l,m,n,o,a[p+8],6,1873313359),o=k(o,l,m,n,a[p+15],10,-30611744),n=k(n,o,l,m,a[p+6],15,-1560198380),m=k(m,n,o,l,a[p+13],21,1309151649),l=k(l,m,n,o,a[p+4],6,-145523070),o=k(o,l,m,n,a[p+11],10,-1120210379),n=k(n,o,l,m,a[p+2],15,718787259),m=k(m,n,o,l,a[p+9],21,-343485551),l=b(l,d),m=b(m,e),n=b(n,f),o=b(o,g);return[l,m,n,o]},m={hexdigest:function(a){return f(l(d(a),8*a.length))},hash:function(a){return e(l(d(a),8*a.length))}};return m}),function(a,b){ true?!(__WEBPACK_LOCAL_MODULE_3__ = function(){return b()}.call(exports, __webpack_require__, exports, module)):a.stropheUtils=b()}(this,function(){var a={utf16to8:function(a){var b,c,d="",e=a.length;for(b=0;e>b;b++)c=a.charCodeAt(b),c>=0&&127>=c?d+=a.charAt(b):c>2047?(d+=String.fromCharCode(224|c>>12&15),d+=String.fromCharCode(128|c>>6&63),d+=String.fromCharCode(128|c>>0&63)):(d+=String.fromCharCode(192|c>>6&31),d+=String.fromCharCode(128|c>>0&63));return d},addCookies:function(a){var b,c,d,e,f,g,h;for(b in a||{})f="",g="",h="",c=a[b],d="object"==typeof c,e=escape(unescape(d?c.value:c)),d&&(f=c.expires?";expires="+c.expires:"",g=c.domain?";domain="+c.domain:"",h=c.path?";path="+c.path:""),document.cookie=b+"="+e+f+g+h}};return a}),function(a,b){return true?void !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_LOCAL_MODULE_4__ = (function(){return b()}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__))):b()}(this,function(){Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=Array.prototype.concat,e=c.call(arguments,1);return function(){return b.apply(a?a:this,d.call(e,c.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1})}),function(a,b){if(true)!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__WEBPACK_LOCAL_MODULE_1__,__WEBPACK_LOCAL_MODULE_0__,__WEBPACK_LOCAL_MODULE_2__,__WEBPACK_LOCAL_MODULE_3__,__WEBPACK_LOCAL_MODULE_4__], __WEBPACK_LOCAL_MODULE_5__ = (function(){return b.apply(this,arguments)}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)));else{var c=b(a.SHA1,a.Base64,a.MD5,a.stropheUtils);window.Strophe=c.Strophe,window.$build=c.$build,window.$iq=c.$iq,window.$msg=c.$msg,window.$pres=c.$pres,window.SHA1=c.SHA1,window.Base64=c.Base64,window.MD5=c.MD5,window.b64_hmac_sha1=c.SHA1.b64_hmac_sha1,window.b64_sha1=c.SHA1.b64_sha1,window.str_hmac_sha1=c.SHA1.str_hmac_sha1,window.str_sha1=c.SHA1.str_sha1}}(this,function(a,b,c,d){function e(a,b){return new i.Builder(a,b)}function f(a){return new i.Builder("message",a)}function g(a){return new i.Builder("iq",a)}function h(a){return new i.Builder("presence",a)}var i;return i={VERSION:"1.2.8",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(a){for(var b=0;b<i.XHTML.tags.length;b++)if(a==i.XHTML.tags[b])return!0;return!1},validAttribute:function(a,b){if("undefined"!=typeof i.XHTML.attributes[a]&&i.XHTML.attributes[a].length>0)for(var c=0;c<i.XHTML.attributes[a].length;c++)if(b==i.XHTML.attributes[a][c])return!0;return!1},validCSS:function(a){for(var b=0;b<i.XHTML.css.length;b++)if(a==i.XHTML.css[b])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(a,b){i.NS[a]=b},forEachChild:function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++)e=a.childNodes[d],e.nodeType!=i.ElementType.NORMAL||b&&!this.isTagEqual(e,b)||c(e)},isTagEqual:function(a,b){return a.tagName==b},_xmlGenerator:null,_makeGenerator:function(){var a;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(a=this._getIEXmlDom(),a.appendChild(a.createElement("strophe"))):a=document.implementation.createDocument("jabber:client","strophe",null),a},xmlGenerator:function(){return i._xmlGenerator||(i._xmlGenerator=i._makeGenerator()),i._xmlGenerator},_getIEXmlDom:function(){for(var a=null,b=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],c=0;c<b.length&&null===a;c++)try{a=new ActiveXObject(b[c])}catch(d){a=null}return a},xmlElement:function(a){if(!a)return null;var b,c,d,e=i.xmlGenerator().createElement(a);for(b=1;b<arguments.length;b++){var f=arguments[b];if(f)if("string"==typeof f||"number"==typeof f)e.appendChild(i.xmlTextNode(f));else if("object"==typeof f&&"function"==typeof f.sort)for(c=0;c<f.length;c++){var g=f[c];"object"==typeof g&&"function"==typeof g.sort&&void 0!==g[1]&&null!==g[1]&&e.setAttribute(g[0],g[1])}else if("object"==typeof f)for(d in f)f.hasOwnProperty(d)&&void 0!==f[d]&&null!==f[d]&&e.setAttribute(d,f[d])}return e},xmlescape:function(a){return a=a.replace(/\&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/"/g,"&quot;")},xmlunescape:function(a){return a=a.replace(/\&amp;/g,"&"),a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">"),a=a.replace(/&apos;/g,"'"),a=a.replace(/&quot;/g,'"')},xmlTextNode:function(a){return i.xmlGenerator().createTextNode(a)},xmlHtmlNode:function(a){var b;if(window.DOMParser){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},getText:function(a){if(!a)return null;var b="";0===a.childNodes.length&&a.nodeType==i.ElementType.TEXT&&(b+=a.nodeValue);for(var c=0;c<a.childNodes.length;c++)a.childNodes[c].nodeType==i.ElementType.TEXT&&(b+=a.childNodes[c].nodeValue);return i.xmlescape(b)},copyElement:function(a){var b,c;if(a.nodeType==i.ElementType.NORMAL){for(c=i.xmlElement(a.tagName),b=0;b<a.attributes.length;b++)c.setAttribute(a.attributes[b].nodeName,a.attributes[b].value);for(b=0;b<a.childNodes.length;b++)c.appendChild(i.copyElement(a.childNodes[b]))}else a.nodeType==i.ElementType.TEXT&&(c=i.xmlGenerator().createTextNode(a.nodeValue));return c},createHtml:function(a){var b,c,d,e,f,g,h,j,k,l,m;if(a.nodeType==i.ElementType.NORMAL)if(e=a.nodeName.toLowerCase(),i.XHTML.validTag(e))try{for(c=i.xmlElement(e),b=0;b<i.XHTML.attributes[e].length;b++)if(f=i.XHTML.attributes[e][b],g=a.getAttribute(f),"undefined"!=typeof g&&null!==g&&""!==g&&g!==!1&&0!==g)if("style"==f&&"object"==typeof g&&"undefined"!=typeof g.cssText&&(g=g.cssText),"style"==f){for(h=[],j=g.split(";"),d=0;d<j.length;d++)k=j[d].split(":"),l=k[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),i.XHTML.validCSS(l)&&(m=k[1].replace(/^\s*/,"").replace(/\s*$/,""),h.push(l+": "+m));h.length>0&&(g=h.join("; "),c.setAttribute(f,g))}else c.setAttribute(f,g);for(b=0;b<a.childNodes.length;b++)c.appendChild(i.createHtml(a.childNodes[b]))}catch(n){c=i.xmlTextNode("")}else for(c=i.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(i.createHtml(a.childNodes[b]));else if(a.nodeType==i.ElementType.FRAGMENT)for(c=i.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(i.createHtml(a.childNodes[b]));else a.nodeType==i.ElementType.TEXT&&(c=i.xmlTextNode(a.nodeValue));return c},escapeNode:function(a){return"string"!=typeof a?a:a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return"string"!=typeof a?a:a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return a.indexOf("@")<0?null:a.split("@")[0]},getDomainFromJid:function(a){var b=i.getBareJidFromJid(a);if(b.indexOf("@")<0)return b;var c=b.split("@");return c.splice(0,1),c.join("@")},getResourceFromJid:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),b.join("/"))},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(a,b){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;"function"==typeof a.tree&&(a=a.tree());var c,d,e=a.nodeName;for(a.getAttribute("_realname")&&(e=a.getAttribute("_realname")),b="<"+e,c=0;c<a.attributes.length;c++)"_realname"!=a.attributes[c].nodeName&&(b+=" "+a.attributes[c].nodeName+"='"+i.xmlescape(a.attributes[c].value)+"'");if(a.childNodes.length>0){for(b+=">",c=0;c<a.childNodes.length;c++)switch(d=a.childNodes[c],d.nodeType){case i.ElementType.NORMAL:b+=i.serialize(d);break;case i.ElementType.TEXT:b+=i.xmlescape(d.nodeValue);break;case i.ElementType.CDATA:b+="<![CDATA["+d.nodeValue+"]]>"}b+="</"+e+">"}else b+="/>";return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){i._connectionPlugins[a]=b}},i.Builder=function(a,b){("presence"==a||"message"==a||"iq"==a)&&(b&&!b.xmlns?b.xmlns=i.NS.CLIENT:b||(b={xmlns:i.NS.CLIENT})),this.nodeTree=i.xmlElement(a,b),this.node=this.nodeTree},i.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return i.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&(void 0===a[b]?this.node.removeAttribute(b):this.node.setAttribute(b,a[b]));return this},c:function(a,b,c){var d=i.xmlElement(a,b,c);return this.node.appendChild(d),"string"!=typeof c&&"number"!=typeof c&&(this.node=d),this},cnode:function(a){var b,c=i.xmlGenerator();try{b=void 0!==c.importNode}catch(d){b=!1}var e=b?c.importNode(a,!0):i.copyElement(a);return this.node.appendChild(e),this.node=e,this},t:function(a){var b=i.xmlTextNode(a);return this.node.appendChild(b),this},h:function(a){var b=document.createElement("body");b.innerHTML=a;for(var c=i.createHtml(b);c.childNodes.length>0;)this.node.appendChild(c.childNodes[0]);return this}},i.Handler=function(a,b,c,d,e,f,g){this.handler=a,this.ns=b,this.name=c,this.type=d,this.id=e,this.options=g||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=f?i.getBareJidFromJid(f):null:this.from=f,this.user=!0},i.Handler.prototype={isMatch:function(a){var b,c=null;if(c=this.options.matchBare?i.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from"),b=!1,this.ns){var d=this;i.forEachChild(a,null,function(a){a.getAttribute("xmlns")==d.ns&&(b=!0)}),b=b||a.getAttribute("xmlns")==this.ns}else b=!0;var e=a.getAttribute("type");return!b||this.name&&!i.isTagEqual(a,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(e):e!=this.type)||this.id&&a.getAttribute("id")!=this.id||this.from&&c!=this.from?!1:!0},run:function(a){var b=null;try{b=this.handler(a)}catch(c){throw c.sourceURL?i.fatal("error: "+this.handler+" "+c.sourceURL+":"+c.line+" - "+c.name+": "+c.message):c.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",c,c.message)),i.fatal("error: "+this.handler+" "+c.fileName+":"+c.lineNumber+" - "+c.name+": "+c.message)):i.fatal("error: "+c.message+"\n"+c.stack),c}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},i.TimedHandler=function(a,b){this.period=a,this.handler=b,this.lastCalled=(new Date).getTime(),this.user=!0},i.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},i.Connection=function(a,b){this.service=a,this.options=b||{};var c=this.options.protocol||"";0===a.indexOf("ws:")||0===a.indexOf("wss:")||0===c.indexOf("ws")?this._proto=new i.Websocket(this):this._proto=new i.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),d.addCookies(this.options.cookies);for(var e in i._connectionPlugins)if(i._connectionPlugins.hasOwnProperty(e)){var f=i._connectionPlugins[e],g=function(){};g.prototype=f,this[e]=new g,this[e].init(this)}},i.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)});return"string"==typeof a||"number"==typeof a?b+":"+a:b+""},connect:function(a,b,c,d,e,f,g){this.jid=a,this.authzid=i.getBareJidFromJid(this.jid),this.authcid=g||i.getNodeFromJid(this.jid),this.pass=b,this.servtype="xmpp",this.connect_callback=c,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=i.getDomainFromJid(this.jid),this._changeConnectStatus(i.Status.CONNECTING,null),this._proto._connect(d,e,f)},attach:function(a,b,c,d,e,f,g){if(!(this._proto instanceof i.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(a,b,c,d,e,f,g)},restore:function(a,b,c,d,e){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(a,b,c,d,e)},_sessionCachingSupported:function(){if(this._proto instanceof i.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(a){return!1}return!0}return!1},xmlInput:function(a){},xmlOutput:function(a){},rawInput:function(a){},rawOutput:function(a){},nextValidRid:function(a){},send:function(a){if(null!==a){if("function"==typeof a.sort)for(var b=0;b<a.length;b++)this._queueData(a[b]);else"function"==typeof a.tree?this._queueData(a.tree()):this._queueData(a);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(a,b,c,d){var e=null,f=this;"function"==typeof a.tree&&(a=a.tree());var g=a.getAttribute("id");g||(g=this.getUniqueId("sendIQ"),a.setAttribute("id",g));var h=a.getAttribute("to"),j=this.jid,k=this.addHandler(function(a){e&&f.deleteTimedHandler(e);var d=!1,g=a.getAttribute("from");if(g!==h&&(h||g!==i.getBareJidFromJid(j)&&g!==i.getDomainFromJid(j)&&g!==j)||(d=!0),!d)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+g+"\nExpected jid: "+h};var k=a.getAttribute("type");if("result"==k)b&&b(a);else{if("error"!=k)throw{name:"StropheError",message:"Got bad IQ type of "+k};c&&c(a)}},null,"iq",["error","result"],g);return d&&(e=this.addTimedHandler(d,function(){return f.deleteHandler(k),c&&c(null),!1})),this.send(a),g},_queueData:function(a){if(null===a||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(a,b){var c=new i.TimedHandler(a,b);return this.addTimeds.push(c),c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,d,e,f,g){var h=new i.Handler(a,b,c,d,e,f,g);return this.addHandlers.push(h),h},deleteHandler:function(a){this.removeHandlers.push(a);var b=this.addHandlers.indexOf(a);b>=0&&this.addHandlers.splice(b,1)},disconnect:function(a){if(this._changeConnectStatus(i.Status.DISCONNECTING,a),i.info("Disconnect was called because: "+a),this.connected){var b=!1;this.disconnecting=!0,this.authenticated&&(b=h({xmlns:i.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(b)}else i.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()},_changeConnectStatus:function(a,b){for(var c in i._connectionPlugins)if(i._connectionPlugins.hasOwnProperty(c)){var d=this[c];if(d.statusChanged)try{d.statusChanged(a,b)}catch(e){i.error(""+c+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(f){i.error("User connection callback caused an exception: "+f)}},_doDisconnect:function(a){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),i.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(i.Status.DISCONNECTED,a),this.connected=!1},_dataRecv:function(a,b){i.info("_dataRecv called");var c=this._proto._reqToData(a);if(null!==c){this.xmlInput!==i.Connection.prototype.xmlInput&&(c.nodeName===this._proto.strip&&c.childNodes.length?this.xmlInput(c.childNodes[0]):this.xmlInput(c)),this.rawInput!==i.Connection.prototype.rawInput&&(b?this.rawInput(b):this.rawInput(i.serialize(c)));for(var d,e;this.removeHandlers.length>0;)e=this.removeHandlers.pop(),d=this.handlers.indexOf(e),d>=0&&this.handlers.splice(d,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var f,g,h=c.getAttribute("type");if(null!==h&&"terminate"==h){if(this.disconnecting)return;return f=c.getAttribute("condition"),g=c.getElementsByTagName("conflict"),null!==f?("remote-stream-error"==f&&g.length>0&&(f="conflict"),this._changeConnectStatus(i.Status.CONNFAIL,f)):this._changeConnectStatus(i.Status.CONNFAIL,"unknown"),void this._doDisconnect(f)}var j=this;i.forEachChild(c,null,function(a){var b,c;for(c=j.handlers,j.handlers=[],b=0;b<c.length;b++){var d=c[b];try{!d.isMatch(a)||!j.authenticated&&d.user?j.handlers.push(d):d.run(a)&&j.handlers.push(d)}catch(e){i.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}},mechanisms:{},_connect_cb:function(a,b,c){i.info("_connect_cb was called"),this.connected=!0;var d;try{d=this._proto._reqToData(a)}catch(e){if("badformat"!=e)throw e;this._changeConnectStatus(i.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(d){this.xmlInput!==i.Connection.prototype.xmlInput&&(d.nodeName===this._proto.strip&&d.childNodes.length?this.xmlInput(d.childNodes[0]):this.xmlInput(d)),this.rawInput!==i.Connection.prototype.rawInput&&(c?this.rawInput(c):this.rawInput(i.serialize(d)));var f=this._proto._connect_cb(d);if(f!==i.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var g;g=d.getElementsByTagNameNS?d.getElementsByTagNameNS(i.NS.STREAM,"features").length>0:d.getElementsByTagName("stream:features").length>0||d.getElementsByTagName("features").length>0;var h,j,k=d.getElementsByTagName("mechanism"),l=[],m=!1;if(!g)return void this._proto._no_auth_received(b);if(k.length>0)for(h=0;h<k.length;h++)j=i.getText(k[h]),this.mechanisms[j]&&l.push(this.mechanisms[j]);return this._authentication.legacy_auth=d.getElementsByTagName("auth").length>0,(m=this._authentication.legacy_auth||l.length>0)?void(this.do_authentication!==!1&&this.authenticate(l)):void this._proto._no_auth_received(b)}}},authenticate:function(a){var c;for(c=0;c<a.length-1;++c){for(var d=c,f=c+1;f<a.length;++f)a[f].prototype.priority>a[d].prototype.priority&&(d=f);if(d!=c){var h=a[c];a[c]=a[d],a[d]=h}}var j=!1;for(c=0;c<a.length;++c)if(a[c].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new a[c],this._sasl_mechanism.onStart(this);var k=e("auth",{xmlns:i.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var l=this._sasl_mechanism.onChallenge(this,null);k.t(b.encode(l))}this.send(k.tree()),j=!0;break}j||(null===i.getNodeFromJid(this.jid)?(this._changeConnectStatus(i.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(i.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(g({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:i.NS.AUTH}).c("username",{}).t(i.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(a){var c=b.decode(i.getText(a)),d=this._sasl_mechanism.onChallenge(this,c),f=e("response",{xmlns:i.NS.SASL});return""!==d&&f.t(b.encode(d)),this.send(f.tree()),!0},_auth1_cb:function(a){var b=g({type:"set",id:"_auth_2"}).c("query",{xmlns:i.NS.AUTH}).c("username",{}).t(i.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return i.getResourceFromJid(this.jid)||(this.jid=i.getBareJidFromJid(this.jid)+"/strophe"),b.up().c("resource",{}).t(i.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(b.tree()),!1},_sasl_success_cb:function(a){if(this._sasl_data["server-signature"]){var c,d=b.decode(i.getText(a)),e=/([a-z]+)=([^,]+)(,|$)/,f=d.match(e);if("v"==f[1]&&(c=f[2]),c!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}i.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var g=[],h=function(a,b){for(;a.length;)this.deleteHandler(a.pop());return this._sasl_auth1_cb.bind(this)(b),!1};return g.push(this._addSysHandler(function(a){h.bind(this)(g,a)}.bind(this),null,"stream:features",null,null)),g.push(this._addSysHandler(function(a){h.bind(this)(g,a)}.bind(this),i.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(a){this.features=a;var b,c;for(b=0;b<a.childNodes.length;b++)c=a.childNodes[b],"bind"==c.nodeName&&(this.do_bind=!0),"session"==c.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(i.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var d=i.getResourceFromJid(this.jid);return d?this.send(g({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:i.NS.BIND}).c("resource",{}).t(d).tree()):this.send(g({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:i.NS.BIND}).tree()),!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type")){i.info("SASL binding failed.");var b,c=a.getElementsByTagName("conflict");return c.length>0&&(b="conflict"),this._changeConnectStatus(i.Status.AUTHFAIL,b),!1}var d,e=a.getElementsByTagName("bind");return e.length>0?(d=e[0].getElementsByTagName("jid"),void(d.length>0&&(this.jid=i.getText(d[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(g({type:"set",id:"_session_auth_2"}).c("session",{xmlns:i.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(i.Status.CONNECTED,null))))):(i.info("SASL binding failed."),this._changeConnectStatus(i.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(a){if("result"==a.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(i.Status.CONNECTED,null);else if("error"==a.getAttribute("type"))return i.info("Session creation failed."),this._changeConnectStatus(i.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(a){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),
	this._changeConnectStatus(i.Status.AUTHFAIL,null),!1},_auth2_cb:function(a){return"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(i.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(i.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(a,b){var c=new i.TimedHandler(a,b);return c.user=!1,this.addTimeds.push(c),c},_addSysHandler:function(a,b,c,d,e){var f=new i.Handler(a,b,c,d,e);return f.user=!1,this.addHandlers.push(f),f},_onDisconnectTimeout:function(){return i.info("_onDisconnectTimeout was called"),this._changeConnectStatus(i.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var a,b,c,d;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),a>=0&&this.timedHandlers.splice(a,1);var e=(new Date).getTime();for(d=[],a=0;a<this.timedHandlers.length;a++)b=this.timedHandlers[a],(this.authenticated||!b.user)&&(c=b.lastCalled+b.period,0>=c-e?b.run()&&d.push(b):d.push(b));this.timedHandlers=d,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},i.SASLMechanism=function(a,b,c){this.name=a,this.isClientFirst=b,this.priority=c},i.SASLMechanism.prototype={test:function(a){return!0},onStart:function(a){this._connection=a},onChallenge:function(a,b){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},i.SASLAnonymous=function(){},i.SASLAnonymous.prototype=new i.SASLMechanism("ANONYMOUS",!1,10),i.SASLAnonymous.prototype.test=function(a){return null===a.authcid},i.Connection.prototype.mechanisms[i.SASLAnonymous.prototype.name]=i.SASLAnonymous,i.SASLPlain=function(){},i.SASLPlain.prototype=new i.SASLMechanism("PLAIN",!0,20),i.SASLPlain.prototype.test=function(a){return null!==a.authcid},i.SASLPlain.prototype.onChallenge=function(a){var b=a.authzid;return b+="\x00",b+=a.authcid,b+="\x00",b+=a.pass,d.utf16to8(b)},i.Connection.prototype.mechanisms[i.SASLPlain.prototype.name]=i.SASLPlain,i.SASLSHA1=function(){},i.SASLSHA1.prototype=new i.SASLMechanism("SCRAM-SHA-1",!0,40),i.SASLSHA1.prototype.test=function(a){return null!==a.authcid},i.SASLSHA1.prototype.onChallenge=function(e,f,g){var h=g||c.hexdigest(1234567890*Math.random()),i="n="+d.utf16to8(e.authcid);return i+=",r=",i+=h,e._sasl_data.cnonce=h,e._sasl_data["client-first-message-bare"]=i,i="n,,"+i,this.onChallenge=function(c,e){for(var f,g,h,i,j,k,l,m,n,o,p,q,r="c=biws,",s=c._sasl_data["client-first-message-bare"]+","+e+",",t=c._sasl_data.cnonce,u=/([a-z]+)=([^,]+)(,|$)/;e.match(u);){var v=e.match(u);switch(e=e.replace(v[0],""),v[1]){case"r":f=v[2];break;case"s":g=v[2];break;case"i":h=v[2]}}if(f.substr(0,t.length)!==t)return c._sasl_data={},c._sasl_failure_cb();for(r+="r="+f,s+=r,g=b.decode(g),g+="\x00\x00\x00",n=d.utf16to8(c.pass),i=k=a.core_hmac_sha1(n,g),l=1;h>l;l++){for(j=a.core_hmac_sha1(n,a.binb2str(k)),m=0;5>m;m++)i[m]^=j[m];k=j}for(i=a.binb2str(i),o=a.core_hmac_sha1(i,"Client Key"),p=a.str_hmac_sha1(i,"Server Key"),q=a.core_hmac_sha1(a.str_sha1(a.binb2str(o)),s),c._sasl_data["server-signature"]=a.b64_hmac_sha1(p,s),m=0;5>m;m++)o[m]^=q[m];return r+=",p="+b.encode(a.binb2str(o))}.bind(this),i},i.Connection.prototype.mechanisms[i.SASLSHA1.prototype.name]=i.SASLSHA1,i.SASLMD5=function(){},i.SASLMD5.prototype=new i.SASLMechanism("DIGEST-MD5",!1,30),i.SASLMD5.prototype.test=function(a){return null!==a.authcid},i.SASLMD5.prototype._quote=function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},i.SASLMD5.prototype.onChallenge=function(a,b,e){for(var f,g=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,h=e||c.hexdigest(""+1234567890*Math.random()),i="",j=null,k="",l="";b.match(g);)switch(f=b.match(g),b=b.replace(f[0],""),f[2]=f[2].replace(/^"(.+)"$/,"$1"),f[1]){case"realm":i=f[2];break;case"nonce":k=f[2];break;case"qop":l=f[2];break;case"host":j=f[2]}var m=a.servtype+"/"+a.domain;null!==j&&(m=m+"/"+j);var n=d.utf16to8(a.authcid+":"+i+":"+this._connection.pass),o=c.hash(n)+":"+k+":"+h,p="AUTHENTICATE:"+m,q="";return q+="charset=utf-8,",q+="username="+this._quote(d.utf16to8(a.authcid))+",",q+="realm="+this._quote(i)+",",q+="nonce="+this._quote(k)+",",q+="nc=00000001,",q+="cnonce="+this._quote(h)+",",q+="digest-uri="+this._quote(m)+",",q+="response="+c.hexdigest(c.hexdigest(o)+":"+k+":00000001:"+h+":auth:"+c.hexdigest(p))+",",q+="qop=auth",this.onChallenge=function(){return""},q},i.Connection.prototype.mechanisms[i.SASLMD5.prototype.name]=i.SASLMD5,i.SASLOAuthBearer=function(){},i.SASLOAuthBearer.prototype=new i.SASLMechanism("OAUTHBEARER",!0,50),i.SASLOAuthBearer.prototype.test=function(a){return null!==a.authcid},i.SASLOAuthBearer.prototype.onChallenge=function(a){var b="n,a=";return b+=a.authzid,b+=",",b+="",b+="auth=Bearer ",b+=a.pass,b+="",b+="",d.utf16to8(b)},i.Connection.prototype.mechanisms[i.SASLOAuthBearer.prototype.name]=i.SASLOAuthBearer,i.SASLExternal=function(){},i.SASLExternal.prototype=new i.SASLMechanism("EXTERNAL",!0,60),i.SASLExternal.prototype.onChallenge=function(a){return a.authcid===a.authzid?"":a.authzid},i.Connection.prototype.mechanisms[i.SASLExternal.prototype.name]=i.SASLExternal,{Strophe:i,$build:e,$msg:f,$iq:g,$pres:h,SHA1:a,Base64:b,MD5:c}}),function(a,b){return true?void !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__WEBPACK_LOCAL_MODULE_5__], __WEBPACK_LOCAL_MODULE_6__ = (function(a){return b(a.Strophe,a.$build)}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__))):b(Strophe,$build)}(this,function(a,b){return a.Request=function(b,c,d,e){this.id=++a._requestId,this.xmlData=b,this.data=a.serialize(b),this.origFunc=c,this.func=c,this.rid=d,this.date=NaN,this.sends=e||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var a=new Date;return(a-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var a=new Date;return(a-this.dead)/1e3},this.xhr=this._newXHR()},a.Request.prototype={getResponse:function(){var b=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(b=this.xhr.responseXML.documentElement,"parsererror"==b.tagName)throw a.error("invalid response received"),a.error("responseText: "+this.xhr.responseText),a.error("responseXML: "+a.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw a.error("invalid response received"),a.error("responseText: "+this.xhr.responseText),"badformat";return b},_newXHR:function(){var a=null;return window.XMLHttpRequest?(a=new XMLHttpRequest,a.overrideMimeType&&a.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=this.func.bind(null,this),a}},a.Bosh=function(a){this._conn=a,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this._requests=[]},a.Bosh.prototype={strip:null,_buildBody:function(){var c=b("body",{rid:this.rid++,xmlns:a.NS.HTTPBIND});return null!==this.sid&&c.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),c},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(b,c,d){this.wait=b||this.wait,this.hold=c||this.hold,this.errors=0;var e=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":a.NS.BOSH});d&&e.attrs({route:d});var f=this._conn._connect_cb;this._requests.push(new a.Request(e.tree(),this._onRequestStateChange.bind(this,f.bind(this._conn)),e.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(b,c,d,e,f,g,h){this._conn.jid=b,this.sid=c,this.rid=d,this._conn.connect_callback=e,this._conn.domain=a.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=f||this.wait,this.hold=g||this.hold,this.window=h||this.window,this._conn._changeConnectStatus(a.Status.ATTACHED,null)},_restore:function(b,c,d,e,f){var g=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!("undefined"!=typeof g&&null!==g&&g.rid&&g.sid&&g.jid)||"undefined"!=typeof b&&null!==b&&a.getBareJidFromJid(g.jid)!=a.getBareJidFromJid(b))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(g.jid,g.sid,g.rid,c,d,e,f)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(b){var c,d,e=b.getAttribute("type");if(null!==e&&"terminate"==e)return c=b.getAttribute("condition"),a.error("BOSH-Connection failed: "+c),d=b.getElementsByTagName("conflict"),null!==c?("remote-stream-error"==c&&d.length>0&&(c="conflict"),this._conn._changeConnectStatus(a.Status.CONNFAIL,c)):this._conn._changeConnectStatus(a.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(c),a.Status.CONNFAIL;this.sid||(this.sid=b.getAttribute("sid"));var f=b.getAttribute("requests");f&&(this.window=parseInt(f,10));var g=b.getAttribute("hold");g&&(this.hold=parseInt(g,10));var h=b.getAttribute("wait");h&&(this.wait=parseInt(h,10))},_disconnect:function(a){this._sendTerminate(a)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(b){this.errors++,a.warn("request errored, status: "+b+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(b){b=b?b.bind(this._conn):this._conn._connect_cb.bind(this._conn);var c=this._buildBody();this._requests.push(new a.Request(c.tree(),this._onRequestStateChange.bind(this,b.bind(this._conn)),c.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var a;this._requests.length>0;)a=this._requests.pop(),a.abort=!0,a.xhr.abort(),a.xhr.onreadystatechange=function(){}},_onIdle:function(){var b=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===b.length&&!this._conn.disconnecting&&(a.info("no requests during idle cycle, sending blank request"),b.push(null)),!this._conn.paused){if(this._requests.length<2&&b.length>0){for(var c=this._buildBody(),d=0;d<b.length;d++)null!==b[d]&&("restart"===b[d]?c.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":a.NS.BOSH}):c.cnode(b[d]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new a.Request(c.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),c.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(a.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),e>Math.floor(a.TIMEOUT*this.wait)&&(a.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(a.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_onRequestStateChange:function(b,c){if(a.debug("request id "+c.id+"."+c.sends+" state changed to "+c.xhr.readyState),c.abort)return void(c.abort=!1);var d;if(4==c.xhr.readyState){d=0;try{d=c.xhr.status}catch(e){}if("undefined"==typeof d&&(d=0),this.disconnecting&&d>=400)return void this._hitError(d);var f=this._requests[0]==c,g=this._requests[1]==c;(d>0&&500>d||c.sends>5)&&(this._removeRequest(c),a.debug("request id "+c.id+" should now be removed")),200==d?((g||f&&this._requests.length>0&&this._requests[0].age()>Math.floor(a.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(c.rid)+1),a.debug("request id "+c.id+"."+c.sends+" got 200"),b(c),this.errors=0):(a.error("request id "+c.id+"."+c.sends+" error "+d+" happened"),(0===d||d>=400&&600>d||d>=12e3)&&(this._hitError(d),d>=400&&500>d&&(this._conn._changeConnectStatus(a.Status.DISCONNECTING,null),this._conn._doDisconnect()))),d>0&&500>d||c.sends>5||this._throttledRequestHandler()}},_processRequest:function(b){var c=this,d=this._requests[b],e=-1;try{4==d.xhr.readyState&&(e=d.xhr.status)}catch(f){a.error("caught an error in _requests["+b+"], reqStatus: "+e)}if("undefined"==typeof e&&(e=-1),d.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var g=d.age(),h=!isNaN(g)&&g>Math.floor(a.TIMEOUT*this.wait),i=null!==d.dead&&d.timeDead()>Math.floor(a.SECONDARY_TIMEOUT*this.wait),j=4==d.xhr.readyState&&(1>e||e>=500);if((h||i||j)&&(i&&a.error("Request "+this._requests[b].id+" timed out (secondary), restarting"),d.abort=!0,d.xhr.abort(),d.xhr.onreadystatechange=function(){},this._requests[b]=new a.Request(d.xmlData,d.origFunc,d.rid,d.sends),d=this._requests[b]),0===d.xhr.readyState){a.debug("request id "+d.id+"."+d.sends+" posting");try{var k=this._conn.options.contentType||"text/xml; charset=utf-8";d.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0),d.xhr.setRequestHeader&&d.xhr.setRequestHeader("Content-Type",k),this._conn.options.withCredentials&&(d.xhr.withCredentials=!0)}catch(l){return a.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(a.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var m=function(){if(d.date=new Date,c._conn.options.customHeaders){var a=c._conn.options.customHeaders;for(var b in a)a.hasOwnProperty(b)&&d.xhr.setRequestHeader(b,a[b])}d.xhr.send(d.data)};if(d.sends>1){var n=1e3*Math.min(Math.floor(a.TIMEOUT*this.wait),Math.pow(d.sends,3));setTimeout(function(){m()},n)}else m();d.sends++,this._conn.xmlOutput!==a.Connection.prototype.xmlOutput&&(d.xmlData.nodeName===this.strip&&d.xmlData.childNodes.length?this._conn.xmlOutput(d.xmlData.childNodes[0]):this._conn.xmlOutput(d.xmlData)),this._conn.rawOutput!==a.Connection.prototype.rawOutput&&this._conn.rawOutput(d.data)}else a.debug("_processRequest: "+(0===b?"first":"second")+" request has readyState of "+d.xhr.readyState)},_removeRequest:function(b){a.debug("removing request");var c;for(c=this._requests.length-1;c>=0;c--)b==this._requests[c]&&this._requests.splice(c,1);b.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];null===b.dead&&(b.dead=new Date),this._processRequest(a)},_reqToData:function(a){try{return a.getResponse()}catch(b){if("parsererror"!=b)throw b;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(b){a.info("_sendTerminate was called");var c=this._buildBody().attrs({type:"terminate"});b&&c.cnode(b.tree());var d=new a.Request(c.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),c.tree().getAttribute("rid"));this._requests.push(d),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?a.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):a.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},a}),function(a,b){return true?void !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__WEBPACK_LOCAL_MODULE_5__], __WEBPACK_LOCAL_MODULE_7__ = (function(a){return b(a.Strophe,a.$build)}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__))):b(Strophe,$build)}(this,function(a,b){return a.Websocket=function(a){this._conn=a,this.strip="wrapper";var b=a.service;if(0!==b.indexOf("ws:")&&0!==b.indexOf("wss:")){var c="";c+="ws"===a.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",c+="://"+window.location.host,c+=0!==b.indexOf("/")?window.location.pathname+b:b,a.service=c}},a.Websocket.prototype={_buildStream:function(){return b("open",{xmlns:a.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(b,c){var d;if(d=b.getElementsByTagNameNS?b.getElementsByTagNameNS(a.NS.STREAM,"error"):b.getElementsByTagName("stream:error"),0===d.length)return!1;for(var e=d[0],f="",g="",h="urn:ietf:params:xml:ns:xmpp-streams",i=0;i<e.childNodes.length;i++){var j=e.childNodes[i];if(j.getAttribute("xmlns")!==h)break;"text"===j.nodeName?g=j.textContent:f=j.nodeName}var k="WebSocket stream error: ";return k+=f?f:"unknown",g&&(k+=" - "+f),a.error(k),this._conn._changeConnectStatus(c,f),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(b){var c=this._check_streamerror(b,a.Status.CONNFAIL);return c?a.Status.CONNFAIL:void 0},_handleStreamStart:function(b){var c=!1,d=b.getAttribute("xmlns");"string"!=typeof d?c="Missing xmlns in <open />":d!==a.NS.FRAMING&&(c="Wrong xmlns in <open />: "+d);var e=b.getAttribute("version");return"string"!=typeof e?c="Missing version in <open />":"1.0"!==e&&(c="Wrong version in <open />: "+e),c?(this._conn._changeConnectStatus(a.Status.CONNFAIL,c),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(b){if(0===b.data.indexOf("<open ")||0===b.data.indexOf("<?xml")){var c=b.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===c)return;var d=(new DOMParser).parseFromString(c,"text/xml").documentElement;this._conn.xmlInput(d),this._conn.rawInput(b.data),this._handleStreamStart(d)&&this._connect_cb(d)}else if(0===b.data.indexOf("<close ")){this._conn.rawInput(b.data),this._conn.xmlInput(b);var e=b.getAttribute("see-other-uri");e?(this._conn._changeConnectStatus(a.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=e,this._connect()):(this._conn._changeConnectStatus(a.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var f=this._streamWrap(b.data),g=(new DOMParser).parseFromString(f,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(g,null,b.data)}},_disconnect:function(c){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){c&&this._conn.send(c);var d=b("close",{xmlns:a.NS.FRAMING});this._conn.xmlOutput(d);var e=a.serialize(d);this._conn.rawOutput(e);try{this.socket.send(e)}catch(f){a.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){a.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(a){return"<wrapper>"+a+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(a){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(a.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):a.info("Websocket closed")},_no_auth_received:function(b){a.error("Server did not send any auth methods"),this._conn._changeConnectStatus(a.Status.CONNFAIL,"Server did not send any auth methods"),b&&(b=b.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(b){a.error("Websocket error "+b),this._conn._changeConnectStatus(a.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var b=this._conn._data;if(b.length>0&&!this._conn.paused){for(var c=0;c<b.length;c++)if(null!==b[c]){var d,e;d="restart"===b[c]?this._buildStream().tree():b[c],e=a.serialize(d),this._conn.xmlOutput(d),this._conn.rawOutput(e),this.socket.send(e)}this._conn._data=[]}},_onMessage:function(b){var c,d,e='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(b.data===e)return this._conn.rawInput(e),this._conn.xmlInput(b),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===b.data.search("<open ")){if(c=(new DOMParser).parseFromString(b.data,"text/xml").documentElement,!this._handleStreamStart(c))return}else d=this._streamWrap(b.data),c=(new DOMParser).parseFromString(d,"text/xml").documentElement;return this._check_streamerror(c,a.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===c.firstChild.nodeName&&"unavailable"===c.firstChild.getAttribute("type")?(this._conn.xmlInput(c),void this._conn.rawInput(a.serialize(c))):void this._conn._dataRecv(c,b.data)},_onOpen:function(){a.info("Websocket open");var b=this._buildStream();this._conn.xmlOutput(b.tree());var c=a.serialize(b);this._conn.rawOutput(c),this.socket.send(c)},_reqToData:function(a){return a},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},a}),function(a){"function"=="function"&&__webpack_require__(114)&&!(__WEBPACK_AMD_DEFINE_ARRAY__ = [__WEBPACK_LOCAL_MODULE_5__,__WEBPACK_LOCAL_MODULE_6__,__WEBPACK_LOCAL_MODULE_7__], __WEBPACK_LOCAL_MODULE_8__ = (function(a){return a}.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)))}(this),a){if(false)return a(Strophe,$build,$msg,$iq,$pres);var b=a;"function"==typeof requirejs?requirejs(["strophe"],function(a){b(a.Strophe,a.$build,a.$msg,a.$iq,a.$pres)}):!/* require */(/* empty */function() { var __WEBPACK_AMD_REQUIRE_ARRAY__ = [__WEBPACK_LOCAL_MODULE_8__]; (function(a){b(a.Strophe,a.$build,a.$msg,a.$iq,a.$pres)}.apply(null, __WEBPACK_AMD_REQUIRE_ARRAY__));}())}}(function(a,b,c,d,e){window.Strophe=a,window.$build=b,window.$msg=c,window.$iq=d,window.$pres=e});

/***/ },

/***/ 114:
/***/ function(module, exports) {

	/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {module.exports = __webpack_amd_options__;

	/* WEBPACK VAR INJECTION */}.call(exports, {}))

/***/ },

/***/ 115:
/***/ function(module, exports, __webpack_require__) {

	!function(e,t){ true?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebIM=t():e.WebIM=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var i=o[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){e.exports=o(1)},function(module,exports,__webpack_require__){function _parsePrivacy(e){var t=[],o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var i=o[n],r=i.getAttribute("value"),s=i.getAttribute("order"),a=i.getAttribute("type");if(r){var c=_parseNameFromJidFn(r);t[c]={type:a,order:s,jid:r,name:c}}}return t}function _parseGroupBlacklist(e){var t={},o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var i=o[n],r=i.getAttribute("jid"),s=i.getAttribute("affiliation"),a=i.getAttribute("nick");if(r){var c=_parseNameFromJidFn(r);t[c]={jid:r,affiliation:s,nick:a,name:c}}}return t}function _setText(e,t){"textContent"in e?e.textContent=t:"text"in e&&(e.text=t)}var _version="1.4.2",_code=__webpack_require__(2).code,_utils=__webpack_require__(3).utils,_msg=__webpack_require__(4),_message=_msg._msg,_msgHash={},Queue=__webpack_require__(5).Queue;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,window.XDomainRequest&&(XDomainRequest.prototype.oldsend=XDomainRequest.prototype.send,XDomainRequest.prototype.send=function(){XDomainRequest.prototype.oldsend.apply(this,arguments),this.readyState=2}),Strophe.Request.prototype._newXHR=function(){var e=_utils.xmlrequest(!0);return e.overrideMimeType&&e.overrideMimeType("text/xml"),e.onreadystatechange=this.func.bind(null,this),e},Strophe.Websocket.prototype._closeSocket=function(){if(this.socket){var e=this;setTimeout(function(){try{e.socket.close()}catch(e){}},0)}else this.socket=null},Strophe.Websocket.prototype._onMessage=function(e){WebIM&&WebIM.config.isDebug&&console.log(WebIM.utils.ts()+"recv:",e.data);var t,o;if(0===e.data.indexOf("<close ")){t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;var n=t.getAttribute("see-other-uri");return void(n?(this._conn._changeConnectStatus(Strophe.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=n,this._connect()):this._conn._doDisconnect("receive <close> from server"))}if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else o=this._streamWrap(e.data),t=(new DOMParser).parseFromString(o,"text/xml").documentElement;if(!this._check_streamerror(t,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Strophe.serialize(t))):void this._conn._dataRecv(t,e.data)};var _listenNetwork=function(e,t){window.addEventListener?(window.addEventListener("online",e),window.addEventListener("offline",t)):window.attachEvent&&(document.body?(document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)):window.attachEvent("load",function(){document.body.attachEvent("ononline",e),document.body.attachEvent("onoffline",t)}))},_parseRoom=function(e){var t=[],o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var i=o[n],r=i.getAttribute("jid"),s=r.split("@")[0],a={jid:r,name:i.getAttribute("name"),roomId:s.split("_")[1]};t.push(a)}return t},_parseRoomOccupants=function(e){var t=[],o=e.getElementsByTagName("item");if(o)for(var n=0;n<o.length;n++){var i=o[n],r={jid:i.getAttribute("jid"),name:i.getAttribute("name")};t.push(r)}return t},_parseResponseMessage=function(msginfo){var parseMsgData={errorMsg:!0,data:[]},msgBodies=msginfo.getElementsByTagName("body");if(msgBodies){for(var i=0;i<msgBodies.length;i++){var msgBody=msgBodies[i],childNodes=msgBody.childNodes;if(childNodes&&childNodes.length>0){var childNode=msgBody.childNodes[0];if(childNode.nodeType==Strophe.ElementType.TEXT){var jsondata=childNode.wholeText||childNode.nodeValue;jsondata=jsondata.replace("\n","<br>");try{var data=eval("("+jsondata+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}}var delayTags=msginfo.getElementsByTagName("delay");if(delayTags&&delayTags.length>0){var delayTag=delayTags[0],delayMsgTime=delayTag.getAttribute("stamp");delayMsgTime&&(parseMsgData.delayTimeStamp=delayMsgTime)}}else{var childrens=msginfo.childNodes;if(childrens&&childrens.length>0){var child=msginfo.childNodes[0];if(child.nodeType==Strophe.ElementType.TEXT)try{var data=eval("("+child.nodeValue+")");parseMsgData.errorMsg=!1,parseMsgData.data=[data]}catch(e){}}}return parseMsgData},_parseNameFromJidFn=function(e,t){t=t||"";var o=e,n=o.indexOf("_");n!==-1&&(o=o.substring(n+1));var i=o.indexOf("@"+t);return i!==-1&&(o=o.substring(0,i)),o},_parseFriend=function(e,t,o){var n=[],i=e.getElementsByTagName("item");if(i)for(var r=0;r<i.length;r++){var s=i[r],a=s.getAttribute("jid");if(a){var c=s.getAttribute("subscription"),p={subscription:c,jid:a},l=s.getAttribute("ask");l&&(p.ask=l);var u=s.getAttribute("name");if(u)p.name=u;else{var d=_parseNameFromJidFn(a);p.name=d}var m=[];Strophe.forEachChild(s,"group",function(e){m.push(Strophe.getText(e))}),p.groups=m,n.push(p),t&&"from"==c&&t.subscribe({toJid:a}),t&&"to"==c&&t.subscribed({toJid:a})}}return n},_login=function(e,t){var o=e.access_token||"";if(""==o){_utils.stringify(e);return void t.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:e})}t.context.accessToken=e.access_token,t.context.accessTokenExpires=e.expires_in;var n=null;n=t.isOpening()&&t.context.stropheConn?t.context.stropheConn:t.isOpened()&&t.context.stropheConn?t.getStrophe():t.getStrophe();var i=function(e,o){_loginCallback(e,o,t)};t.context.stropheConn=n,t.route?n.connect(t.context.jid,"$t$"+o,i,t.wait,t.hold,t.route):n.connect(t.context.jid,"$t$"+o,i,t.wait,t.hold)},_parseMessageType=function(e){var t="normal",o=e.getElementsByTagName("received");if(o&&o.length>0&&"urn:xmpp:receipts"===o[0].namespaceURI)t="received";else{var n=e.getElementsByTagName("invite");n&&n.length>0&&(t="invite")}return t},_handleMessageQueue=function(e){for(var t in _msgHash)_msgHash.hasOwnProperty(t)&&_msgHash[t].send(e)},_loginCallback=function(e,t,o){var n,i;if("conflict"===t&&(n=!0),e==Strophe.Status.CONNFAIL)i={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t,reconnect:!0},n&&(i.conflict=!0),o.onError(i);else if(e==Strophe.Status.ATTACHED||e==Strophe.Status.CONNECTED){o.intervalId=setInterval(function(){o.handelSendQueue()},200);var r=function(e){var t=_parseMessageType(e);return"received"===t?(o.handleReceivedMessage(e),!0):"invite"===t?(o.handleInviteMessage(e),!0):(o.handleMessage(e),!0)},s=function(e){return o.handlePresence(e),!0},a=function(e){return o.handlePing(e),!0},c=function(e){return o.handleIqRoster(e),!0},p=function(e){return o.handleIqPrivacy(e),!0},l=function(e){return o.handleIq(e),!0};o.addHandler(r,null,"message",null,null,null),o.addHandler(s,null,"presence",null,null,null),o.addHandler(a,"urn:xmpp:ping","iq","get",null,null),o.addHandler(c,"jabber:iq:roster","iq","set",null,null),o.addHandler(p,"jabber:iq:privacy","iq","set",null,null),o.addHandler(l,null,"iq",null,null,null),o.context.status=_code.STATUS_OPENED;var u=[_code.WEBIM_MESSAGE_REC_TEXT,_code.WEBIM_MESSAGE_REC_EMOJI];_utils.isCanDownLoadFile&&(u.push(_code.WEBIM_MESSAGE_REC_PHOTO),u.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE));var d=[_code.WEBIM_MESSAGE_SED_TEXT];_utils.isCanUploadFile&&(d.push(_code.WEBIM_MESSAGE_REC_PHOTO),d.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE)),o.notifyVersion(),o.retry&&_handleMessageQueue(o),o.heartBeat(),o.isAutoLogin&&o.setPresence(),o.onOpened({canReceive:u,canSend:d,accessToken:o.context.accessToken})}else if(e==Strophe.Status.DISCONNECTING)o.isOpened()&&(o.stopHeartBeat(),o.context.status=_code.STATUS_CLOSING,i={type:_code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,msg:t,reconnect:!0},n&&(i.conflict=!0),o.onError(i));else if(e==Strophe.Status.DISCONNECTED){if(o.isOpened()){if(Demo.conn.autoReconnectNumTotal<Demo.conn.autoReconnectNumMax)return void Demo.conn.reconnect();i={type:_code.WEBIM_CONNCTION_DISCONNECTED},o.onError(i)}o.context.status=_code.STATUS_CLOSED,o.clear(),o.onClosed()}else e==Strophe.Status.AUTHFAIL?(i={type:_code.WEBIM_CONNCTION_AUTH_ERROR},n&&(i.conflict=!0),o.onError(i),o.clear()):e==Strophe.Status.ERROR&&(o.context.status=_code.STATUS_ERROR,i={type:_code.WEBIM_CONNCTION_SERVER_ERROR},n&&(i.conflict=!0),o.onError(i));o.context.status_now=e},_getJid=function(e,t){var o=e.toJid||"";if(""===o){var n=t.context.appKey||"",i=n+"_"+e.to+"@"+t.domain;e.resource&&(i=i+"/"+e.resource),o=i}return o},_getJidByName=function(e,t){var o={to:e};return _getJid(o,t)},_validCheck=function(e,t){if(e=e||{},""==e.user)return t.onError({type:_code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR}),!1;var o=e.user+""||"",n=e.appKey||"",i=n.split("#");if(2!==i.length)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var r=i[0],s=i[1];if(!r)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;if(!s)return t.onError({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=n+"_"+o.toLowerCase()+"@"+t.domain,c=e.resource||"webim";return t.isMultiLoginSessions&&(c+=o+(new Date).getTime()+Math.floor(1e6*Math.random().toFixed(6))),t.context.jid=a+"/"+c,t.context.userId=o,t.context.appKey=n,t.context.appName=s,t.context.orgName=r,!0},_getXmppUrl=function(e,t){if(/^(ws|http)s?:\/\/?/.test(e))return e;var o={prefix:"http",base:"://"+e,suffix:"/http-bind/"};return t&&_utils.isSupportWss?(o.prefix="wss",o.suffix="/ws/"):t?o.prefix="https":window.WebSocket&&(o.prefix="ws",o.suffix="/ws/"),o.prefix+o.base+o.suffix},connection=function(e){if(!this instanceof connection)return new connection(e);var e=e||{};this.isMultiLoginSessions=e.isMultiLoginSessions||!1,this.wait=e.wait||30,this.retry=e.retry||!1,this.https=e.https||"https:"===location.protocol,this.url=_getXmppUrl(e.url,this.https),this.hold=e.hold||1,this.route=e.route||null,this.domain=e.domain||"easemob.com",this.inactivity=e.inactivity||30,this.heartBeatWait=e.heartBeatWait||4500,this.maxRetries=e.maxRetries||5,this.isAutoLogin=e.isAutoLogin!==!1,this.pollingTime=e.pollingTime||800,this.stropheConn=!1,this.autoReconnectNumMax=e.autoReconnectNumMax||0,this.autoReconnectNumTotal=0,this.autoReconnectInterval=e.autoReconnectInterval||0,this.context={status:_code.STATUS_INIT},this.sendQueue=new Queue,this.intervalId=null,this.dnsArr=["https://rs.easemob.com","https://rsbak.easemob.com","http://182.92.174.78","http://112.126.66.111"],this.dnsIndex=0,this.dnsTotal=this.dnsArr.length,this.restHosts=null,this.restIndex=0,this.restTotal=0,this.xmppHosts=null,this.xmppIndex=0,this.xmppTotal=0};connection.prototype.handelSendQueue=function(){var e=this.sendQueue.pop();null!==e&&this.sendReceiptsMessage(e)},connection.prototype.listen=function(e){this.onOpened=e.onOpened||_utils.emptyfn,this.onClosed=e.onClosed||_utils.emptyfn,this.onTextMessage=e.onTextMessage||_utils.emptyfn,this.onEmojiMessage=e.onEmojiMessage||_utils.emptyfn,this.onPictureMessage=e.onPictureMessage||_utils.emptyfn,this.onAudioMessage=e.onAudioMessage||_utils.emptyfn,this.onVideoMessage=e.onVideoMessage||_utils.emptyfn,this.onFileMessage=e.onFileMessage||_utils.emptyfn,this.onLocationMessage=e.onLocationMessage||_utils.emptyfn,this.onCmdMessage=e.onCmdMessage||_utils.emptyfn,this.onPresence=e.onPresence||_utils.emptyfn,this.onRoster=e.onRoster||_utils.emptyfn,this.onError=e.onError||_utils.emptyfn,this.onReceivedMessage=e.onReceivedMessage||_utils.emptyfn,this.onInviteMessage=e.onInviteMessage||_utils.emptyfn,this.onOffline=e.onOffline||_utils.emptyfn,this.onOnline=e.onOnline||_utils.emptyfn,this.onConfirmPop=e.onConfirmPop||_utils.emptyfn,this.onUpdateMyGroupList=e.onUpdateMyGroupList||_utils.emptyfn,this.onUpdateMyRoster=e.onUpdateMyRoster||_utils.emptyfn,this.onBlacklistUpdate=e.onBlacklistUpdate||_utils.emptyfn,_listenNetwork(this.onOnline,this.onOffline)},connection.prototype.heartBeat=function(){var e=this,t=!/^ws|wss/.test(e.url)||/mobile/.test(navigator.userAgent);if(!this.heartBeatID&&t){var o={toJid:this.domain,type:"normal"};this.heartBeatID=setInterval(function(){e.ping(o)},this.heartBeatWait)}},connection.prototype.stopHeartBeat=function(){"number"==typeof this.heartBeatID&&(this.heartBeatID=clearInterval(this.heartBeatID))},connection.prototype.sendReceiptsMessage=function(e){var t=$msg({from:this.context.jid||"",to:this.domain,id:e.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:e.id||""});this.sendCommand(t.tree())},connection.prototype.cacheReceiptsMessage=function(e){this.sendQueue.push(e)},connection.prototype.getStrophe=function(){if("https:"!=location.protocol&&WebIM.config.isHttpDNS){var e="",t=this.xmppHosts[this.xmppIndex],o=_utils.getXmlFirstChild(t,"domain"),n=_utils.getXmlFirstChild(t,"ip");if(n){e=n.textContent;var i=_utils.getXmlFirstChild(t,"port");"80"!=i.textContent&&(e+=":"+i.textContent)}else e=o.textContent;if(""!=e){var r=/(.+\/\/).+(\/.+)/;this.url=this.url.replace(r,"$1"+e+"$2")}}var s=new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime});return s},connection.prototype.getHostsByTag=function(e,t){var o=_utils.getXmlFirstChild(e,t);if(!o)return console.log(t+" hosts error"),null;var n=o.getElementsByTagName("hosts");return 0==n.length?(console.log(t+" hosts error2"),null):n[0].getElementsByTagName("host")},connection.prototype.getRestFromHttpDNS=function(e,t){if(this.restIndex>this.restTotal)return void console.log("rest hosts all tried,quit");var o="",n=this.restHosts[this.restIndex],i=_utils.getXmlFirstChild(n,"domain"),r=_utils.getXmlFirstChild(n,"ip");if(r){var s=_utils.getXmlFirstChild(n,"port");o=("https:"===location.protocol?"https:":"http:")+"//"+r.textContent+":"+s.textContent}else o=("https:"===location.protocol?"https:":"http:")+"//"+i.textContent;""!=o&&(WebIM.config.apiURL=o,e.apiUrl=o),"login"==t?this.login(e):this.signup(e)},connection.prototype.getHttpDNS=function(e,t){if(this.restHosts)return void this.getRestFromHttpDNS(e,t);var o=this,n=function(n,i){n=(new DOMParser).parseFromString(n,"text/xml").documentElement;var r=o.getHostsByTag(n,"rest");if(!r)return void console.log("rest hosts error3");o.restHosts=r,o.restTotal=r.length;var s=o.getHostsByTag(n,"xmpp");return s?(o.xmppHosts=s,o.xmppTotal=s.length,void o.getRestFromHttpDNS(e,t)):void console.log("xmpp hosts error3")},i=function(n,i,r){console.log("getHttpDNS error",n,r),o.dnsIndex++,o.dnsIndex<o.dnsTotal&&o.getHttpDNS(e,t)},r={url:this.dnsArr[this.dnsIndex]+"/easemob/server.xml",dataType:"text",type:"GET",data:{app_key:encodeURIComponent(e.appKey)},success:n||_utils.emptyfn,error:i||_utils.emptyfn};_utils.ajax(r)},connection.prototype.signup=function(e){var t=this,o=e.orgName||"",n=e.appName||"",i=e.appKey||"",r=e.success||EMPTYFN,s=e.error||EMPTYFN;if(!o&&!n&&i){var a=i.split("#");2===a.length&&(o=a[0],n=a[1])}if(!o&&!n)return void s({type:_code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR});var c=function(o,n,i){return"https:"!=location.protocol&&WebIM.config.isHttpDNS&&t.restIndex+1<t.restTotal?(t.restIndex++,void t.getRestFromHttpDNS(e,"signup")):(t.clear(),void s(o))},p=e.https||p,l=e.apiUrl,u=l+"/"+o+"/"+n+"/users",d={username:e.username,password:e.password,nickname:e.nickname||""},m=_utils.stringify(d),h={url:u,dataType:"json",data:m,success:r,error:c};_utils.ajax(h)},connection.prototype.open=function(e){"https:"!=location.protocol&&WebIM.config.isHttpDNS?(this.dnsIndex=0,this.getHttpDNS(e,"login")):this.login(e)},connection.prototype.login=function(e){var t=_validCheck(e,this);if(t){var o=this;if(!o.isOpened())if(e.accessToken)e.access_token=e.accessToken,_login(e,o);else{var n=e.apiUrl,i=this.context.userId,r=e.pwd||"",s=this.context.appName,a=this.context.orgName,c=function(e,t){o.context.status=_code.STATUS_DOLOGIN_IM,o.context.restTokenData=e,_login(e,o)},p=function(t,n,i){return"https:"!=location.protocol&&WebIM.config.isHttpDNS&&o.restIndex+1<o.restTotal?(o.restIndex++,void o.getRestFromHttpDNS(e,"login")):(o.clear(),void(t.error&&t.error_description?o.onError({type:_code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,data:t,xhr:n}):o.onError({type:_code.WEBIM_CONNCTION_OPEN_ERROR,data:t,xhr:n})))};this.context.status=_code.STATUS_DOLOGIN_USERGRID;var l={grant_type:"password",username:i,password:r,timestamp:+new Date},u=_utils.stringify(l),d={url:n+"/"+a+"/"+s+"/token",dataType:"json",data:u,success:c||_utils.emptyfn,error:p||_utils.emptyfn};_utils.ajax(d)}}},connection.prototype.attach=function(e){var t=_validCheck(e,this);if(t){e=e||{};var o=e.accessToken||"";if(""==o)return void this.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR});var n=e.sid||"";if(""===n)return void this.onError({type:_code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR});var i=e.rid||"";if(""===i)return void this.onError({type:_code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR});var r=this.getStrophe();this.context.accessToken=o,this.context.stropheConn=r,this.context.status=_code.STATUS_DOLOGIN_IM;var s=this,a=function(e,t){_loginCallback(e,t,s)},c=this.context.jid,p=this.wait,l=this.hold,u=this.wind||5;r.attach(c,n,i,a,p,l,u)}},connection.prototype.close=function(e){this.stopHeartBeat();var t=this.context.status;t!=_code.STATUS_INIT&&(this.isClosed()||this.isClosing()||(this.context.status=_code.STATUS_CLOSING,this.context.stropheConn.disconnect(e)))},connection.prototype.addHandler=function(e,t,o,n,i,r,s){this.context.stropheConn.addHandler(e,t,o,n,i,r,s)},connection.prototype.notifyVersion=function(e,t){var o=(_getJid({},this),$iq({from:this.context.jid||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("easemob").up().c("version").t(_version).up().c("os").t("webim")),e=e||_utils.emptyfn,n=t||this.onError,i=function(e){n({type:_code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR,data:e})};this.context.stropheConn.sendIQ(o.tree(),e,i)},connection.prototype.handlePresence=function(e){if(!this.isClosed()){var t=e.getAttribute("from")||"",o=e.getAttribute("to")||"",n=e.getAttribute("type")||"",i=e.getAttribute("presence_type")||"",r=_parseNameFromJidFn(t),s=_parseNameFromJidFn(o),a={from:r,to:s,fromJid:t,toJid:o,type:n,chatroom:!!e.getElementsByTagName("roomtype").length},c=e.getElementsByTagName("show");if(c&&c.length>0){var p=c[0];a.show=Strophe.getText(p)}var l=e.getElementsByTagName("status");if(l&&l.length>0){var u=l[0];a.status=Strophe.getText(u),a.code=u.getAttribute("code")}var d=e.getElementsByTagName("priority");if(d&&d.length>0){var m=d[0];a.priority=Strophe.getText(m)}var h=e.getElementsByTagName("error");if(h&&h.length>0){var h=h[0];a.error={code:h.getAttribute("code")}}var f=e.getElementsByTagName("destroy");if(f&&f.length>0){var f=f[0];a.destroy=!0;var _=f.getElementsByTagName("reason");_&&_.length>0&&(a.reason=Strophe.getText(_[0]))}var y=e.getElementsByTagName("item");if(y&&y.length>0){var g=y[0],E=g.getAttribute("role"),O=g.getAttribute("jid");if("none"==E&&O){var I=_parseNameFromJidFn(O),N=g.getElementsByTagName("actor")[0],v=N.getAttribute("nick");a.actor=v,a.kicked=I}"moderator"==E&&"201"==a.code&&(a.type="joinPublicGroupSuccess")}var R=e.getElementsByTagName("apply");if(R&&R.length>0){R=R[0];var T=R.getAttribute("toNick"),C=R.getAttribute("to"),x=R.getAttribute("from"),b=_parseNameFromJidFn(C);_parseNameFromJidFn(x);a.toNick=T,a.groupName=b,a.type="joinGroupNotifications";var _=R.getElementsByTagName("reason");_&&_.length>0&&(a.reason=Strophe.getText(_[0]))}if(a.chatroom){a.presence_type=i,a.original_type=a.type;var M=t.slice(t.lastIndexOf("/")+1);M===this.context.userId&&(""!==a.type||a.code?"unavailable"!==i&&"unavailable"!==a.type||(a.status?110==a.code?a.type="leaveChatRoom":a.error&&406==a.error.code&&(a.type="reachChatRoomCapacity"):a.type="leaveChatRoom"):a.type="joinChatRoomSuccess")}else a.presence_type=i,a.original_type=n,/subscribe/.test(a.type)||(""!=n||a.status||a.error?"unavailable"!==i&&"unavailable"!==n||(a.destroy?a.type="deleteGroupChat":307!=a.code&&321!=a.code||(a.type="leaveGroup")):a.type="joinPublicGroupSuccess");this.onPresence(a,e)}},connection.prototype.handlePing=function(e){if(!this.isClosed()){var t=e.getAttribute("id"),o=e.getAttribute("from"),n=e.getAttribute("to"),i=$iq({from:n,to:o,id:t,type:"result"});this.sendCommand(i.tree())}},connection.prototype.handleIq=function(e){return!0},connection.prototype.handleIqPrivacy=function(e){var t=e.getElementsByTagName("list");0!=t.length&&this.getBlacklist()},connection.prototype.handleIqRoster=function(e){var t=e.getAttribute("id"),o=e.getAttribute("from")||"",n=(_parseNameFromJidFn(o),this.context.jid),i=(this.context.userId,$iq({type:"result",id:t,from:n}));this.sendCommand(i.tree());var r=e.getElementsByTagName("query");if(r&&r.length>0){var s=r[0],a=_parseFriend(s,this,o);this.onRoster(a)}return!0},connection.prototype.handleMessage=function(e){if(!this.isClosed()){var t=e.getAttribute("id")||"";this.cacheReceiptsMessage({id:t});var o=_parseResponseMessage(e);if(o.errorMsg)return void this.handlePresence(e);var n=e.getElementsByTagName("error"),i="",r="",s=!1;if(n.length>0){s=!0,i=n[0].getAttribute("code");var a=n[0].getElementsByTagName("text");r=a[0].textContent||a[0].text,log("handle error",i,r)}var c=o.data;for(var p in c)if(c.hasOwnProperty(p)){var l=c[p];if(l.from&&l.to){var u=(l.from+"").toLowerCase(),d=(l.to+"").toLowerCase(),m=l.ext||{},h="",f=e.getElementsByTagName("roomtype");h=f.length?f[0].getAttribute("type")||"chat":e.getAttribute("type")||"chat";var _=l.bodies;if(_&&0!=_.length){var y=l.bodies[0],g=y.type;try{switch(g){case"txt":var E=y.msg,O=_utils.parseTextMessage(E,WebIM.Emoji);if(O.isemoji){var l={id:t,type:h,from:u,to:d,delay:o.delayTimeStamp,data:O.body,ext:m};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onEmojiMessage(l)}else{var l={id:t,type:h,from:u,to:d,delay:o.delayTimeStamp,data:E,ext:m};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onTextMessage(l)}break;case"img":var I=0,N=0;y.size&&(I=y.size.width,N=y.size.height);var l={id:t,type:h,from:u,to:d,url:"https:"!=location.protocol&&WebIM.config.isHttpDNS?WebIM.config.apiURL+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,thumb:y.thumb,thumb_secret:y.thumb_secret,file_length:y.file_length||"",width:I,height:N,filetype:y.filetype||"",accessToken:this.context.accessToken||"",ext:m,delay:o.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onPictureMessage(l);break;case"audio":var l={id:t,type:h,from:u,to:d,url:"https:"!=location.protocol&&WebIM.config.isHttpDNS?WebIM.config.apiURL+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,length:y.length||"",file_length:y.file_length||"",filetype:y.filetype||"",accessToken:this.context.accessToken||"",ext:m,delay:o.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onAudioMessage(l);break;case"file":var l={id:t,type:h,from:u,to:d,url:"https:"!=location.protocol&&WebIM.config.isHttpDNS?WebIM.config.apiURL+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,file_length:y.file_length,accessToken:this.context.accessToken||"",ext:m,delay:o.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onFileMessage(l);break;case"loc":var l={id:t,type:h,from:u,to:d,addr:y.addr,lat:y.lat,lng:y.lng,ext:m,delay:o.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onLocationMessage(l);break;case"video":var l={id:t,type:h,from:u,to:d,url:"https:"!=location.protocol&&WebIM.config.isHttpDNS?WebIM.config.apiURL+y.url.substr(y.url.indexOf("/",9)):y.url,secret:y.secret,filename:y.filename,file_length:y.file_length,accessToken:this.context.accessToken||"",ext:m,delay:o.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onVideoMessage(l);break;case"cmd":var l={id:t,from:u,to:d,action:y.action,ext:m,delay:o.delayTimeStamp};!l.delay&&delete l.delay,l.error=s,l.errorText=r,l.errorCode=i,this.onCmdMessage(l)}}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}}}}},connection.prototype.handleReceivedMessage=function(e){try{this.onReceivedMessage(e)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}var t,o,n=e.getElementsByTagName("received");if(n.length>0&&(t=n[0].childNodes&&n[0].childNodes.length>0?n[0].childNodes[0].nodeValue:n[0].innerHTML||n[0].innerText,o=n[0].getAttribute("mid")),_msgHash[t]){try{_msgHash[t].msg.success instanceof Function&&_msgHash[t].msg.success(t,o)}catch(e){this.onError({type:_code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}delete _msgHash[t]}},connection.prototype.handleInviteMessage=function(e){var t=null,o=e.getElementsByTagName("invite"),n=e.getElementsByTagName("reason")[0],i=n.textContent,r=e.getAttribute("id")||"";if(this.sendReceiptsMessage({id:r}),o&&o.length>0){var s=o[0].getAttribute("from");t=_parseNameFromJidFn(s)}var a=e.getElementsByTagName("x"),c=null;if(a&&a.length>0)for(var p=0;p<a.length;p++)if("jabber:x:conference"===a[p].namespaceURI){var l=a[p].getAttribute("jid");c=_parseNameFromJidFn(l)}this.onInviteMessage({type:"invite",from:t,roomid:c,reason:i})},connection.prototype.sendCommand=function(e,t){this.isOpened()?this.context.stropheConn.send(e):this.onError({type:_code.WEBIM_CONNCTION_DISCONNECTED,reconnect:!0})},connection.prototype.getUniqueId=function(e){var t=new Date,o=new Date(2010,1,1),n=t.getTime()-o.getTime(),i=parseInt(n).toString(16);return"string"==typeof e||"number"==typeof e?e+"_"+i:"WEBIM_"+i},connection.prototype.send=function(e){if(WebIM.config.isWindowSDK)WebIM.doQuery('{"type":"sendMessage","to":"'+e.to+'","message_type":"'+e.type+'","msg":"'+encodeURI(e.msg)+'","chatType":"'+e.chatType+'"}',function(e){},function(e,t){Demo.api.NotifyError("send:"+e+" - "+t)});else if("[object Object]"===Object.prototype.toString.call(e)){var t=this.context.appKey||"",o=t+"_"+e.to+"@"+this.domain;e.group&&(o=t+"_"+e.to+"@conference."+this.domain),e.resource&&(o=o+"/"+e.resource),e.toJid=o,e.id=e.id||this.getUniqueId(),_msgHash[e.id]=new _message(e),_msgHash[e.id].send(this)}else"string"==typeof e&&_msgHash[e]&&_msgHash[e].send(this)},connection.prototype.addRoster=function(e){var t=_getJid(e,this),o=e.name||"",n=e.groups||"",i=$iq({type:"set"});if(i.c("query",{xmlns:"jabber:iq:roster"}),i.c("item",{jid:t,name:o}),n)for(var r=0;r<n.length;r++)i.c("group").t(n[r]).up();var s=e.success||_utils.emptyfn,a=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(i.tree(),s,a)},connection.prototype.removeRoster=function(e){var t=_getJid(e,this),o=$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:t,subscription:"remove"}),n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn;this.context.stropheConn.sendIQ(o,n,i)},connection.prototype.getRoster=function(e){var t=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"}),e=e||{},o=e.success||this.onRoster,n=function(e){var t=[],n=e.getElementsByTagName("query");if(n&&n.length>0){var i=n[0];t=_parseFriend(i)}o(t,e)},i=e.error||this.onError,r=function(e){i({type:_code.WEBIM_CONNCTION_GETROSTER_ERROR,data:e})};this.isOpened()?this.context.stropheConn.sendIQ(t.tree(),n,r):i({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.subscribe=function(e){var t=_getJid(e,this),o=$pres({to:t,type:"subscribe"});e.message&&o.c("status").t(e.message).up(),e.nick&&o.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(e.nick),this.sendCommand(o.tree())},connection.prototype.subscribed=function(e){var t=_getJid(e,this),o=$pres({to:t,type:"subscribed"});e.message&&o.c("status").t(e.message).up(),this.sendCommand(o.tree())},connection.prototype.unsubscribe=function(e){var t=_getJid(e,this),o=$pres({to:t,type:"unsubscribe"});e.message&&o.c("status").t(e.message),this.sendCommand(o.tree())},connection.prototype.unsubscribed=function(e){var t=_getJid(e,this),o=$pres({to:t,type:"unsubscribed"});e.message&&o.c("status").t(e.message).up(),this.sendCommand(o.tree())},connection.prototype.createRoom=function(e){var t,o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn;return t=$iq({to:e.roomName,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this.context.stropheConn.sendIQ(t.tree(),o,n)},connection.prototype.joinPublicGroup=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,o=t+"/"+this.context.userId,n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=function(e){i({type:_code.WEBIM_CONNCTION_JOINROOM_ERROR,data:e})},s=$pres({from:this.context.jid,to:o}).c("x",{xmlns:Strophe.NS.MUC});this.context.stropheConn.sendIQ(s.tree(),n,r)},connection.prototype.listRooms=function(e){var t=$iq({to:e.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),o=e.success||_utils.emptyfn,n=e.error||this.onError,i=function(e){var t=[];t=_parseRoom(e);try{o(t)}catch(e){n({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})}},r=e.error||_utils.emptyfn,s=function(e){r({type:_code.WEBIM_CONNCTION_GETROOM_ERROR,data:e})};this.context.stropheConn.sendIQ(t.tree(),i,s)},connection.prototype.queryRoomMember=function(e){var t=(this.domain,[]),o=$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"}),n=e.success||_utils.emptyfn,i=function(e){var o=e.getElementsByTagName("item");if(o)for(var i=0;i<o.length;i++){var r=o[i],s={jid:r.getAttribute("jid"),affiliation:"member"};t.push(s)}n(t)},r=e.error||_utils.emptyfn,s=function(e){r({type:_code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR,data:e})};this.context.stropheConn.sendIQ(o.tree(),i,s)},connection.prototype.queryRoomInfo=function(e){var t=this.domain,o=$iq({to:this.context.appKey+"_"+e.roomId+"@conference."+t,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO}),n=e.success||_utils.emptyfn,i=[],r=function(e){var o="",r=e.getElementsByTagName("feature");switch(r&&(o=r[1].getAttribute("var")+"|"+r[3].getAttribute("var")+"|"+r[4].getAttribute("var")),o){case"muc_public|muc_membersonly|muc_notallowinvites":o="PUBLIC_JOIN_APPROVAL";break;case"muc_public|muc_open|muc_notallowinvites":o="PUBLIC_JOIN_OPEN";break;case"muc_hidden|muc_membersonly|muc_allowinvites":o="PRIVATE_MEMBER_INVITE";break;case"muc_hidden|muc_membersonly|muc_notallowinvites":o="PRIVATE_OWNER_INVITE"}var s=e.getElementsByTagName("field"),a={};if(s){for(var c=0;c<s.length;c++){var p=s[c],l=p.getAttribute("var"),u=l.split("_")[1];switch(l){case"muc#roominfo_occupants":case"muc#roominfo_maxusers":case"muc#roominfo_affiliations":case"muc#roominfo_description":a[u]=p.textContent||p.text||"";break;case"muc#roominfo_owner":var d={jid:(p.textContent||p.text)+"@"+t,affiliation:"owner"};i.push(d),a[u]=p.textContent||p.text}}a.name=e.getElementsByTagName("identity")[0].getAttribute("name")}log(o,i,a),n(o,i,a)},s=e.error||_utils.emptyfn,a=function(e){s({type:_code.WEBIM_CONNCTION_GETROOMINFO_ERROR,data:e})};this.context.stropheConn.sendIQ(o.tree(),r,a)},connection.prototype.queryRoomOccupants=function(e){var t=e.success||_utils.emptyfn,o=function(e){var o=[];o=_parseRoomOccupants(e),t(o)},n=e.error||_utils.emptyfn,i=function(e){n({type:_code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR,data:e})},r={xmlns:Strophe.NS.DISCO_ITEMS},s=$iq({from:this.context.jid,to:this.context.appKey+"_"+e.roomId+"@conference."+this.domain,type:"get"}).c("query",r);this.context.stropheConn.sendIQ(s.tree(),o,i)},connection.prototype.setUserSig=function(e){var t=$pres({xmlns:"jabber:client"});e=e||"",t.c("status").t(e),this.sendCommand(t.tree())},connection.prototype.setPresence=function(e,t){var o=$pres({xmlns:"jabber:client"});e&&(t?(o.c("show").t(e),o.up().c("status").t(t)):o.c("show").t(e)),
	this.sendCommand(o.tree())},connection.prototype.getPresence=function(){var e=$pres({xmlns:"jabber:client"});this.sendCommand(e.tree())},connection.prototype.ping=function(e){var e=e||{},t=_getJid(e,this),o=$iq({from:this.context.jid||"",to:t,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"}),n=e.success||_utils.emptyfn,i=e.error||this.onError,r=function(e){i({type:_code.WEBIM_CONNCTION_PING_ERROR,data:e})};this.isOpened()?this.context.stropheConn.sendIQ(o.tree(),n,r):i({type:_code.WEBIM_CONNCTION_DISCONNECTED})},connection.prototype.isOpened=function(){return this.context.status==_code.STATUS_OPENED},connection.prototype.isOpening=function(){var e=this.context.status;return e==_code.STATUS_DOLOGIN_USERGRID||e==_code.STATUS_DOLOGIN_IM},connection.prototype.isClosing=function(){return this.context.status==_code.STATUS_CLOSING},connection.prototype.isClosed=function(){return this.context.status==_code.STATUS_CLOSED},connection.prototype.clear=function(){var e=this.context.appKey;this.errorType!=WebIM.statusCode.WEBIM_CONNCTION_DISCONNECTED&&(this.context={status:_code.STATUS_INIT,appKey:e}),this.intervalId&&clearInterval(this.intervalId),this.restIndex=0,this.xmppIndex=0,this.errorType!=WebIM.statusCode.WEBIM_CONNCTION_CLIENT_LOGOUT&&this.errorType!=-1||Demo.api.init()},connection.prototype.getChatRooms=function(e){if(!_utils.isCanSetRequestHeader)return void t.onError({type:_code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR});var t=this,o=e.accessToken||this.context.accessToken;if(o){var n=e.apiUrl,i=this.context.appName,r=this.context.orgName;if(!i||!r)return void t.onError({type:_code.WEBIM_CONNCTION_AUTH_ERROR});var s=function(t,o){"function"==typeof e.success&&e.success(t)},a=function(e,o,n){e.error&&e.error_description&&t.onError({type:_code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,msg:e.error_description,data:e,xhr:o})},c={pagenum:parseInt(e.pagenum)||1,pagesize:parseInt(e.pagesize)||20},p={url:n+"/"+r+"/"+i+"/chatrooms",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+o},data:c,success:s||_utils.emptyfn,error:a||_utils.emptyfn};_utils.ajax(p)}else t.onError({type:_code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR})},connection.prototype.joinChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,o=t+"/"+this.context.userId,n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=function(e){i({type:_code.WEBIM_CONNCTION_JOINCHATROOM_ERROR,data:e})},s=$pres({from:this.context.jid,to:o}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(s.tree(),n,r)},connection.prototype.quitChatRoom=function(e){var t=this.context.appKey+"_"+e.roomId+"@conference."+this.domain,o=t+"/"+this.context.userId,n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=function(e){i({type:_code.WEBIM_CONNCTION_QUITCHATROOM_ERROR,data:e})},s=$pres({from:this.context.jid,to:o,type:"unavailable"}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(s.tree(),n,r)},connection.prototype._onReceiveInviteFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation",msg:info.user+" invites you to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){Demo.api.NotifyError("acceptInvitationFromGroup error:"+t)})},reject:function(){WebIM.doQuery('{"type":"declineInvitationFromGroup","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){Demo.api.NotifyError("declineInvitationFromGroup error:"+t)})}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" agreed to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveInviteDeclineFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation response",msg:info.user+" rejected to join into group:"+info.group_id,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onAutoAcceptInvitationFromGroup=function(info){info=eval("("+info+")");var options={title:"Group invitation",msg:"You had joined into the group:"+info.group_name+" automatically.Inviter:"+info.user,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onLeaveGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been out of the group:"+info.group_id+".Reason:"+info.msg,agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveJoinGroupApplication=function(info){info=eval("("+info+")");var options={title:"Group join application",msg:info.user+" applys to join into group:"+info.group_id,agree:function(){WebIM.doQuery('{"type":"acceptJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){Demo.api.NotifyError("acceptJoinGroupApplication error:"+t)})},reject:function(){WebIM.doQuery('{"type":"declineJoinGroupApplication","id":"'+info.group_id+'","user":"'+info.user+'"}',function(e){},function(e,t){Demo.api.NotifyError("declineJoinGroupApplication error:"+t)})}};this.onConfirmPop(options)},connection.prototype._onReceiveAcceptionFromGroup=function(info){info=eval("("+info+")");var options={title:"Group notification",msg:"You had joined into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onReceiveRejectionFromGroup=function(){info=eval("("+info+")");var options={title:"Group notification",msg:"You have been rejected to join into the group:"+info.group_name+".",agree:function(){}};this.onConfirmPop(options)},connection.prototype._onUpdateMyGroupList=function(e){this.onUpdateMyGroupList(e)},connection.prototype._onUpdateMyRoster=function(e){this.onUpdateMyRoster(e)},connection.prototype.reconnect=function(){var e=this;setTimeout(function(){_login(e.context.restTokenData,e)},1e3*(0==this.autoReconnectNumTotal?0:this.autoReconnectInterval)),this.autoReconnectNumTotal++},connection.prototype.closed=function(){Demo.api.init()},connection.prototype.getBlacklist=function(e){e=e||{};var t=$iq({type:"get"}),o=e.success||_utils.emptyfn,n=e.error||_utils.emptyfn,i=this;t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),this.context.stropheConn.sendIQ(t.tree(),function(e){i.onBlacklistUpdate(_parsePrivacy(e)),o()},function(){i.onBlacklistUpdate([]),n()})},connection.prototype.addToBlackList=function(e){for(var t=$iq({type:"set"}),o=e.list||{},n=e.type||"jid",i=e.success||_utils.emptyfn,r=e.error||_utils.emptyfn,s=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),a=Object.keys(o),c=a.length,p=2,l=0;l<c;l++){var u=o[a[l]],n=u.type||"jid",d=u.jid;s=s.c("item",{action:"deny",order:p++,type:n,value:d}).c("message"),l!==c-1&&(s=s.up().up())}this.context.stropheConn.sendIQ(s.tree(),i,r)},connection.prototype.removeFromBlackList=function(e){for(var t=$iq({type:"set"}),o=e.list||{},n=e.success||_utils.emptyfn,i=e.error||_utils.emptyfn,r=t.c("query",{xmlns:"jabber:iq:privacy"}).c("list",{name:"special"}),s=Object.keys(o),a=s.length,c=0;c<a;c++){var p=o[s[c]],l=p.type||"jid",u=p.jid,d=p.order;r=r.c("item",{action:"deny",order:d,type:l,value:u}).c("message"),c!==a-1&&(r=r.up().up())}this.context.stropheConn.sendIQ(r.tree(),n,i)},connection.prototype._getGroupJid=function(e){var t=this.context.appKey||"";return t+"_"+e+"@conference."+this.domain},connection.prototype.addToGroupBlackList=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=_getJid(e,this),i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r});s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}).c("item",{affiliation:"outcast",jid:n}),this.context.stropheConn.sendIQ(s.tree(),t,o)},connection.prototype.getGroupBlacklist=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n="admin",i=this._getGroupJid(e.roomId),r=$iq({type:"get",to:i});r.c("query",{xmlns:"http://jabber.org/protocol/muc#"+n}).c("item",{affiliation:"outcast"}),this.context.stropheConn.sendIQ(r.tree(),function(e){log("getGroupBlackList"),t(_parseGroupBlacklist(e))},function(){o()})},connection.prototype.removeGroupMemberFromBlacklist=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=_getJid(e,this),i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r});s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}).c("item",{affiliation:"member",jid:n}),this.context.stropheConn.sendIQ(s.tree(),function(e){t()},function(){o()})},connection.prototype.changeGroupSubject=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n="owner",i=this._getGroupJid(e.roomId),r=$iq({type:"set",to:i});r.c("query",{xmlns:"http://jabber.org/protocol/muc#"+n}).c("x",{type:"submit",xmlns:"jabber:x:data"}).c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up().c("field",{var:"muc#roomconfig_roomname"}).c("value").t(e.subject).up().up().c("field",{var:"muc#roomconfig_roomdesc"}).c("value").t(e.description),this.context.stropheConn.sendIQ(r.tree(),function(e){t()},function(){o()})},connection.prototype.destroyGroup=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n="owner",i=this._getGroupJid(e.roomId),r=$iq({type:"set",to:i});r.c("query",{xmlns:"http://jabber.org/protocol/muc#"+n}).c("destroy").c("reason").t(e.reason||""),this.context.stropheConn.sendIQ(r.tree(),function(e){t()},function(){o()})},connection.prototype.leaveGroupBySelf=function(e){var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=_getJid(e,this),i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r});s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}).c("item",{affiliation:"none",jid:n}),this.context.stropheConn.sendIQ(s.tree(),function(e){t(e)},function(e){o(e)})},connection.prototype.leaveGroup=function(e){for(var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=e.list||[],i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r}),a=s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}),c=Object.keys(n),p=c.length,l=0;l<p;l++){var u=n[c[l]],d=_getJidByName(u,this);a=a.c("item",{affiliation:"none",jid:d}).up().c("item",{role:"none",jid:d}).up()}this.context.stropheConn.sendIQ(s.tree(),function(e){t(e)},function(e){o(e)})},connection.prototype.addGroupMembers=function(e){for(var t=e.success||_utils.emptyfn,o=e.error||_utils.emptyfn,n=e.list||[],i="admin",r=this._getGroupJid(e.roomId),s=$iq({type:"set",to:r}),a=s.c("query",{xmlns:"http://jabber.org/protocol/muc#"+i}),c=n.length,p=0;p<c;p++){var l=n[p],u=_getJidByName(l,this);a=a.c("item",{affiliation:"member",jid:u}).up();var d=$msg({to:r}).c("x",{xmlns:"http://jabber.org/protocol/muc#user"}).c("invite",{to:u}).c("reason").t(e.reason||"");this.sendCommand(d.tree())}this.context.stropheConn.sendIQ(s.tree(),function(e){t(e)},function(e){o(e)})},connection.prototype.acceptInviteFromGroup=function(e){e.success=function(){},this.addGroupMembers(e)},connection.prototype.rejectInviteFromGroup=function(e){},connection.prototype.createGroup=function(e){var t=+new Date,o=this._getGroupJid(t),n=o+"/"+this.context.userId,i=$pres({to:n}).c("x",{xmlns:"http://jabber.org/protocol/muc"}).up().c("create",{xmlns:"http://jabber.org/protocol/muc"}).up();this.sendCommand(i.tree());var r=this;setTimeout(function(){var n=$iq({type:"get",to:o}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});r.context.stropheConn.sendIQ(n.tree(),function(n){if("setAttribute"in n){var i=n.getElementsByTagName("x")[0];i.setAttribute("type","submit")}else Strophe.forEachChild(n,"x",function(e){e.setAttribute("type","submit")});Strophe.info("step 5 ----------"),Strophe.forEachChild(i,"field",function(t){var o=t.getAttribute("var"),n=t.getElementsByTagName("value")[0];switch(Strophe.info(o),o){case"muc#roomconfig_roomname":_setText(n,e.subject||"");break;case"muc#roomconfig_roomdesc":_setText(n,e.description||"");break;case"muc#roomconfig_publicroom":_setText(n,+e.optionsPublic);break;case"muc#roomconfig_membersonly":_setText(n,+e.optionsMembersOnly);break;case"muc#roomconfig_moderatedroom":_setText(n,+e.optionsModerate);break;case"muc#roomconfig_persistentroom":_setText(n,1);break;case"muc#roomconfig_allowinvites":_setText(n,+e.optionsAllowInvites);break;case"muc#roomconfig_allowvisitornickchange":_setText(n,0);break;case"muc#roomconfig_allowvisitorstatus":_setText(n,0);break;case"allow_private_messages":_setText(n,0);break;case"allow_private_messages_from_visitors":_setText(n,"nobody")}});var s=$iq({to:o,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).cnode(i);r.context.stropheConn.sendIQ(s.tree(),function(o){r.addGroupMembers({list:e.members,roomId:t})},function(e){})},function(e){})},1e3)};var WebIM=window.WebIM||{};WebIM.connection=connection,WebIM.utils=_utils,WebIM.statusCode=_code,WebIM.message=_msg.message,WebIM.doQuery=function(e,t,o){"undefined"!=typeof window.cefQuery&&window.cefQuery({request:e,persistent:!1,onSuccess:t,onFailure:o})},module.exports=WebIM},function(e,t){!function(){var e=0,o=100,n=200,i=300,r=400;t.code={WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_OPEN_ERROR:e++,WEBIM_CONNCTION_AUTH_ERROR:e++,WEBIM_CONNCTION_OPEN_USERGRID_ERROR:e++,WEBIM_CONNCTION_ATTACH_ERROR:e++,WEBIM_CONNCTION_ATTACH_USERGRID_ERROR:e++,WEBIM_CONNCTION_REOPEN_ERROR:e++,WEBIM_CONNCTION_SERVER_CLOSE_ERROR:e++,WEBIM_CONNCTION_SERVER_ERROR:e++,WEBIM_CONNCTION_IQ_ERROR:e++,WEBIM_CONNCTION_PING_ERROR:e++,WEBIM_CONNCTION_NOTIFYVERSION_ERROR:e++,WEBIM_CONNCTION_GETROSTER_ERROR:e++,WEBIM_CONNCTION_CROSSDOMAIN_ERROR:e++,WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES:e++,WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR:e++,WEBIM_CONNCTION_DISCONNECTED:e++,WEBIM_CONNCTION_AJAX_ERROR:e++,WEBIM_CONNCTION_JOINROOM_ERROR:e++,WEBIM_CONNCTION_GETROOM_ERROR:e++,WEBIM_CONNCTION_GETROOMINFO_ERROR:e++,WEBIM_CONNCTION_GETROOMMEMBER_ERROR:e++,WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR:e++,WEBIM_CONNCTION_LOAD_CHATROOM_ERROR:e++,WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR:e++,WEBIM_CONNCTION_JOINCHATROOM_ERROR:e++,WEBIM_CONNCTION_QUITCHATROOM_ERROR:e++,WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR:e++,WEBIM_CONNCTION_CALLBACK_INNER_ERROR:e++,WEBIM_CONNCTION_CLIENT_OFFLINE:e++,WEBIM_CONNCTION_CLIENT_LOGOUT:e++,WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR:e++,WEBIM_UPLOADFILE_BROWSER_ERROR:o++,WEBIM_UPLOADFILE_ERROR:o++,WEBIM_UPLOADFILE_NO_LOGIN:o++,WEBIM_UPLOADFILE_NO_FILE:o++,WEBIM_DOWNLOADFILE_ERROR:n++,WEBIM_DOWNLOADFILE_NO_LOGIN:n++,WEBIM_DOWNLOADFILE_BROWSER_ERROR:n++,WEBIM_MESSAGE_REC_TEXT:i++,WEBIM_MESSAGE_REC_TEXT_ERROR:i++,WEBIM_MESSAGE_REC_EMOTION:i++,WEBIM_MESSAGE_REC_PHOTO:i++,WEBIM_MESSAGE_REC_AUDIO:i++,WEBIM_MESSAGE_REC_AUDIO_FILE:i++,WEBIM_MESSAGE_REC_VEDIO:i++,WEBIM_MESSAGE_REC_VEDIO_FILE:i++,WEBIM_MESSAGE_REC_FILE:i++,WEBIM_MESSAGE_SED_TEXT:i++,WEBIM_MESSAGE_SED_EMOTION:i++,WEBIM_MESSAGE_SED_PHOTO:i++,WEBIM_MESSAGE_SED_AUDIO:i++,WEBIM_MESSAGE_SED_AUDIO_FILE:i++,WEBIM_MESSAGE_SED_VEDIO:i++,WEBIM_MESSAGE_SED_VEDIO_FILE:i++,WEBIM_MESSAGE_SED_FILE:i++,STATUS_INIT:r++,STATUS_DOLOGIN_USERGRID:r++,STATUS_DOLOGIN_IM:r++,STATUS_OPENED:r++,STATUS_CLOSING:r++,STATUS_CLOSED:r++,STATUS_ERROR:r++}}()},function(e,t,o){!function(){var e=function(){},n=o(2).code,i=10485760,r=function(){try{return new window.XMLHttpRequest}catch(e){return!1}},s=function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},a=function(t){t=t||!0;var o=r()||s();if("withCredentials"in o)return o;if(!t)return o;if("undefined"==typeof window.XDomainRequest)return o;var n=new XDomainRequest;return n.readyState=0,n.status=100,n.onreadystatechange=e,n.onload=function(){n.readyState=4,n.status=200;var e=new ActiveXObject("Microsoft.XMLDOM");e.async="false",e.loadXML(n.responseText),n.responseXML=e,n.response=n.responseText,n.onreadystatechange()},n.ontimeout=n.onerror=function(){n.readyState=4,n.status=500,n.onreadystatechange()},n},c=function(){if("ActiveXObject"in window)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){return 0}else if(navigator.plugins&&navigator.plugins.length>0)return navigator.plugins["Shockwave Flash"];return 0}(),p=a(),l="undefined"!=typeof FormData,u="undefined"!=typeof Blob,d=p.setRequestHeader||!1,m=p.overrideMimeType||!1,h=d&&l,f=h||c,_=d&&(u||m);Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=o.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var r,s,a=[];for(r in i)e.call(i,r)&&a.push(r);if(t)for(s=0;s<n;s++)e.call(i,o[s])&&a.push(o[s]);return a}}());var y={hasFormData:l,hasBlob:u,emptyfn:e,isCanSetRequestHeader:d,hasOverrideMimeType:m,isCanUploadFileAsync:h,isCanUploadFile:f,isCanDownLoadFile:_,isSupportWss:function(){var e=[/MQQBrowser[\/]5([.]\d+)?\sTBS/];if(!window.WebSocket)return!1;for(var t=window.navigator.userAgent,o=0,n=e.length;o<n;o++)if(e[o].test(t))return!1;return!0}(),getIEVersion:function(){var e,t=navigator.userAgent,o={4:8,5:9,6:10,7:11};return e=t.match(/MSIE (\d+)/i),e&&e[1]?+e[1]:(e=t.match(/Trident\/(\d+)/i),e&&e[1]?o[e[1]]||null:null)}(),stringify:function(e){if("undefined"!=typeof JSON&&JSON.stringify)return JSON.stringify(e);var t="",o=[],n=function(e){var i=!1;"[object Array]"===Object.prototype.toString.call(e)?(o.push("]","["),i=!0):"[object Object]"===Object.prototype.toString.call(e)&&o.push("}","{");for(var r in e)"[object Null]"===Object.prototype.toString.call(e[r])?e[r]="null":"[object Undefined]"===Object.prototype.toString.call(e[r])&&(e[r]="undefined"),t+=e[r]&&"object"==typeof e[r]?","+(i?"":'"'+r+'":'+(i?'"':""))+n(e[r]):',"'+(i?"":r+'":"')+e[r]+'"';return""!=t&&(t=t.slice(1)),o.pop()+t+o.pop()};return n(e)},registerUser:function(e){"https:"!=location.protocol&&WebIM.config.isHttpDNS?(Demo.conn.dnsIndex=0,Demo.conn.getHttpDNS(e,"signup")):Demo.conn.signup(e)},login:function(t){var t=t||{},o=t.success||e,i=t.error||e,r=t.appKey||"",s=r.split("#");if(2!==s.length)return i({type:n.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR}),!1;var a=s[0],c=s[1],p=p||t.https,l=t.user||"",u=t.pwd||"",d=t.apiUrl,m={grant_type:"password",username:l,password:u,timestamp:+new Date},h=y.stringify(m),t={url:d+"/"+a+"/"+c+"/token",dataType:"json",data:h,success:o,error:i};return y.ajax(t)},getFileUrl:function(e){var t={url:"",filename:"",filetype:"",data:""},o="string"==typeof e?document.getElementById(e):e;if(!y.isCanUploadFileAsync||!o)return t;try{if(window.URL.createObjectURL){var n=o.files;if(n.length>0){var i=n.item(0);t.data=i,t.url=window.URL.createObjectURL(i),t.filename=i.name||""}}else{var i=document.getElementById(e).value;t.url=i;var r=i.lastIndexOf("/"),s=i.lastIndexOf("\\"),a=Math.max(r,s);a<0?t.filename=i:t.filename=i.substring(a+1)}var c=t.filename.lastIndexOf(".");return c!=-1&&(t.filetype=t.filename.substring(c+1).toLowerCase()),t}catch(e){throw e}},getFileSize:function(e){var t=document.getElementById(e),o=0;if(t)if(t.files)t.files.length>0&&(o=t.files[0].size);else if(t.select&&"ActiveXObject"in window){t.select();var n=new ActiveXObject("Scripting.FileSystemObject"),t=n.GetFile(t.value);o=t.Size}return o},hasFlash:c,trim:function(e){return e="string"==typeof e?e:"",e.trim?e.trim():e.replace(/^\s|\s$/g,"")},parseEmoji:function(e){if("undefined"==typeof WebIM.Emoji||"undefined"==typeof WebIM.Emoji.map)return e;var t=WebIM.Emoji;for(var o in t.map)if(t.map.hasOwnProperty(o))for(;e.indexOf(o)>-1;)e=e.replace(o,'<img class="emoji" src="'+t.path+t.map[o]+'" />');return e},parseLink:function(e){var t=/(https?\:\/\/|www\.)([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+)(\:[0-9]{2,4})?\/?((\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\/?)*\??[:_#@*&%0-9a-zA-Z-\/=]*/gm;return e=e.replace(t,function(e){var t=/^https?/gm.test(e);return"<a href='"+(t?e:"//"+e)+"' target='_blank'>"+e+"</a>"})},parseJSON:function(e){if(window.JSON&&window.JSON.parse)return window.JSON.parse(e+"");var t,o=null,n=y.trim(e+"");return n&&!y.trim(n.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(e,n,i,r){return t&&n&&(o=0),0===o?e:(t=i||n,o+=!r-!i,"")}))?Function("return "+n)():Function("Invalid JSON: "+e)()},parseUploadResponse:function(e){return e.indexOf("callback")>-1?e.slice(9,-1):e},parseDownloadResponse:function(e){return e&&e.type&&"application/json"===e.type||0>Object.prototype.toString.call(e).indexOf("Blob")?this.url+"?token=":window.URL.createObjectURL(e)},uploadFile:function(t){var t=t||{};t.onFileUploadProgress=t.onFileUploadProgress||e,t.onFileUploadComplete=t.onFileUploadComplete||e,t.onFileUploadError=t.onFileUploadError||e,t.onFileUploadCanceled=t.onFileUploadCanceled||e;var o=t.accessToken||this.context.accessToken;if(!o)return void t.onFileUploadError({type:n.WEBIM_UPLOADFILE_NO_LOGIN,id:t.id});var r,s,a,c=t.appKey||this.context.appKey||"";if(c&&(a=c.split("#"),r=a[0],s=a[1]),!r&&!s)return void t.onFileUploadError({type:n.WEBIM_UPLOADFILE_ERROR,id:t.id});var p=t.apiUrl,l=p+"/"+r+"/"+s+"/chatfiles";if(!y.isCanUploadFileAsync)return void(y.hasFlash&&"function"==typeof t.flashUpload?t.flashUpload&&t.flashUpload(l,t):t.onFileUploadError({type:n.WEBIM_UPLOADFILE_BROWSER_ERROR,id:t.id}));var u=t.file.data?t.file.data.size:void 0;if(u>i)return void t.onFileUploadError({type:n.WEBIM_UPLOADFILE_ERROR,id:t.id});if(u<=0)return void t.onFileUploadError({type:n.WEBIM_UPLOADFILE_ERROR,id:t.id});var d=y.xmlrequest(),m=function(e){t.onFileUploadError({type:n.WEBIM_UPLOADFILE_ERROR,id:t.id,xhr:d})};d.upload&&d.upload.addEventListener("progress",t.onFileUploadProgress,!1),d.addEventListener?(d.addEventListener("abort",t.onFileUploadCanceled,!1),d.addEventListener("load",function(e){try{var o=y.parseJSON(d.responseText);try{t.onFileUploadComplete(o)}catch(e){t.onFileUploadError({type:n.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:e})}}catch(e){t.onFileUploadError({type:n.WEBIM_UPLOADFILE_ERROR,data:d.responseText,id:t.id,xhr:d})}},!1),d.addEventListener("error",m,!1)):d.onreadystatechange&&(d.onreadystatechange=function(){if(4===d.readyState)if(200===ajax.status)try{var e=y.parseJSON(d.responseText);t.onFileUploadComplete(e)}catch(e){t.onFileUploadError({type:n.WEBIM_UPLOADFILE_ERROR,data:d.responseText,id:t.id,xhr:d})}else t.onFileUploadError({type:n.WEBIM_UPLOADFILE_ERROR,data:d.responseText,id:t.id,xhr:d});else d.abort(),t.onFileUploadCanceled()}),d.open("POST",l),d.setRequestHeader("restrict-access","true"),d.setRequestHeader("Accept","*/*"),d.setRequestHeader("Authorization","Bearer "+o);var h=new FormData;h.append("file",t.file.data),d.send(h)},download:function(t){t.onFileDownloadComplete=t.onFileDownloadComplete||e,t.onFileDownloadError=t.onFileDownloadError||e;var o=t.accessToken||this.context.accessToken;if(!o)return void t.onFileDownloadError({type:n.WEBIM_DOWNLOADFILE_NO_LOGIN,id:t.id});var i=function(e){t.onFileDownloadError({type:n.WEBIM_DOWNLOADFILE_ERROR,id:t.id,xhr:r})};if(!y.isCanDownLoadFile)return void t.onFileDownloadComplete();var r=y.xmlrequest();"addEventListener"in r?(r.addEventListener("load",function(e){t.onFileDownloadComplete(r.response,r)},!1),r.addEventListener("error",i,!1)):"onreadystatechange"in r&&(r.onreadystatechange=function(){4===r.readyState?200===ajax.status?t.onFileDownloadComplete(r.response,r):t.onFileDownloadError({type:n.WEBIM_DOWNLOADFILE_ERROR,id:t.id,xhr:r}):(r.abort(),t.onFileDownloadError({type:n.WEBIM_DOWNLOADFILE_ERROR,id:t.id,xhr:r}))});var s=t.method||"GET",a=t.responseType||"blob",c=t.mimeType||"text/plain; charset=x-user-defined";r.open(s,t.url),"undefined"!=typeof Blob?r.responseType=a:r.overrideMimeType(c);var p={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":t.secret,Authorization:"Bearer "+o},l=t.headers||{};for(var u in l)p[u]=l[u];for(var u in p)p[u]&&r.setRequestHeader(u,p[u]);r.send(null)},parseTextMessage:function(e,t){if("string"==typeof e){if("[object Object]"!==Object.prototype.toString.call(t))return{isemoji:!1,body:[{type:"txt",data:e}]};var o=e,n=[],i=/\[[^[\]]{2,3}\]/gm,r=o.match(i);if(!r||r.length<1)return{isemoji:!1,body:[{type:"txt",data:e}]};for(var s=!1,a=0;a<r.length;a++){var c=o.substring(0,o.indexOf(r[a])),p=WebIM.Emoji.map[r[a]];if(c&&n.push({type:"txt",data:c}),p){var l=WebIM.Emoji.map?WebIM.Emoji.path+p:null;l?(s=!0,n.push({type:"emoji",data:l})):n.push({type:"txt",data:r[a]});var u=o.indexOf(r[a])+r[a].length;o=o.substring(u)}else n.push({type:"txt",data:r[a]})}return o&&n.push({type:"txt",data:o}),s?{isemoji:s,body:n}:{isemoji:!1,body:[{type:"txt",data:e}]}}},xmlrequest:a,getXmlFirstChild:function(e,t){var o=e.getElementsByTagName(t);return 0==o.length?null:o[0]},ajax:function(t){var o=t.dataType||"text",i=t.success||e,r=t.error||e,s=y.xmlrequest();s.onreadystatechange=function(){if(4===s.readyState){var e=s.status||0;if(200===e){try{switch(o){case"text":return void i(s.responseText);case"json":var t=y.parseJSON(s.responseText);return void i(t,s);case"xml":return void(s.responseXML&&s.responseXML.documentElement?i(s.responseXML.documentElement,s):r({type:n.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText}))}i(s.response||s.responseText,s)}catch(e){r({type:n.WEBIM_CONNCTION_AJAX_ERROR,data:e})}return}return void r({type:n.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})}0===s.readyState&&r({type:n.WEBIM_CONNCTION_AJAX_ERROR,data:s.responseText})},t.responseType&&s.responseType&&(s.responseType=t.responseType),t.mimeType&&y.hasOverrideMimeType&&s.overrideMimeType(t.mimeType);var a=t.type||"POST",c=t.data||null,p="";if("get"===a.toLowerCase()&&c){for(var l in c)c.hasOwnProperty(l)&&(p+=l+"="+c[l]+"&");p=p?p.slice(0,-1):p,t.url+=(t.url.indexOf("?")>0?"&":"?")+(p?p+"&":p)+"_v="+(new Date).getTime(),c=null,p=null}if(s.open(a,t.url),y.isCanSetRequestHeader){var u=t.headers||{};for(var d in u)u.hasOwnProperty(d)&&s.setRequestHeader(d,u[d])}return s.send(c),s},ts:function(){var e=new Date,t=e.getHours(),o=e.getMinutes(),n=e.getSeconds(),i=e.getMilliseconds();return(t<10?"0"+t:t)+":"+(o<10?"0"+o:o)+":"+(n<10?"0"+n:n)+":"+i+" "},getObjectKey:function(e,t){for(var o in e)if(e[o]==t)return o;return""}};t.utils=y}()},function(e,t,o){!function(){"use strict";var e=o(3).utils,n=function(e,t){return!this instanceof n?new n(e):(this._msg={},"function"==typeof n[e]&&(n[e].prototype.setGroup=this.setGroup,this._msg=new n[e](t)),this._msg)};n.prototype.setGroup=function(e){this.body.group=e},n.txt=function(e){this.id=e,this.type="txt",this.body={}},n.txt.prototype.set=function(e){this.value=e.msg,this.body={id:this.id,to:e.to,msg:this.value,type:this.type,roomType:e.roomType,ext:e.ext||{},success:e.success,fail:e.fail},!e.roomType&&delete this.body.roomType},n.cmd=function(e){this.id=e,this.type="cmd",this.body={}},n.cmd.prototype.set=function(e){this.value="",this.body={to:e.to,action:e.action,msg:this.value,type:this.type,roomType:e.roomType,ext:e.ext||{},success:e.success},!e.roomType&&delete this.body.roomType},n.location=function(e){this.id=e,this.type="loc",this.body={}},n.location.prototype.set=function(e){this.body={to:e.to,type:this.type,roomType:e.roomType,addr:e.addr,lat:e.lat,lng:e.lng,ext:e.ext||{}}},n.img=function(e){this.id=e,this.type="img",this.body={}},n.img.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.body={id:this.id,file:this.value,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},roomType:t.roomType,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,width:t.width,height:t.height,body:t.body,uploadError:t.uploadError,uploadComplete:t.uploadComplete},!t.roomType&&delete this.body.roomType},n.audio=function(e){this.id=e,this.type="audio",this.body={}},n.audio.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.filename=t.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},length:t.length||0,roomType:t.roomType,file_length:t.file_length,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,body:t.body},!t.roomType&&delete this.body.roomType},n.file=function(e){this.id=e,this.type="file",this.body={}},n.file.prototype.set=function(t){t.file=t.file||e.getFileUrl(t.fileInputId),this.value=t.file,this.filename=t.filename||this.value.filename,this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:t.apiUrl,to:t.to,type:this.type,ext:t.ext||{},roomType:t.roomType,onFileUploadError:t.onFileUploadError,onFileUploadComplete:t.onFileUploadComplete,success:t.success,fail:t.fail,flashUpload:t.flashUpload,body:t.body},!t.roomType&&delete this.body.roomType},n.video=function(e){},n.video.prototype.set=function(e){};var i=function(e){return!this instanceof i?new i(e,conn):void(this.msg=e)};i.prototype.send=function(t){var o=this,n=function(o){o.ext=o.ext||{},o.ext.weichat=o.ext.weichat||{},o.ext.weichat.originType=o.ext.weichat.originType||"webim";var n={from:t.context.userId||"",to:o.to,bodies:[o.body],ext:o.ext||{}},i=e.stringify(n),r=$msg({type:o.group||"chat",to:o.toJid,id:o.id,xmlns:"jabber:client"}).c("body").t(i);o.roomType&&r.up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"}),setTimeout(function(){"undefined"!=typeof _msgHash&&_msgHash[o.id]&&_msgHash[o.id].msg.fail instanceof Function&&_msgHash[o.id].msg.fail(o.id)},6e4),t.sendCommand(r.tree(),o.id)};if(o.msg.file){if(o.msg.body&&o.msg.body.url)return void n(o.msg);var i=o.msg.onFileUploadComplete,r=function(e){if(e.entities[0]["file-metadata"]){var t=e.entities[0]["file-metadata"]["content-length"];o.msg.file_length=t,o.msg.filetype=e.entities[0]["file-metadata"]["content-type"],t>204800&&(o.msg.thumbnail=!0)}o.msg.body={type:o.msg.type||"file",url:("https:"!=location.protocol&&WebIM.config.isHttpDNS?WebIM.config.apiURL+e.uri.substr(e.uri.indexOf("/",9)):e.uri)+"/"+e.entities[0].uuid,secret:e.entities[0]["share-secret"],filename:o.msg.file.filename||o.msg.filename,size:{width:o.msg.width||0,height:o.msg.height||0},length:o.msg.length||0,file_length:o.msg.file_length||0,filetype:o.msg.filetype},n(o.msg),i instanceof Function&&i(e,o.msg.id)};o.msg.onFileUploadComplete=r,e.uploadFile.call(t,o.msg)}else o.msg.body={type:"chat"===o.msg.type?"txt":o.msg.type,msg:o.msg.msg},"cmd"===o.msg.type?o.msg.body.action=o.msg.action:"loc"===o.msg.type&&(o.msg.body.addr=o.msg.addr,o.msg.body.lat=o.msg.lat,o.msg.body.lng=o.msg.lng),n(o.msg)},t._msg=i,t.message=n}()},function(e,t){!function(){function e(e){this.array=void 0===e?[]:new Array(e)}e.prototype={length:function(){return this.array.length},at:function(e){return this.array[e]},set:function(e,t){this.array[e]=t},push:function(e){return this.array.push(e)},slice:function(e,t){return this.array=this.array.slice(e,t)},concat:function(e){this.array=this.array.concat(e)},remove:function(e,t){t=void 0===t?1:t,this.array.splice(e,t)},join:function(e){return this.array.join(e)},clear:function(){this.array.length=0}};var o=function(){this._array_h=new e};o.prototype={_index:0,push:function(e){this._array_h.push(e)},pop:function(){var e=null;return this._array_h.length()&&(e=this._array_h.at(this._index),2*++this._index>=this._array_h.length()&&(this._array_h.slice(this._index),this._index=0)),e},head:function(){
	var e=null,t=this._array_h.length();return t&&(e=this._array_h.at(t-1)),e},tail:function(){var e=null,t=this._array_h.length();return t&&(e=this._array_h.at(this._index)),e},length:function(){return this._array_h.length()-this._index},empty:function(){return 0===this._array_h.length()},clear:function(){this._array_h.clear()}},t.Queue=o}()}])});
	//# sourceMappingURL=websdk-1.4.5.min.js.map


/***/ }

});