webpackJsonp([2],{239:function(e,t){UM.I18N["zh-cn"]={labelMap:{anchor:"锚点",undo:"撤销",redo:"重做",bold:"加粗",indent:"首行缩进",snapscreen:"截图",italic:"斜体",underline:"下划线",strikethrough:"删除线",subscript:"下标",fontborder:"字符边框",superscript:"上标",formatmatch:"格式刷",source:"源代码",blockquote:"引用",pasteplain:"纯文本粘贴模式",selectall:"全选",print:"打印",preview:"预览",horizontal:"分隔线",removeformat:"清除格式",time:"时间",date:"日期",unlink:"取消链接",insertrow:"前插入行",insertcol:"前插入列",mergeright:"右合并单元格",mergedown:"下合并单元格",deleterow:"删除行",deletecol:"删除列",splittorows:"拆分成行",splittocols:"拆分成列",splittocells:"完全拆分单元格",mergecells:"合并多个单元格",deletetable:"删除表格",cleardoc:"清空文档",insertparagraphbeforetable:"表格前插入行",insertcode:"代码语言",fontfamily:"字体",fontsize:"字号",paragraph:"段落格式",image:"图片",edittable:"表格属性",edittd:"单元格属性",link:"超链接",emotion:"表情",spechars:"特殊字符",searchreplace:"查询替换",map:"百度地图",gmap:"Google地图",video:"视频",help:"帮助",justifyleft:"居左对齐",justifyright:"居右对齐",justifycenter:"居中对齐",justifyjustify:"两端对齐",forecolor:"字体颜色",backcolor:"背景色",insertorderedlist:"有序列表",insertunorderedlist:"无序列表",fullscreen:"全屏",directionalityltr:"从左向右输入",directionalityrtl:"从右向左输入",rowspacingtop:"段前距",rowspacingbottom:"段后距",highlightcode:"插入代码",pagebreak:"分页",insertframe:"插入Iframe",imagenone:"默认",imageleft:"左浮动",imageright:"右浮动",attachment:"附件",imagecenter:"居中",wordimage:"图片转存",lineheight:"行间距",edittip:"编辑提示",customstyle:"自定义标题",autotypeset:"自动排版",webapp:"百度应用",touppercase:"字母大写",tolowercase:"字母小写",background:"背景",template:"模板",scrawl:"涂鸦",music:"音乐",inserttable:"插入表格",drafts:"草稿箱",formula:"数学公式"},paragraph:{p:"段落",h1:"标题 1",h2:"标题 2",h3:"标题 3",h4:"标题 4",h5:"标题 5",h6:"标题 6"},fontfamily:{songti:"宋体",kaiti:"楷体",heiti:"黑体",lishu:"隶书",yahei:"微软雅黑",andaleMono:"andale mono",arial:"arial",arialBlack:"arial black",comicSansMs:"comic sans ms",impact:"impact",timesNewRoman:"times new roman"},ok:"确认",cancel:"取消",closeDialog:"关闭对话框",tableDrag:"表格拖动必须引入uiUtils.js文件！",autofloatMsg:"工具栏浮动依赖编辑器UI，您首先需要引入UI文件!",anthorMsg:"链接",clearColor:"清空颜色",standardColor:"标准颜色",themeColor:"主题颜色",property:"属性","default":"默认",modify:"修改",justifyleft:"左对齐",justifyright:"右对齐",justifycenter:"居中",justify:"默认",clear:"清除",anchorMsg:"锚点","delete":"删除",clickToUpload:"点击上传",unset:"尚未设置语言文件",t_row:"行",t_col:"列",more:"更多",pasteOpt:"粘贴选项",pasteSourceFormat:"保留源格式",tagFormat:"只保留标签",pasteTextFormat:"只保留文本",image:{"static":{lang_tab_local:"本地上传",lang_tab_imgSearch:"网络图片",lang_input_dragTip:"支持图片拖拽上传",lang_btn_add:"添加"},uploadError:"上传出错"},emotion:{"static":{lang_input_choice:"精选",lang_input_Tuzki:"兔斯基",lang_input_BOBO:"BOBO",lang_input_lvdouwa:"绿豆蛙",lang_input_babyCat:"baby猫",lang_input_bubble:"泡泡",lang_input_youa:"有啊"}},gmap:{"static":{lang_input_address:"地址",lang_input_search:"搜索",address:{value:"北京"}},searchError:"无法定位到该地址!"},link:{"static":{lang_input_text:"文本内容：",lang_input_url:"链接地址：",lang_input_title:"标题：",lang_input_target:"是否在新窗口打开："},validLink:"只支持选中一个链接时生效",httpPrompt:"您输入的超链接中不包含http等协议名称，默认将为您添加http://前缀"},map:{"static":{lang_city:"城市",lang_address:"地址",city:{value:"北京"},lang_search:"搜索",lang_dynamicmap:"插入动态地图"},cityMsg:"请选择城市",errorMsg:"抱歉，找不到该位置！"},video:{"static":{lang_tab_insertV:"插入视频",lang_video_url:"视频网址",lang_video_size:"视频尺寸",lang_videoW:"宽度",lang_videoH:"高度",lang_alignment:"对齐方式",videoSearchTxt:{value:"请输入搜索关键字！"},videoType:{options:["全部","热门","娱乐","搞笑","体育","科技","综艺"]},videoSearchBtn:{value:"百度一下"},videoSearchReset:{value:"清空结果"}},numError:"请输入正确的数值，如123,400",floatLeft:"左浮动",floatRight:"右浮动","default":"默认",block:"独占一行",urlError:"输入的视频地址有误，请检查后再试！",loading:" &nbsp;视频加载中，请等待……",clickToSelect:"点击选中",goToSource:"访问源视频",noVideo:" &nbsp; &nbsp;抱歉，找不到对应的视频，请重试！"},formula:{"static":{lang_tab_common:"常用公式",lang_tab_symbol:"符号",lang_tab_letter:"字母"}}}},241:function(module,exports){!function(g){function G(e,t,n){var i;return t=t.toLowerCase(),(i=e.__allListeners||n&&(e.__allListeners={}))&&(i[t]||n&&(i[t]=[]))}function H(e,t,n,i,o,r){i=i&&e[t];var a;for(!i&&(i=e[n]);!i&&(a=(a||e).parentNode);){if("BODY"==a.tagName||r&&!r(a))return null;i=a[n]}return i&&o&&!o(i)?H(i,t,n,!1,o):i}UMEDITOR_CONFIG=window.UMEDITOR_CONFIG||{},window.UM={plugins:{},commands:{},I18N:{},version:"1.2.2"};var B=UM.dom={},m=UM.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,n={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:-1<e.indexOf(" applewebkit/"),mac:-1<e.indexOf("macintosh"),quirks:"BackCompat"==document.compatMode};n.gecko="Gecko"==navigator.product&&!n.webkit&&!n.opera&&!n.ie;var i=0;if(n.ie){var i=e.match(/(?:msie\s([\w.]+))/),o=e.match(/(?:trident.*rv:([\w.]+))/),i=i&&o&&i[1]&&o[1]?Math.max(1*i[1],1*o[1]):i&&i[1]?1*i[1]:o&&o[1]?1*o[1]:0;n.ie11Compat=11==document.documentMode,n.ie9Compat=9==document.documentMode,n.ie8=!!document.documentMode,n.ie8Compat=8==document.documentMode,n.ie7Compat=7==i&&!document.documentMode||7==document.documentMode,n.ie6Compat=7>i||n.quirks,n.ie9above=8<i,n.ie9below=9>i}return n.gecko&&(o=e.match(/rv:([\d\.]+)/))&&(o=o[1].split("."),i=1e4*o[0]+100*(o[1]||0)+1*(o[2]||0)),/chrome\/(\d+\.\d)/i.test(e)&&(n.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)&&(n.safari=+(RegExp.$1||RegExp.$2)),n.opera&&(i=parseFloat(t.version())),n.webkit&&(i=parseFloat(e.match(/ applewebkit\/(\d+)/)[1])),n.version=i,n.isCompatible=!n.mobile&&(n.ie&&6<=i||n.gecko&&10801<=i||n.opera&&9.5<=i||n.air&&1<=i||n.webkit&&522<=i||!1),n}(),E=m.ie,n=UM.utils={each:function(e,t,n){if(null!=e)if(e.length===+e.length){for(var i=0,o=e.length;i<o;i++)if(!1===t.call(n,e[i],i,e))return!1}else for(i in e)if(e.hasOwnProperty(i)&&!1===t.call(n,e[i],i,e))return!1},makeInstance:function(e){var t=new Function;return t.prototype=e,e=new t,t.prototype=null,e},extend:function(e,t,n){if(t)for(var i in t)n&&e.hasOwnProperty(i)||(e[i]=t[i]);return e},extend2:function(e){for(var t=arguments,n=1;n<t.length;n++){var i,o=t[n];for(i in o)e.hasOwnProperty(i)||(e[i]=o[i])}return e},inherits:function(e,t){var i=e.prototype,o=n.makeInstance(t.prototype);return n.extend(o,i,!0),e.prototype=o,o.constructor=e},bind:function(e,t){return function(){return e.apply(t,arguments)}},defer:function(e,t,n){var i;return function(){n&&clearTimeout(i),i=setTimeout(e,t)}},indexOf:function(e,t,n){var i=-1;return n=this.isNumber(n)?n:0,this.each(e,function(e,o){if(o>=n&&e===t)return i=o,!1}),i},removeItem:function(e,t){for(var n=0,i=e.length;n<i;n++)e[n]===t&&(e.splice(n,1),n--)},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(e){if(!e)return{};e=n.isArray(e)?e:e.split(",");for(var t,i=0,o={};t=e[i++];)o[t.toUpperCase()]=o[t]=1;return o},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(e,t){return t?e:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[e]}):""},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t={"float":void 0!=e.cssFloat?"cssFloat":void 0!=e.styleFloat?"styleFloat":"float"};return function(e){return t[e]||(t[e]=e.toLowerCase().replace(/-./g,function(e){return e.charAt(1).toUpperCase()}))}}(),loadFile:function(){function e(e,n){try{for(var i,o=0;i=t[o++];)if(i.doc===e&&i.url==(n.src||n.href))return i}catch(r){return null}}var t=[];return function(n,i,o){var r=e(n,i);if(r)r.ready?o&&o():r.funs.push(o);else if(t.push({doc:n,url:i.src||i.href,funs:[o]}),n.body){if(!i.id||!n.getElementById(i.id)){var a=n.createElement(i.tag);delete i.tag;for(s in i)a.setAttribute(s,i[s]);a.onload=a.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(r=e(n,i),0<r.funs.length){r.ready=1;for(var t;t=r.funs.pop();)t()}a.onload=a.onreadystatechange=null}},a.onerror=function(){throw Error("The load "+(i.href||i.src)+" fails,check the url settings of file umeditor.config.js ")},n.getElementsByTagName("head")[0].appendChild(a)}}else{o=[];for(var s in i)"tag"!=s&&o.push(s+'="'+i[s]+'"');n.write("<"+i.tag+" "+o.join(" ")+" ></"+i.tag+">")}}}(),isEmptyObject:function(e){if(null==e)return!0;if(this.isArray(e)||this.isString(e))return 0===e.length;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},fixColor:function(e,t){if(/color/i.test(e)&&/rgba?/.test(t)){var n=t.split(",");if(3<n.length)return"";t="#";for(var i,o=0;i=n[o++];)i=parseInt(i.replace(/[^\d]/gi,""),10).toString(16),t+=1==i.length?"0"+i:i;t=t.toUpperCase()}return t},clone:function(e,t){var i;t=t||{};for(var o in e)e.hasOwnProperty(o)&&(i=e[o],"object"==typeof i?(t[o]=n.isArray(i)?[]:{},n.clone(e[o],t[o])):t[o]=i);return t},transUnitToPx:function(e){if(!/(pt|cm)/.test(e))return e;var t;switch(e.replace(/([\d.]+)(\w+)/,function(n,i,o){e=i,t=o}),t){case"cm":e=25*parseFloat(e);break;case"pt":e=Math.round(96*parseFloat(e)/72)}return e+(e?"px":"")},cssRule:m.ie&&11!=m.version?function(e,t,n){var i;n=n||document,i=n.indexList?n.indexList:n.indexList={};var o;if(i[e])o=n.styleSheets[i[e]];else{if(void 0===t)return"";o=n.createStyleSheet("",n=n.styleSheets.length),i[e]=n}return void 0===t?o.cssText:void(o.cssText=t||"")}:function(e,t,n){n=n||document;var i,o=n.getElementsByTagName("head")[0];if(!(i=n.getElementById(e))){if(void 0===t)return"";i=n.createElement("style"),i.id=e,o.appendChild(i)}return void 0===t?i.innerHTML:void(""!==t?i.innerHTML=t:o.removeChild(i))}};n.each("String Function Array Number RegExp Object".split(" "),function(e){UM.utils["is"+e]=function(t){return Object.prototype.toString.apply(t)=="[object "+e+"]"}});var I=UM.EventBase=function(){};I.prototype={addListener:function(e,t){e=n.trim(e).split(" ");for(var i,o=0;i=e[o++];)G(this,i,!0).push(t)},removeListener:function(e,t){e=n.trim(e).split(" ");for(var i,o=0;i=e[o++];)n.removeItem(G(this,i)||[],t)},fireEvent:function(){for(var e,t=arguments[0],t=n.trim(t).split(" "),i=0;e=t[i++];){var o,r,a,s=G(this,e);if(s)for(a=s.length;a--;)if(s[a]){if(r=s[a].apply(this,arguments),!0===r)return r;void 0!==r&&(o=r)}(r=this["on"+e.toLowerCase()])&&(o=r.apply(this,arguments))}return o}};var q=B.dtd=function(){function e(e){for(var t in e)e[t.toUpperCase()]=e[t];return e}var t=n.extend2,i=e({isindex:1,fieldset:1}),o=e({input:1,button:1,select:1,textarea:1,label:1}),r=t(e({a:1}),o),a=t({iframe:1},r),s=e({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),l=e({ins:1,del:1,script:1,style:1}),d=t(e({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),l),c=t(e({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),d),u=t(e({p:1}),c),o=t(e({iframe:1}),c,o),c=e({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),h=t(e({a:0}),o),f=e({tr:1}),p=e({"#":1}),m=t(e({param:1}),c),g=t(e({form:1}),i,a,s,u),v=e({li:1,ol:1,ul:1}),b=e({style:1,script:1}),y=e({base:1,link:1,meta:1,title:1}),b=t(y,b),C=e({head:1,body:1}),k=e({html:1}),x=e({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),N=e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return e({$nonBodyContent:t(k,C,y),$block:x,$inline:h,$inlineWithA:t(e({a:1}),h),$body:t(e({script:1,style:1}),x),$cdata:e({script:1,style:1}),$empty:N,$nonChild:e({iframe:1,textarea:1}),$listItem:e({dd:1,dt:1,li:1}),$list:e({ul:1,ol:1,dl:1}),$isNotEmpty:e({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:e({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:e({p:1,div:1}),$tableContent:e({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:e({pre:1,script:1,style:1,textarea:1}),html:C,head:b,style:p,script:p,body:g,base:{},link:{},meta:{},title:p,col:{},tr:e({td:1,th:1}),img:{},embed:{},colgroup:e({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:g,td:g,br:{},th:g,center:g,kbd:h,button:t(u,s),basefont:{},h5:h,h4:h,samp:h,h6:h,ol:v,h1:h,h3:h,option:p,h2:h,form:t(i,a,s,u),select:e({optgroup:1,option:1}),font:h,ins:h,menu:v,abbr:h,label:h,table:e({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:h,tfoot:f,cite:h,li:g,input:{},iframe:g,strong:h,textarea:p,noframes:g,big:h,small:h,span:e({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:h,dt:h,sub:h,optgroup:e({option:1}),param:{},bdo:h,"var":h,div:g,object:m,sup:h,dd:g,strike:h,area:{},dir:v,map:t(e({area:1,form:1,p:1}),i,l,s),applet:m,dl:e({dt:1,dd:1}),del:h,isindex:{},fieldset:t(e({legend:1}),c),thead:f,ul:v,acronym:h,b:h,a:t(e({a:1}),o),blockquote:t(e({td:1,tr:1,tbody:1,li:1}),g),caption:h,i:h,u:h,tbody:f,s:h,address:t(a,u),tt:h,legend:h,q:h,pre:t(d,r),p:t(e({a:1}),h),em:h,dfn:h})}(),J=E&&9>m.version?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},K=n.listToMap("-webkit-box -moz-box block list-item table table-row-group table-header-group table-footer-group table-row table-column-group table-column table-cell table-caption".split(" ")),k=B.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:E&&"6"==m.version?"\ufeff":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},breakParent:function(e,t){var n,i,o,r=e,a=e;do{for(r=r.parentNode,i?(n=r.cloneNode(!1),n.appendChild(i),i=n,n=r.cloneNode(!1),n.appendChild(o),o=n):(i=r.cloneNode(!1),o=i.cloneNode(!1));n=a.previousSibling;)i.insertBefore(n,i.firstChild);for(;n=a.nextSibling;)o.appendChild(n);a=r}while(t!==r);return n=t.parentNode,n.insertBefore(i,t),n.insertBefore(o,t),n.insertBefore(e,o),k.remove(t),e},trimWhiteTextNode:function(e){function t(t){for(var n;(n=e[t])&&3==n.nodeType&&k.isWhitespace(n);)e.removeChild(n)}t("firstChild"),t("lastChild")},getPosition:function(e,t){if(e===t)return 0;var n,i=[e],o=[t];for(n=e;n=n.parentNode;){if(n===t)return 10;i.push(n)}for(n=t;n=n.parentNode;){if(n===e)return 20;o.push(n)}if(i.reverse(),o.reverse(),i[0]!==o[0])return 1;for(n=-1;n++,i[n]===o[n];);for(e=i[n],t=o[n];e=e.nextSibling;)if(e===t)return 4;return 2},getNodeIndex:function(e,t){for(var n=e,i=0;n=n.previousSibling;)t&&3==n.nodeType?n.nodeType!=n.nextSibling.nodeType&&i++:i++;return i},inDoc:function(e,t){return 10==k.getPosition(e,t)},findParent:function(e,t,n){if(e&&!k.isBody(e))for(e=n?e:e.parentNode;e;){if(!t||t(e)||k.isBody(e))return t&&!t(e)&&k.isBody(e)?null:e;e=e.parentNode}return null},findParentByTagName:function(e,t,i,o){return t=n.listToMap(n.isArray(t)?t:[t]),k.findParent(e,function(e){return t[e.tagName]&&!(o&&o(e))},i)},findParents:function(e,t,n,i){for(t=t&&(n&&n(e)||!n)?[e]:[];e=k.findParent(e,n);)t.push(e);return i?t:t.reverse()},insertAfter:function(e,t){return e.parentNode.insertBefore(t,e.nextSibling)},remove:function(e,t){var n,i=e.parentNode;if(i){if(t&&e.hasChildNodes())for(;n=e.firstChild;)i.insertBefore(n,e);i.removeChild(e)}return e},getNextDomNode:function(e,t,n,i){return H(e,"firstChild","nextSibling",t,n,i)},getPreDomNode:function(e,t,n,i){return H(e,"lastChild","previousSibling",t,n,i)},isBookmarkNode:function(e){return 1==e.nodeType&&e.id&&/^_baidu_bookmark_/i.test(e.id)},getWindow:function(e){return e=e.ownerDocument||e,e.defaultView||e.parentWindow},getCommonAncestor:function(e,t){if(e===t)return e;for(var n=[e],i=[t],o=e,r=-1;o=o.parentNode;){if(o===t)return o;n.push(o)}for(o=t;o=o.parentNode;){if(o===e)return o;i.push(o)}for(n.reverse(),i.reverse();r++,n[r]===i[r];);return 0==r?null:n[r-1]},clearEmptySibling:function(e,t,n){function i(e,t){for(var n;e&&!k.isBookmarkNode(e)&&(k.isEmptyInlineElement(e)||!RegExp("[^\t\n\r"+k.fillChar+"]").test(e.nodeValue));)n=e[t],k.remove(e),e=n}!t&&i(e.nextSibling,"nextSibling"),!n&&i(e.previousSibling,"previousSibling")},split:function(e,t){var n=e.ownerDocument;if(m.ie&&t==e.nodeValue.length){var i=n.createTextNode("");return k.insertAfter(e,i)}return i=e.splitText(t),m.ie8&&(n=n.createTextNode(""),k.insertAfter(i,n),k.remove(n)),i},isWhitespace:function(e){return!RegExp("[^ \t\n\r"+k.fillChar+"]").test(e.nodeValue)},getXY:function(e){for(var t=0,n=0;e.offsetParent;)n+=e.offsetTop,t+=e.offsetLeft,e=e.offsetParent;return{x:t,y:n}},isEmptyInlineElement:function(e){if(1!=e.nodeType||!q.$removeEmpty[e.tagName])return 0;for(e=e.firstChild;e;){if(k.isBookmarkNode(e)||1==e.nodeType&&!k.isEmptyInlineElement(e)||3==e.nodeType&&!k.isWhitespace(e))return 0;e=e.nextSibling}return 1},isBlockElm:function(e){return 1==e.nodeType&&(q.$block[e.tagName]||K[k.getComputedStyle(e,"display")])&&!q.$nonChild[e.tagName]},getElementsByTagName:function(e,t,i){if(i&&n.isString(i)){var o=i;i=function(e){var t=!1;return g.each(n.trim(o).replace(/[ ]{2,}/g," ").split(" "),function(n,i){if(g(e).hasClass(i))return t=!0,!1}),t}}t=n.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var r,a=[],s=0;r=t[s++];){r=e.getElementsByTagName(r);for(var l,d=0;l=r[d++];)i&&!i(l)||a.push(l)}return a},unSelectable:E&&m.ie9below||m.opera?function(e){e.onselectstart=function(){return!1},e.onclick=e.onkeyup=e.onkeydown=function(){return!1},e.unselectable="on",e.setAttribute("unselectable","on");for(var t,n=0;t=e.all[n++];)switch(t.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:t.unselectable="on",e.setAttribute("unselectable","on")}}:function(e){e.style.MozUserSelect=e.style.webkitUserSelect=e.style.msUserSelect=e.style.KhtmlUserSelect="none"},removeAttributes:function(e,t){t=n.isArray(t)?t:n.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i,o=0;i=t[o++];){switch(i=J[i]||i){case"className":e[i]="";break;case"style":e.style.cssText="",!m.ie&&e.removeAttributeNode(e.getAttributeNode("style"))}e.removeAttribute(i)}},createElement:function(e,t,n){return k.setAttributes(e.createElement(t),n)},setAttributes:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];switch(n){case"class":e.className=i;break;case"style":e.style.cssText=e.style.cssText+";"+i;break;case"innerHTML":e[n]=i;break;case"value":e.value=i;break;default:e.setAttribute(J[n]||n,i)}}return e},getComputedStyle:function(e,t){return n.transUnitToPx(n.fixColor(t,g(e).css(t)))},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},removeStyle:function(e,t){m.ie?("color"==t&&(t="(^|;)"+t),e.style.cssText=e.style.cssText.replace(RegExp(t+"[^:]*:[^;]+;?","ig"),"")):e.style.removeProperty?e.style.removeProperty(t):e.style.removeAttribute(n.cssStyleToDomStyle(t)),e.style.cssText||k.removeAttributes(e,["style"])},getStyle:function(e,t){var i=e.style[n.cssStyleToDomStyle(t)];return n.fixColor(t,i)},setStyle:function(e,t,i){e.style[n.cssStyleToDomStyle(t)]=i,n.trim(e.style.cssText)||this.removeAttributes(e,"style")},removeDirtyAttr:function(e){for(var t,n=0,i=e.getElementsByTagName("*");t=i[n++];)t.removeAttribute("_moz_dirty");e.removeAttribute("_moz_dirty")},getChildCount:function(e,t){var n=0,i=e.firstChild;for(t=t||function(){return 1};i;)t(i)&&n++,i=i.nextSibling;return n},isEmptyNode:function(e){return!e.firstChild||0==k.getChildCount(e,function(e){return!k.isBr(e)&&!k.isBookmarkNode(e)&&!k.isWhitespace(e)})},isBr:function(e){return 1==e.nodeType&&"BR"==e.tagName},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(RegExp((t?"^":"")+k.fillChar),"").length},isEmptyBlock:function(e,t){if(1!=e.nodeType)return 0;if(t=t||RegExp("[ \t\r\n"+k.fillChar+"]","g"),0<e[m.ie?"innerText":"textContent"].replace(t,"").length)return 0;for(var n in q.$isNotEmpty)if(e.getElementsByTagName(n).length)return 0;return 1},isCustomeNode:function(e){return 1==e.nodeType&&e.getAttribute("_ue_custom_node_")},fillNode:function(e,t){var n=m.ie?e.createTextNode(k.fillChar):e.createElement("br");t.innerHTML="",t.appendChild(n)},isBoundaryNode:function(e,t){for(var n;!k.isBody(e);)if(n=e,e=e.parentNode,n!==e[t])return!1;return!0},isFillChar:function(e,t){return 3==e.nodeType&&!e.nodeValue.replace(RegExp((t?"^":"")+k.fillChar),"").length},isBody:function(e){return g(e).hasClass("edui-body-container")}},F=RegExp(k.fillChar,"g");!function(){function e(e,t,n,i){return 1==t.nodeType&&(q.$empty[t.tagName]||q.$nonChild[t.tagName])&&(n=k.getNodeIndex(t)+(e?0:1),t=t.parentNode),e?(i.startContainer=t,i.startOffset=n,i.endContainer||i.collapse(!0)):(i.endContainer=t,i.endOffset=n,i.startContainer||i.collapse(!1)),i.collapsed=i.startContainer&&i.endContainer&&i.startContainer===i.endContainer&&i.startOffset==i.endOffset,i}function t(e,t){try{if(i&&k.inDoc(i,e))if(i.nodeValue.replace(F,"").length)i.nodeValue=i.nodeValue.replace(F,"");else{var n=i.parentNode;for(k.remove(i);n&&k.isEmptyInlineElement(n)&&(m.safari?!(k.getPosition(n,t)&k.POSITION_CONTAINS):!n.contains(t));)i=n.parentNode,k.remove(n),n=i}}catch(o){}}function n(e,t){var n;for(e=e[t];e&&k.isFillChar(e);)n=e[t],k.remove(e),e=n}var i,o=0,r=k.fillChar,a=B.Range=function(e,t){this.startContainer=this.startOffset=this.endContainer=this.endOffset=null,this.document=e,this.collapsed=!0,this.body=t};a.prototype={deleteContents:function(){var e;if(!this.collapsed){e=this.startContainer;var t,n,i=this.endContainer,o=this.startOffset,r=this.endOffset,a=this.document,s=a.createDocumentFragment();if(1==e.nodeType&&(e=e.childNodes[o]||(t=e.appendChild(a.createTextNode("")))),1==i.nodeType&&(i=i.childNodes[r]||(n=i.appendChild(a.createTextNode("")))),e===i&&3==e.nodeType)s.appendChild(a.createTextNode(e.substringData(o,r-o))),e.deleteData(o,r-o),this.collapse(!0);else{for(var l,d,c=s,u=k.findParents(e,!0),h=k.findParents(i,!0),f=0;u[f]==h[f];)f++;for(var p,g=f;p=u[g];g++){for(l=p.nextSibling,p==e?t||(3==this.startContainer.nodeType?(c.appendChild(a.createTextNode(e.nodeValue.slice(o))),e.deleteData(o,e.nodeValue.length-o)):c.appendChild(e)):(d=p.cloneNode(!1),c.appendChild(d));l&&l!==i&&l!==h[g];)p=l.nextSibling,c.appendChild(l),l=p;c=d}for(c=s,u[f]||(c.appendChild(u[f-1].cloneNode(!1)),c=c.firstChild),g=f;o=h[g];g++){if(l=o.previousSibling,o==i?n||3!=this.endContainer.nodeType||(c.appendChild(a.createTextNode(i.substringData(0,r))),i.deleteData(0,r)):(d=o.cloneNode(!1),c.appendChild(d)),g!=f||!u[f])for(;l&&l!==e;)o=l.previousSibling,c.insertBefore(l,c.firstChild),l=o;c=d}this.setStartBefore(h[f]?u[f]?h[f]:u[f-1]:h[f-1]).collapse(!0),t&&k.remove(t),n&&k.remove(n)}}return m.webkit&&(e=this.startContainer,3!=e.nodeType||e.nodeValue.length||(this.setStartBefore(e).collapse(!0),k.remove(e))),this},inFillChar:function(){var e=this.startContainer;return!(!this.collapsed||3!=e.nodeType||e.nodeValue.replace(RegExp("^"+k.fillChar),"").length+1!=e.nodeValue.length)},setStart:function(t,n){return e(!0,t,n,this)},setEnd:function(t,n){return e(!1,t,n,this)},setStartAfter:function(e){return this.setStart(e.parentNode,k.getNodeIndex(e)+1)},setStartBefore:function(e){return this.setStart(e.parentNode,k.getNodeIndex(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,k.getNodeIndex(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,k.getNodeIndex(e))},setStartAtFirst:function(e){return this.setStart(e,0)},setStartAtLast:function(e){return this.setStart(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},setEndAtFirst:function(e){return this.setEnd(e,0)},setEndAtLast:function(e){return this.setEnd(e,3==e.nodeType?e.nodeValue.length:e.childNodes.length)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0).setEndAtLast(e)},cloneRange:function(){return new a(this.document).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},collapse:function(e){return e?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset),this.collapsed=!0,this},shrinkBoundary:function(e){function t(e){return 1==e.nodeType&&!k.isBookmarkNode(e)&&!q.$empty[e.tagName]&&!q.$nonChild[e.tagName]}for(var n,i=this.collapsed;1==this.startContainer.nodeType&&(n=this.startContainer.childNodes[this.startOffset])&&t(n);)this.setStart(n,0);if(i)return this.collapse(!0);if(!e)for(;1==this.endContainer.nodeType&&0<this.endOffset&&(n=this.endContainer.childNodes[this.endOffset-1])&&t(n);)this.setEnd(n,n.childNodes.length);return this},trimBoundary:function(e){this.txtToElmBoundary();var t=this.startContainer,n=this.startOffset,i=this.collapsed,o=this.endContainer;if(3==t.nodeType){if(0==n)this.setStartBefore(t);else if(n>=t.nodeValue.length)this.setStartAfter(t);else{var r=k.split(t,n);t===o?this.setEnd(r,this.endOffset-n):t.parentNode===o&&(this.endOffset+=1),this.setStartBefore(r)}if(i)return this.collapse(!0)}return e||(n=this.endOffset,o=this.endContainer,3==o.nodeType&&(0==n?this.setEndBefore(o):(n<o.nodeValue.length&&k.split(o,n),this.setEndAfter(o)))),this},txtToElmBoundary:function(e){function t(e,t){var n=e[t+"Container"],i=e[t+"Offset"];3==n.nodeType&&(i?i>=n.nodeValue.length&&e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"After"](n):e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"Before"](n))}return!e&&this.collapsed||(t(this,"start"),t(this,"end")),this},insertNode:function(e){var t=e,n=1;11==e.nodeType&&(t=e.firstChild,n=e.childNodes.length),this.trimBoundary(!0);var i=this.startContainer,o=i.childNodes[this.startOffset];return o?i.insertBefore(e,o):i.appendChild(e),t.parentNode===this.endContainer&&(this.endOffset+=n),this.setStartBefore(t)},setCursor:function(e,t){return this.collapse(!e).select(t)},createBookmark:function(e,t){var n,i=this.document.createElement("span");return i.style.cssText="display:none;line-height:0px;",i.appendChild(this.document.createTextNode("‍")),i.id="_baidu_bookmark_start_"+(t?"":o++),this.collapsed||(n=i.cloneNode(!0),n.id="_baidu_bookmark_end_"+(t?"":o++)),this.insertNode(i),n&&this.collapse().insertNode(n).setEndBefore(n),this.setStartAfter(i),{start:e?i.id:i,end:n?e?n.id:n:null,id:e}},moveToBookmark:function(e){var t=e.id?this.document.getElementById(e.start):e.start;return e=e.end&&e.id?this.document.getElementById(e.end):e.end,this.setStartBefore(t),k.remove(t),e?(this.setEndBefore(e),k.remove(e)):this.collapse(!0),this},adjustmentBoundary:function(){if(!this.collapsed){for(;!k.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length&&this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!k.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[3==this.endContainer.nodeType?"nodeValue":"childNodes"].length;)this.setEndBefore(this.endContainer)}return this},getClosedNode:function(){var e;if(!this.collapsed){var t=this.cloneRange().adjustmentBoundary().shrinkBoundary();t.collapsed||1!=t.startContainer.nodeType||t.startContainer!==t.endContainer||1!=t.endOffset-t.startOffset||(t=t.startContainer.childNodes[t.startOffset])&&1==t.nodeType&&(q.$empty[t.tagName]||q.$nonChild[t.tagName])&&(e=t)}return e},select:m.ie?function(e,o){var a;this.collapsed||this.shrinkBoundary();var s=this.getClosedNode();if(s&&!o){try{a=this.document.body.createControlRange(),a.addElement(s),a.select()}catch(l){}return this}var s=this.createBookmark(),d=s.start;if(a=this.document.body.createTextRange(),a.moveToElementText(d),a.moveStart("character",1),this.collapsed){if(!e&&3!=this.startContainer.nodeType){var c=this.document.createTextNode(r),u=this.document.createElement("span");u.appendChild(this.document.createTextNode(r)),d.parentNode.insertBefore(u,d),d.parentNode.insertBefore(c,d),t(this.document,c),i=c,n(u,"previousSibling"),n(d,"nextSibling"),a.moveStart("character",-1),a.collapse(!0)}}else{var c=this.document.body.createTextRange(),d=s.end;c.moveToElementText(d),a.setEndPoint("EndToEnd",c)}this.moveToBookmark(s),u&&k.remove(u);try{a.select()}catch(h){}return this}:function(e){function o(e){function t(t,n,i){3==t.nodeType&&t.nodeValue.length<n&&(e[i+"Offset"]=t.nodeValue.length)}t(e.startContainer,e.startOffset,"start"),t(e.endContainer,e.endOffset,"end")}var a=k.getWindow(this.document),s=a.getSelection();if(m.gecko?this.body.focus():a.focus(),s){if(s.removeAllRanges(),this.collapsed&&!e&&(e=a=this.startContainer,1==a.nodeType&&(e=a.childNodes[this.startOffset]),3==a.nodeType&&this.startOffset||(e?e.previousSibling&&3==e.previousSibling.nodeType:a.lastChild&&3==a.lastChild.nodeType)||(e=this.document.createTextNode(r),this.insertNode(e),t(this.document,e),n(e,"previousSibling"),n(e,"nextSibling"),i=e,this.setStart(e,m.webkit?1:0).collapse(!0))),a=this.document.createRange(),this.collapsed&&m.opera&&1==this.startContainer.nodeType)if(e=this.startContainer.childNodes[this.startOffset]){for(;e&&k.isBlockElm(e)&&(1==e.nodeType&&e.childNodes[0]);)e=e.childNodes[0];e&&this.setStartBefore(e).collapse(!0)}else(e=this.startContainer.lastChild)&&k.isBr(e)&&this.setStartBefore(e).collapse(!0);o(this),a.setStart(this.startContainer,this.startOffset),a.setEnd(this.endContainer,this.endOffset),s.addRange(a)}return this},createAddress:function(e,t){function n(e){for(var n,i=e?o.startContainer:o.endContainer,r=k.findParents(i,!0,function(e){return!k.isBody(e)}),a=[],s=0;n=r[s++];)a.push(k.getNodeIndex(n,t));if(r=0,t)if(3==i.nodeType){for(i=i.previousSibling;i&&3==i.nodeType;)r+=i.nodeValue.replace(F,"").length,i=i.previousSibling;r+=e?o.startOffset:o.endOffset}else if(i=i.childNodes[e?o.startOffset:o.endOffset])r=k.getNodeIndex(i,t);else for(i=e?o.startContainer:o.endContainer,e=i.firstChild;e;)if(k.isFillChar(e))e=e.nextSibling;else if(r++,3==e.nodeType)for(;e&&3==e.nodeType;)e=e.nextSibling;else e=e.nextSibling;else r=e?k.isFillChar(i)?0:o.startOffset:o.endOffset;return 0>r&&(r=0),a.push(r),a}var i={},o=this;return i.startAddress=n(!0),e||(i.endAddress=o.collapsed?[].concat(i.startAddress):n()),i},moveToAddress:function(e,t){function n(e,t){for(var n,o,r,a=i.body,s=0,l=e.length;s<l;s++)if(r=e[s],n=a,a=a.childNodes[r],!a){o=r;break}t?a?i.setStartBefore(a):i.setStart(n,o):a?i.setEndBefore(a):i.setEnd(n,o)}var i=this;return n(e.startAddress,!0),!t&&e.endAddress&&n(e.endAddress),i},equals:function(e){for(var t in this)if(this.hasOwnProperty(t)&&this[t]!==e[t])return!1;return!0},scrollIntoView:function(){var e=g('<span style="padding:0;margin:0;display:block;border:0">&nbsp;</span>');this.cloneRange().insertNode(e.get(0));var t=g(window).scrollTop(),n=g(window).height(),i=e.offset().top;(i<t-n||i>t+n)&&(i>t+n?window.scrollTo(0,i-n+e.height()):window.scrollTo(0,t-i)),e.remove()},getOffset:function(){var e=this.createBookmark(),t=g(e.start).css("display","inline-block").offset();return this.moveToBookmark(e),t}}}(),function(){function e(e,t){var n=k.getNodeIndex;e=e.duplicate(),e.collapse(t);var i=e.parentElement();if(!i.hasChildNodes())return{container:i,offset:0};for(var o,r=i.children,a=e.duplicate(),s=0,l=r.length-1,d=-1;s<=l;){d=Math.floor((s+l)/2),o=r[d],a.moveToElementText(o);var c=a.compareEndPoints("StartToStart",e);
if(0<c)l=d-1;else{if(!(0>c))return{container:i,offset:n(o)};s=d+1}}if(-1==d){if(a.moveToElementText(i),a.setEndPoint("StartToStart",e),a=a.text.replace(/(\r\n|\r)/g,"\n").length,r=i.childNodes,!a)return o=r[r.length-1],{container:o,offset:o.nodeValue.length};for(n=r.length;0<a;)a-=r[--n].nodeValue.length;return{container:r[n],offset:-a}}if(a.collapse(0<c),a.setEndPoint(0<c?"StartToStart":"EndToStart",e),a=a.text.replace(/(\r\n|\r)/g,"\n").length,!a)return q.$empty[o.tagName]||q.$nonChild[o.tagName]?{container:i,offset:n(o)+(0<c?0:1)}:{container:o,offset:0<c?0:o.childNodes.length};for(;0<a;)try{r=o,o=o[0<c?"previousSibling":"nextSibling"],a-=o.nodeValue.length}catch(u){return{container:i,offset:n(r)}}return{container:o,offset:0<c?-a:o.nodeValue.length+a}}function t(t,n){if(t.item)n.selectNode(t.item(0));else{var i=e(t,!0);n.setStart(i.container,i.offset),0!=t.compareEndPoints("StartToEnd",t)&&(i=e(t,!1),n.setEnd(i.container,i.offset))}return n}function n(e,t){var n;try{n=e.getNative(t).createRange()}catch(i){return null}var o=n.item?n.item(0):n.parentElement();return(o.ownerDocument||o)===e.document?n:null}(B.Selection=function(e,t){var i=this;i.document=e,i.body=t,m.ie9below&&g(t).on("beforedeactivate",function(){i._bakIERange=i.getIERange()}).on("activate",function(){try{var e=n(i);e&&i.rangeInBody(e)||!i._bakIERange||i._bakIERange.select()}catch(t){}i._bakIERange=null})}).prototype={hasNativeRange:function(){var e;if(!m.ie||m.ie9above){if(e=this.getNative(),!e.rangeCount)return!1;e=e.getRangeAt(0)}else e=n(this);return this.rangeInBody(e)},getNative:function(e){var t=this.document;try{return t?m.ie9below||e?t.selection:k.getWindow(t).getSelection():null}catch(n){return null}},getIERange:function(e){var t=n(this,e);return t&&this.rangeInBody(t,e)||!this._bakIERange?t:this._bakIERange},rangeInBody:function(e,t){var n=m.ie9below||t?e.item?e.item():e.parentElement():e.startContainer;return n===this.body||k.inDoc(n,this.body)},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var e=this.getStart();return e?k.findParents(e,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){return this.hasNativeRange()},getRange:function(){function e(e){for(var t=n.body.firstChild,i=e.collapsed;t&&t.firstChild;)e.setStart(t,0),t=t.firstChild;e.startContainer||e.setStart(n.body,0),i&&e.collapse(!0)}var n=this;if(null!=n._cachedRange)return this._cachedRange;var i=new B.Range(n.document,n.body);if(m.ie9below){var o=n.getIERange();if(o&&this.rangeInBody(o))try{t(o,i)}catch(r){e(i)}else e(i)}else{var a=n.getNative();if(a&&a.rangeCount&&n.rangeInBody(a.getRangeAt(0)))o=a.getRangeAt(0),a=a.getRangeAt(a.rangeCount-1),i.setStart(o.startContainer,o.startOffset).setEnd(a.endContainer,a.endOffset),i.collapsed&&k.isBody(i.startContainer)&&!i.startOffset&&e(i);else{if(this._bakRange&&(this._bakRange.startContainer===this.body||k.inDoc(this._bakRange.startContainer,this.body)))return this._bakRange;e(i)}}return this._bakRange=i},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var e,t,n=m.ie9below?this.getIERange():this.getRange();if(m.ie9below){if(!n)return this.document.body.firstChild;if(n.item)return n.item(0);for(e=n.duplicate(),0<e.text.length&&e.moveStart("character",1),e.collapse(1),e=e.parentElement(),t=n=n.parentElement();n=n.parentNode;)if(n==e){e=t;break}}else if(e=n.startContainer,1==e.nodeType&&e.hasChildNodes()&&(e=e.childNodes[Math.min(e.childNodes.length-1,n.startOffset)]),3==e.nodeType)return e.parentNode;return e},getText:function(){var e;return this.isFocus()&&(e=this.getNative())?(e=m.ie9below?e.createRange():e.getRangeAt(0),m.ie9below?e.text:e.toString()):""}}}(),function(){function e(e,t){var i;if(t.textarea)if(n.isString(t.textarea)){for(var o,r=0,a=k.getElementsByTagName(e,"textarea");o=a[r++];)if(o.id=="umeditor_textarea_"+t.options.textarea){i=o;break}}else i=t.textarea;i||(e.appendChild(i=k.createElement(document,"textarea",{name:t.options.textarea,id:"umeditor_textarea_"+t.options.textarea,style:"display:none"})),t.textarea=i),i.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,!0):""}function t(e){for(var t in UM.plugins)-1==e.options.excludePlugins.indexOf(t)&&(UM.plugins[t].call(e),e.plugins[t]=1);e.langIsReady=!0,e.fireEvent("langReady")}function i(e){for(var t in e)return t}var o,r=0,a=UM.Editor=function(e){var o=this;o.uid=r++,I.call(o),o.commands={},o.options=n.extend(n.clone(e||{}),UMEDITOR_CONFIG,!0),o.shortcutkeys={},o.inputRules=[],o.outputRules=[],o.setOpt({isShow:!0,initialContent:"",initialStyle:"",autoClearinitialContent:!1,textarea:"editorValue",focus:!1,focusInEnd:!0,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,enterTag:"p",lang:"zh-cn",langPath:o.options.UMEDITOR_HOME_URL+"lang/",theme:"default",themePath:o.options.UMEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,autoSyncData:!0,autoHeightEnabled:!0,excludePlugins:""}),o.plugins={},n.isEmptyObject(UM.I18N)?n.loadFile(document,{src:o.options.langPath+o.options.lang+"/"+o.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){t(o)}):(o.options.lang=i(UM.I18N),t(o))};a.prototype={ready:function(e){e&&(this.isReady?e.apply(this):this.addListener("ready",e))},setOpt:function(e,t){var i={};n.isString(e)?i[e]=t:i=e,n.extend(this.options,i,!0)},getOpt:function(e){return this.options[e]||""},destroy:function(){this.fireEvent("destroy");var e=this.container.parentNode;e===document.body&&(e=this.container);var t=this.textarea;t?t.style.display="":(t=document.createElement("textarea"),e.parentNode.insertBefore(t,e)),t.style.width=this.body.offsetWidth+"px",t.style.height=this.body.offsetHeight+"px",t.value=this.getContent(),t.id=this.key,e.contains(t)&&g(t).insertBefore(e),e.innerHTML="",k.remove(e),UM.clearCache(this.id);for(var n in this)this.hasOwnProperty(n)&&delete this[n]},initialCont:function(e){if(e){if(e.getAttribute("name")&&(this.options.textarea=e.getAttribute("name")),e&&/script|textarea/gi.test(e.tagName)){var t=document.createElement("div");e.parentNode.insertBefore(t,e),this.options.initialContent=UM.htmlparser(e.value||e.innerHTML||this.options.initialContent).toHtml(),e.className&&(t.className=e.className),e.style.cssText&&(t.style.cssText=e.style.cssText),/textarea/i.test(e.tagName)?(this.textarea=e,this.textarea.style.display="none"):(e.parentNode.removeChild(e),e.id&&(t.id=e.id)),e=t,e.innerHTML=""}return e}return null},render:function(e){var t=this.options,i=function(t){return parseInt(g(e).css(t))};n.isString(e)&&(e=document.getElementById(e)),e&&(this.id=e.getAttribute("id"),UM.setEditor(this),n.cssRule("edui-style-body",this.options.initialStyle,document),e=this.initialCont(e),e.className+=" edui-body-container",t.minFrameWidth=t.initialFrameWidth?t.initialFrameWidth:t.initialFrameWidth=g(e).width()||UM.defaultWidth,t.initialFrameHeight?t.minFrameHeight=t.initialFrameHeight:t.initialFrameHeight=t.minFrameHeight=g(e).height()||UM.defaultHeight,e.style.width=/%$/.test(t.initialFrameWidth)?"100%":t.initialFrameWidth-i("padding-left")-i("padding-right")+"px",i=/%$/.test(t.initialFrameHeight)?"100%":t.initialFrameHeight-i("padding-top")-i("padding-bottom"),this.options.autoHeightEnabled?(e.style.minHeight=i+"px",e.style.height="",m.ie&&6>=m.version&&(e.style.height=i,e.style.setExpression("height","this.scrollHeight <= "+i+' ? "'+i+'px" : "auto"'))):g(e).height(i),e.style.zIndex=t.zIndex,this._setup(e))},_setup:function(t){var n=this,i=n.options;t.contentEditable=!0,document.body.spellcheck=!1,n.document=document,n.window=document.defaultView||document.parentWindow,n.body=t,n.$body=g(t),n.selection=new B.Selection(document,n.body),n._isEnabled=!1;var o;m.gecko&&(o=this.selection.getNative())&&o.removeAllRanges(),this._initEvents();for(var r=t.parentNode;r&&!k.isBody(r);r=r.parentNode)if("FORM"==r.tagName){n.form=r,n.options.autoSyncData?g(t).on("blur",function(){e(r,n)}):g(r).on("submit",function(){e(this,n)});break}if(i.initialContent)if(i.autoClearinitialContent){var a=n.execCommand;n.execCommand=function(){return n.fireEvent("firstBeforeExecCommand"),a.apply(n,arguments)},this._setDefaultContent(i.initialContent)}else this.setContent(i.initialContent,!1,!0);k.isEmptyNode(n.body)&&(n.body.innerHTML="<p>"+(m.ie?"":"<br/>")+"</p>"),i.focus&&setTimeout(function(){n.focus(n.options.focusInEnd),!n.options.autoClearinitialContent&&n._selectionChange()},0),n.container||(n.container=t.parentNode),n._bindshortcutKeys(),n.isReady=1,n.fireEvent("ready"),i.onready&&i.onready.call(n),m.ie&&!m.ie9above||g(n.body).on("blur focus",function(e){var t=n.selection.getNative();if("blur"==e.type)0<t.rangeCount&&(n._bakRange=t.getRangeAt(0));else{try{n._bakRange&&t.addRange(n._bakRange)}catch(i){}n._bakRange=null}}),!i.isShow&&n.setHide(),i.readonly&&n.setDisabled()},sync:function(t){(t=t?document.getElementById(t):k.findParent(this.body.parentNode,function(e){return"FORM"==e.tagName},!0))&&e(t,this)},setHeight:function(e,t){!t&&(this.options.initialFrameHeight=e),this.options.autoHeightEnabled?(g(this.body).css({"min-height":e+"px"}),m.ie&&6>=m.version&&this.container&&(this.container.style.height=e,this.container.style.setExpression("height","this.scrollHeight <= "+e+' ? "'+e+'px" : "auto"'))):g(this.body).height(e),this.fireEvent("resize")},setWidth:function(e){this.$container&&this.$container.width(e),g(this.body).width(e-1*g(this.body).css("padding-left").replace("px","")-1*g(this.body).css("padding-right").replace("px","")),this.fireEvent("resize")},addshortcutkey:function(e,t){var i={};t?i[e]=t:i=e,n.extend(this.shortcutkeys,i)},_bindshortcutKeys:function(){var e=this,t=this.shortcutkeys;e.addListener("keydown",function(n,i){var o,r=i.keyCode||i.which;for(o in t)for(var a,s=t[o].split(","),l=0;a=s[l++];){a=a.split(":");var d=a[0];a=a[1],(/^(ctrl)(\+shift)?\+(\d+)$/.test(d.toLowerCase())||/^(\d+)$/.test(d))&&("ctrl"==RegExp.$1&&(i.ctrlKey||i.metaKey)&&(""!=RegExp.$2?i[RegExp.$2.slice(1)+"Key"]:1)&&r==RegExp.$3||r==RegExp.$1)&&(-1!=e.queryCommandState(o,a)&&e.execCommand(o,a),k.preventDefault(i))}})},getContent:function(e,t,i,o,r){return e&&n.isFunction(e)&&(t=e),(t?t():this.hasContents())?(this.fireEvent("beforegetcontent"),e=UM.htmlparser(this.body.innerHTML,o),this.filterOutputRule(e),this.fireEvent("aftergetcontent",e),e.toHtml(r)):""},getAllHtml:function(){var e=[];if(this.fireEvent("getAllHtml",e),m.ie&&8<m.version){var t="";n.each(this.document.styleSheets,function(e){t+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'" />':"<style>"+e.cssText+"</style>"}),n.each(this.document.getElementsByTagName("script"),function(e){t+=e.outerHTML})}return"<html><head>"+(this.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+this.options.charset+'"/>':"")+(t||this.document.getElementsByTagName("head")[0].innerHTML)+e.join("\n")+"</head><body "+(E&&9>m.version?'class="view"':"")+">"+this.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var e=RegExp(k.fillChar,"g"),t=this.body.innerHTML.replace(/[\n\r]/g,""),t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>\/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,n){return q.$block[n]?"\n":t?t:""});return t.replace(e,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){return this.body[m.ie?"innerText":"textContent"].replace(RegExp(k.fillChar,"g"),"").replace(/\u00a0/g," ")},setContent:function(t,n,i){if(this.fireEvent("beforesetcontent",t),t=UM.htmlparser(t),this.filterInputRule(t),t=t.toHtml(),this.body.innerHTML=(n?this.body.innerHTML:"")+t,"p"==this.options.enterTag)if(n=this.body.firstChild,!n||1==n.nodeType&&(q.$cdata[n.tagName]||"DIV"==n.tagName&&n.getAttribute("cdata_tag")||k.isCustomeNode(n))&&n===this.body.lastChild)this.body.innerHTML="<p>"+(m.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var o=this.document.createElement("p");n;){for(;n&&(3==n.nodeType||1==n.nodeType&&q.p[n.tagName]&&!q.$cdata[n.tagName]);)t=n.nextSibling,o.appendChild(n),n=t;if(o.firstChild){if(!n){this.body.appendChild(o);break}n.parentNode.insertBefore(o,n),o=this.document.createElement("p")}n=n.nextSibling}this.fireEvent("aftersetcontent"),this.fireEvent("contentchange"),!i&&this._selectionChange(),this._bakRange=this._bakIERange=this._bakNativeRange=null;var r;m.gecko&&(r=this.selection.getNative())&&r.removeAllRanges(),this.options.autoSyncData&&this.form&&e(this.form,this)},focus:function(e){try{var t=this.selection.getRange();e?t.setStartAtLast(this.body.lastChild).setCursor(!1,!0):t.select(!0),this.fireEvent("focus")}catch(n){}},blur:function(){var e=this.selection.getNative();e.empty?e.empty():e.removeAllRanges(),this.fireEvent("blur")},isFocus:function(){return!0===this.fireEvent("isfocus")||this.selection.isFocus()},_initEvents:function(){var e=this,t=function(){e._proxyDomEvent.apply(e,arguments)};g(e.body).on("click contextmenu mousedown keydown keyup keypress mouseup mouseover mouseout selectstart",t).on("focus blur",t).on("mouseup keydown",function(t){"keydown"==t.type&&(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)||2!=t.button&&e._selectionChange(250,t)})},_proxyDomEvent:function(e){return this.fireEvent(e.type.replace(/^on/,""),e)},_selectionChange:function(e,t){var n,i,r=this,a=!1;m.ie&&9>m.version&&t&&"mouseup"==t.type&&!this.selection.getRange().collapsed&&(a=!0,n=t.clientX,i=t.clientY),clearTimeout(o),o=setTimeout(function(){if(r.selection.getNative()){var e;if(a&&"None"==r.selection.getNative().type){e=r.document.body.createTextRange();try{e.moveToPoint(n,i)}catch(o){e=null}}var s;e&&(s=r.selection.getIERange,r.selection.getIERange=function(){return e}),r.selection.cache(),s&&(r.selection.getIERange=s),r.selection._cachedRange&&r.selection._cachedStartElement&&(r.fireEvent("beforeselectionchange"),r.fireEvent("selectionchange",!!t),r.fireEvent("afterselectionchange"),r.selection.clear())}},e||50)},_callCmdFn:function(e,t){t=Array.prototype.slice.call(t,0);var n,i,o=t.shift().toLowerCase();return i=(n=this.commands[o]||UM.commands[o])&&n[e],n&&i||"queryCommandState"!=e?i?i.apply(this,[o].concat(t)):void 0:0},execCommand:function(e){if(!this.isFocus()){var t=this.selection._bakRange;t?t.select():this.focus(!0)}e=e.toLowerCase();var n,t=this.commands[e]||UM.commands[e];return t&&t.execCommand?(t.notNeedUndo||this.__hasEnterExecCommand?(n=this._callCmdFn("execCommand",arguments),this.__hasEnterExecCommand||t.ignoreContentChange||this._ignoreContentChange||this.fireEvent("contentchange")):(this.__hasEnterExecCommand=!0,-1!=this.queryCommandState.apply(this,arguments)&&(this.fireEvent("saveScene"),this.fireEvent("beforeexeccommand",e),n=this._callCmdFn("execCommand",arguments),t.ignoreContentChange||this._ignoreContentChange||this.fireEvent("contentchange"),this.fireEvent("afterexeccommand",e),this.fireEvent("saveScene")),this.__hasEnterExecCommand=!1),this.__hasEnterExecCommand||t.ignoreContentChange||this._ignoreContentChange||this._selectionChange(),n):null},queryCommandState:function(e){try{return this._callCmdFn("queryCommandState",arguments)}catch(t){return 0}},queryCommandValue:function(e){try{return this._callCmdFn("queryCommandValue",arguments)}catch(t){return null}},hasContents:function(e){if(e)for(var t,n=0;t=e[n++];)if(0<this.body.getElementsByTagName(t).length)return!0;if(!k.isEmptyBlock(this.body))return!0;for(e=["div"],n=0;t=e[n++];){t=k.getElementsByTagName(this.body,t);for(var i,o=0;i=t[o++];)if(k.isCustomeNode(i))return!0}return!1},reset:function(){this.fireEvent("reset")},isEnabled:function(){return 1!=this._isEnabled},setEnabled:function(){var e;if(this.body.contentEditable=!0,this.lastBk){e=this.selection.getRange();try{e.moveToBookmark(this.lastBk),delete this.lastBk}catch(t){e.setStartAtFirst(this.body).collapse(!0)}e.select(!0)}this.bkqueryCommandState&&(this.queryCommandState=this.bkqueryCommandState,delete this.bkqueryCommandState),this._bkproxyDomEvent&&(this._proxyDomEvent=this._bkproxyDomEvent,delete this._bkproxyDomEvent),this.fireEvent("setEnabled")},enable:function(){return this.setEnabled()},setDisabled:function(e,t){var i=this;i.body.contentEditable=!1,i._except=e?n.isArray(e)?e:[e]:[],i.lastBk||(i.lastBk=i.selection.getRange().createBookmark(!0)),i.bkqueryCommandState||(i.bkqueryCommandState=i.queryCommandState,i.queryCommandState=function(e){return-1!=n.indexOf(i._except,e)?i.bkqueryCommandState.apply(i,arguments):-1}),t||i._bkproxyDomEvent||(i._bkproxyDomEvent=i._proxyDomEvent,i._proxyDomEvent=function(){return!1}),i.fireEvent("selectionchange"),i.fireEvent("setDisabled",i._except)},disable:function(e){return this.setDisabled(e)},_setDefaultContent:function(){function e(){var t=this;t.document.getElementById("initContent")&&(t.body.innerHTML="<p>"+(E?"":"<br/>")+"</p>",t.removeListener("firstBeforeExecCommand focus",e),setTimeout(function(){t.focus(),t._selectionChange()},0))}return function(t){this.body.innerHTML='<p id="initContent">'+t+"</p>",this.addListener("firstBeforeExecCommand focus",e)}}(),setShow:function(){var e=this.selection.getRange();if("none"==this.container.style.display){try{e.moveToBookmark(this.lastBk),delete this.lastBk}catch(t){e.setStartAtFirst(this.body).collapse(!0)}setTimeout(function(){e.select(!0)},100),this.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){this.lastBk||(this.lastBk=this.selection.getRange().createBookmark(!0)),this.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(e){var t=UM.I18N[this.options.lang];if(!t)throw Error("not import language file");e=(e||"").split(".");for(var n,i=0;(n=e[i++])&&(t=t[n]););return t},getContentLength:function(e,t){var n=this.getContent(!1,!1,!0).length;if(e){t=(t||[]).concat(["hr","img","iframe"]);for(var i,n=this.getContentTxt().replace(/[\t\r\n]+/g,"").length,o=0;i=t[o++];)n+=this.body.getElementsByTagName(i).length}return n},addInputRule:function(e,t){e.ignoreUndo=t,this.inputRules.push(e)},filterInputRule:function(e,t){for(var n,i=0;n=this.inputRules[i++];)t&&n.ignoreUndo||n.call(this,e)},addOutputRule:function(e,t){e.ignoreUndo=t,this.outputRules.push(e)},filterOutputRule:function(e,t){for(var n,i=0;n=this.outputRules[i++];)t&&n.ignoreUndo||n.call(this,e)}},n.inherits(a,I)}(),UM.filterWord=function(){function e(e){return e=e.replace(/[\d.]+\w+/g,function(e){return n.transUnitToPx(e)})}function t(t){return t.replace(/[\t\r\n]+/g," ").replace(/\x3c!--[\s\S]*?--\x3e/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(t){if(m.opera)return"";try{if(/Bitmap/i.test(t))return"";var n=t.match(/width:([ \d.]*p[tx])/i)[1],i=t.match(/height:([ \d.]*p[tx])/i)[1],o=t.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+e(n)+'" height="'+e(i)+'" src="'+o+'" />'}catch(r){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/gi,function(e,t,n,i){return"class"==t&&"MsoListParagraph"==i?e:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(e,t,n){return n.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(t,n,i,o){t=[],o=o.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),i=0;for(var r;r=o[i];i++){var a,s=r.split(":");if(2==s.length&&(r=s[0].toLowerCase(),a=s[1].toLowerCase(),!(/^(background)\w*/.test(r)&&0==a.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(r)&&/^0\w+$/.test(a)))){switch(r){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(n)||(t[i]=r.replace(/^mso-|-alt$/g,"")+":"+e(a));continue;case"horiz-align":t[i]="text-align:"+a;continue;case"vert-align":t[i]="vertical-align:"+a;continue;case"font-color":case"mso-foreground":t[i]="color:"+a;continue;case"mso-background":case"mso-highlight":t[i]="background:"+a;continue;case"mso-default-height":t[i]="min-height:"+e(a);continue;case"mso-default-width":t[i]="min-width:"+e(a);continue;case"mso-padding-between-alt":t[i]="border-collapse:separate;border-spacing:"+e(a);continue;case"text-line-through":"single"!=a&&"double"!=a||(t[i]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==a&&(t[i]="display:none");continue;case"margin":if(!/[1-9]/.test(a))continue}/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(r)||/text\-indent|padding|margin/.test(r)&&/\-[\d.]+/.test(a)||(t[i]=r+":"+s[1])}}return n+(t.length?' style="'+t.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(e){return n.transUnitToPx(e)})}return function(e){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/gi.test(e)?t(e):e}}(),function(){function e(e,t,n){return e.push(h),t+(n?1:-1)}function t(e,t){for(var n=0;n<t;n++)e.push(u)}function i(r,a,s,l){switch(r.type){case"root":for(var d,u=0;d=r.children[u++];)s&&"element"==d.type&&!q.$inlineWithA[d.tagName]&&1<u&&(e(a,l,!0),t(a,l)),i(d,a,s,l);break;case"text":"pre"==r.parentNode.tagName?a.push(r.data):a.push(c[r.parentNode.tagName]?n.html(r.data):r.data.replace(/[ ]{2}/g," &nbsp;"));break;case"element":o(r,a,s,l);break;case"comment":a.push("<!--"+r.data+"-->")}return a}function o(o,r,a,s){var l="";if(o.attrs){var c,l=[],u=o.attrs;for(c in u)l.push(c+(void 0!==u[c]?'="'+(d[c]?n.html(u[c]).replace(/["]/g,function(e){return"&quot;"}):n.unhtml(u[c]))+'"':""));l=l.join(" ")}if(r.push("<"+o.tagName+(l?" "+l:"")+(q.$empty[o.tagName]?"/":"")+">"),a&&!q.$inlineWithA[o.tagName]&&"pre"!=o.tagName&&o.children&&o.children.length&&(s=e(r,s,!0),t(r,s)),o.children&&o.children.length)for(l=0;u=o.children[l++];)a&&"element"==u.type&&!q.$inlineWithA[u.tagName]&&1<l&&(e(r,s),t(r,s)),i(u,r,a,s);q.$empty[o.tagName]||(a&&!q.$inlineWithA[o.tagName]&&"pre"!=o.tagName&&o.children&&o.children.length&&(s=e(r,s),t(r,s)),r.push("</"+o.tagName+">"))}function r(e,t){var n;if("element"==e.type&&e.getAttr("id")==t)return e;if(e.children&&e.children.length)for(var i=0;n=e.children[i++];)if(n=r(n,t))return n}function a(e,t,n){if("element"==e.type&&e.tagName==t&&n.push(e),e.children&&e.children.length)for(var i,o=0;i=e.children[o++];)a(i,t,n)}function s(e,t){if(e.children&&e.children.length)for(var n,i=0;n=e.children[i];)s(n,t),n.parentNode&&(n.children&&n.children.length&&t(n),n.parentNode&&i++);else t(e)}var l=UM.uNode=function(e){this.type=e.type,this.data=e.data,this.tagName=e.tagName,this.parentNode=e.parentNode,this.attrs=e.attrs||{},this.children=e.children},d={href:1,src:1,_src:1,_href:1,cdata_data:1},c={style:1,script:1},u="    ",h="\n";l.createElement=function(e){return/[<>]/.test(e)?UM.htmlparser(e).children[0]:new l({type:"element",children:[],tagName:e})},l.createText=function(e,t){return new UM.uNode({type:"text",data:t?e:n.unhtml(e||"")})},l.prototype={toHtml:function(e){var t=[];return i(this,t,e,0),t.join("")},innerHTML:function(e){if("element"!=this.type||q.$empty[this.tagName])return this;if(n.isString(e)){if(this.children)for(var t,i=0;t=this.children[i++];)t.parentNode=null;for(this.children=[],e=UM.htmlparser(e),i=0;t=e.children[i++];)this.children.push(t),t.parentNode=this;return this}return e=new UM.uNode({type:"root",children:this.children}),e.toHtml()},innerText:function(e,t){if("element"!=this.type||q.$empty[this.tagName])return this;if(e){if(this.children)for(var n,i=0;n=this.children[i++];)n.parentNode=null;return this.children=[],this.appendChild(l.createText(e,t)),this}return this.toHtml().replace(/<[^>]+>/g,"")},getData:function(){return"element"==this.type?"":this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){for(var e,t=this.parentNode,n=0;e=t.children[n];n++)if(e===this)return 0==n?null:t.children[n-1]},nextSibling:function(){for(var e,t=this.parentNode,n=0;e=t.children[n++];)if(e===this)return t.children[n]},replaceChild:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n,i=0;n=this.children[i];i++)if(n===t)return this.children.splice(i,1,e),t.parentNode=null,e.parentNode=this,e}},appendChild:function(e){if("root"==this.type||"element"==this.type&&!q.$empty[this.tagName]){this.children||(this.children=[]),e.parentNode&&e.parentNode.removeChild(e);for(var t,n=0;t=this.children[n];n++)if(t===e){this.children.splice(n,1);break}return this.children.push(e),e.parentNode=this,e}},insertBefore:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n,i=0;n=this.children[i];i++)if(n===t)return this.children.splice(i,0,e),e.parentNode=this,e}},insertAfter:function(e,t){if(this.children){e.parentNode&&e.parentNode.removeChild(e);for(var n,i=0;n=this.children[i];i++)if(n===t)return this.children.splice(i+1,0,e),e.parentNode=this,e}},removeChild:function(e,t){if(this.children)for(var n,i=0;n=this.children[i];i++)if(n===e){if(this.children.splice(i,1),n.parentNode=null,t&&n.children&&n.children.length)for(var o,r=0;o=n.children[r];r++)this.children.splice(i+r,0,o),o.parentNode=this;return n}},getAttr:function(e){return this.attrs&&this.attrs[e.toLowerCase()]},setAttr:function(e,t){if(e)if(this.attrs||(this.attrs={}),n.isObject(e))for(var i in e)e[i]?this.attrs[i.toLowerCase()]=e[i]:delete this.attrs[i];else t?this.attrs[e.toLowerCase()]=t:delete this.attrs[e];else delete this.attrs},hasAttr:function(e){return e=this.getAttr(e),null!==e&&void 0!==e},getIndex:function(){for(var e,t=this.parentNode,n=0;e=t.children[n];n++)if(e===this)return n;return-1},getNodeById:function(e){var t;if(this.children&&this.children.length)for(var n=0;t=this.children[n++];)if(t=r(t,e))return t},getNodesByTagName:function(e){e=n.trim(e).replace(/[ ]{2,}/g," ").split(" ");var t=[],i=this;return n.each(e,function(e){if(i.children&&i.children.length)for(var n,o=0;n=i.children[o++];)a(n,e,t)}),t},getStyle:function(e){var t=this.getAttr("style");return t&&(e=t.match(RegExp("(^|;)\\s*"+e+":([^;]+)","i")))&&e[0]?e[2]:""},setStyle:function(e,t){function i(e,t){o=o.replace(RegExp("(^|;)\\s*"+e+":([^;]+;?)","gi"),"$1"),t&&(o=e+":"+n.unhtml(t)+";"+o)}var o=this.getAttr("style");if(o||(o=""),n.isObject(e))for(var r in e)i(r,e[r]);else i(e,t);this.setAttr("style",n.trim(o))},hasClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class").split(/\s+/),n=!1;return g.each(t,function(t,i){i===e&&(n=!0)}),n}return!1},addClass:function(e){var t=null,n=!1;this.hasAttr("class")?(t=this.getAttr("class"),t=t.split(/\s+/),t.forEach(function(t){t===e&&(n=!0)}),!n&&t.push(e),this.setAttr("class",t.join(" "))):this.setAttr("class",e)},removeClass:function(e){if(this.hasAttr("class")){var t=this.getAttr("class"),t=t.replace(RegExp("\\b"+e+"\\b","g"),"");this.setAttr("class",n.trim(t).replace(/[ ]{2,}/g," "))}},traversal:function(e){return this.children&&this.children.length&&s(this,e),this}}}(),UM.htmlparser=function(e,t){function i(e,t){if(h[e.tagName]){var n=c.createElement(h[e.tagName]);e.appendChild(n),n.appendChild(c.createText(t))}else e.appendChild(c.createText(t))}function o(e,t,i){var r;if(r=u[t]){for(var s,l=e;"root"!=l.type;){if(n.isArray(r)?-1!=n.indexOf(r,l.tagName):r==l.tagName){e=l,s=!0;break}l=l.parentNode}s||(e=o(e,n.isArray(r)?r[0]:r))}if(r=new c({parentNode:e,type:"element",tagName:t.toLowerCase(),children:q.$empty[t]?null:[]}),i){for(l={};s=a.exec(i);)l[s[1].toLowerCase()]=d[s[1].toLowerCase()]?s[2]||s[3]||s[4]:n.unhtml(s[2]||s[3]||s[4]);r.attrs=l}return e.children.push(r),q.$empty[t]?e:r}var r=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)--\x3e)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,a=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,s={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};e=e.replace(RegExp(k.fillChar,"g"),""),t||(e=e.replace(RegExp("[\\r\\t\\n"+(t?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(t?"":" ")+"]*","g"),function(e,n){return n&&s[n.toLowerCase()]?e.replace(/(^[\n\r]+)|([\n\r]+$)/g,""):e.replace(RegExp("^[\\r\\n"+(t?"":" ")+"]+"),"").replace(RegExp("[\\r\\n"+(t?"":" ")+"]+$"),"")}));for(var l,d={href:1,src:1},c=UM.uNode,u={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},h={ol:"li",ul:"li"},f=0,p=0,m=new c({type:"root",children:[]}),g=m;l=r.exec(e);){f=l.index;try{if(f>p&&i(g,e.slice(p,f)),l[3])q.$cdata[g.tagName]?i(g,l[0]):g=o(g,l[3].toLowerCase(),l[4]);else if(l[1]){if("root"!=g.type)if(q.$cdata[g.tagName]&&!q.$cdata[l[1]])i(g,l[0]);else{for(f=g;"element"==g.type&&g.tagName!=l[1].toLowerCase();)if(g=g.parentNode,"root"==g.type)throw g=f,"break";g=g.parentNode}}else l[2]&&g.children.push(new c({type:"comment",data:l[2],parentNode:g}))}catch(v){}p=r.lastIndex}return p<e.length&&i(g,e.slice(p)),m},UM.filterNode=function(){function e(t,i){switch(t.type){case"element":var o;if(o=i[t.tagName])if("-"===o)t.parentNode.removeChild(t);else if(n.isFunction(o)){var r=t.parentNode,a=t.getIndex();if(o(t),t.parentNode){if(t.children)for(o=0;a=t.children[o];)e(a,i),a.parentNode&&o++}else for(o=a;a=r.children[o];)e(a,i),a.parentNode&&o++}else{if((o=o.$)&&t.attrs){var s,a={};for(r in o){if(s=t.getAttr(r),"style"==r&&n.isArray(o[r])){var l=[];n.each(o[r],function(e){var n;(n=t.getStyle(e))&&l.push(e+":"+n)}),s=l.join(";")}s&&(a[r]=s)}t.attrs=a}if(t.children)for(o=0;a=t.children[o];)e(a,i),a.parentNode&&o++}else if(q.$cdata[t.tagName])t.parentNode.removeChild(t);else for(r=t.parentNode,a=t.getIndex(),t.parentNode.removeChild(t,!0),o=a;a=r.children[o];)e(a,i),a.parentNode&&o++;break;case"comment":t.parentNode.removeChild(t)}}return function(t,i){if(n.isEmptyObject(i))return t;var o;(o=i["-"])&&n.each(o.split(" "),function(e){i[e]="-"}),o=0;for(var r;r=t.children[o];)e(r,i),r.parentNode&&o++;return t}}(),UM.commands.inserthtml={execCommand:function(e,t,i){var o,r=this;if(t&&!0!==r.fireEvent("beforeinserthtml",t)){if(o=r.selection.getRange(),e=o.document.createElement("div"),e.style.display="inline",i||(t=UM.htmlparser(t),r.options.filterRules&&UM.filterNode(t,r.options.filterRules),r.filterInputRule(t),t=t.toHtml()),e.innerHTML=n.trim(t),!o.collapsed&&(t=o.startContainer,k.isFillChar(t)&&o.setStartBefore(t),t=o.endContainer,k.isFillChar(t)&&o.setEndAfter(t),o.txtToElmBoundary(),o.endContainer&&1==o.endContainer.nodeType&&(t=o.endContainer.childNodes[o.endOffset])&&k.isBr(t)&&o.setEndAfter(t),0==o.startOffset&&(t=o.startContainer,k.isBoundaryNode(t,"firstChild")&&(t=o.endContainer,o.endOffset==(3==t.nodeType?t.nodeValue.length:t.childNodes.length)&&k.isBoundaryNode(t,"lastChild")&&(r.body.innerHTML="<p>"+(m.ie?"":"<br/>")+"</p>",o.setStart(r.body.firstChild,0).collapse(!0)))),!o.collapsed&&o.deleteContents(),1==o.startContainer.nodeType)){t=o.startContainer.childNodes[o.startOffset];var a;if(t&&k.isBlockElm(t)&&(a=t.previousSibling)&&k.isBlockElm(a)){for(o.setEnd(a,a.childNodes.length).collapse();t.firstChild;)a.appendChild(t.firstChild);k.remove(t)}}var s,l;i=0;var d;for(o.inFillChar()&&(t=o.startContainer,k.isFillChar(t)?(o.setStartBefore(t).collapse(!0),k.remove(t)):k.isFillChar(t,!0)&&(t.nodeValue=t.nodeValue.replace(F,""),
o.startOffset--,o.collapsed&&o.collapse(!0)));t=e.firstChild;){if(i){for(s=r.document.createElement("p");t&&(3==t.nodeType||!q.$block[t.tagName]);)d=t.nextSibling,s.appendChild(t),t=d;s.firstChild&&(t=s)}if(o.insertNode(t),d=t.nextSibling,!i&&t.nodeType==k.NODE_ELEMENT&&k.isBlockElm(t)&&(s=k.findParent(t,function(e){return k.isBlockElm(e)}))&&"body"!=s.tagName.toLowerCase()&&(!q[s.tagName][t.nodeName]||t.parentNode!==s)){if(q[s.tagName][t.nodeName])for(l=t.parentNode;l!==s;)a=l,l=l.parentNode;else a=s;k.breakParent(t,a||l),a=t.previousSibling,k.trimWhiteTextNode(a),a.childNodes.length||k.remove(a),!m.ie&&(c=t.nextSibling)&&k.isBlockElm(c)&&c.lastChild&&!k.isBr(c.lastChild)&&c.appendChild(r.document.createElement("br")),i=1}var c=t.nextSibling;if(!e.firstChild&&c&&k.isBlockElm(c)){o.setStart(c,0).collapse(!0);break}o.setEndAfter(t).collapse()}if(t=o.startContainer,d&&k.isBr(d)&&k.remove(d),k.isBlockElm(t)&&k.isEmptyNode(t))if(d=t.nextSibling)k.remove(t),1==d.nodeType&&q.$block[d.tagName]&&o.setStart(d,0).collapse(!0).shrinkBoundary();else try{t.innerHTML=m.ie?k.fillChar:"<br/>"}catch(u){o.setStartBefore(t),k.remove(t)}try{if(m.ie9below&&1==o.startContainer.nodeType&&!o.startContainer.childNodes[o.startOffset]&&(a=o.startContainer.childNodes[o.startOffset-1])&&1==a.nodeType&&q.$empty[a.tagName]){var h=this.document.createTextNode(k.fillChar);o.insertNode(h).setStart(h,0).collapse(!0)}setTimeout(function(){o.select(!0)})}catch(f){}setTimeout(function(){o=r.selection.getRange(),o.scrollIntoView(),r.fireEvent("afterinserthtml")},200)}}},UM.commands.insertimage={execCommand:function(e,t){if(t=n.isArray(t)?t:[t],t.length){var i,o=[],r="";if(i=t[0],1==t.length)r='<img src="'+i.src+'" '+(i._src?' _src="'+i._src+'" ':"")+(i.width?'width="'+i.width+'" ':"")+(i.height?' height="'+i.height+'" ':"")+("left"==i.floatStyle||"right"==i.floatStyle?' style="float:'+i.floatStyle+';"':"")+(i.title&&""!=i.title?' title="'+i.title+'"':"")+(i.border&&"0"!=i.border?' border="'+i.border+'"':"")+(i.alt&&""!=i.alt?' alt="'+i.alt+'"':"")+(i.hspace&&"0"!=i.hspace?' hspace = "'+i.hspace+'"':"")+(i.vspace&&"0"!=i.vspace?' vspace = "'+i.vspace+'"':"")+"/>","center"==i.floatStyle&&(r='<p style="text-align: center">'+r+"</p>"),o.push(r);else for(var a=0;i=t[a++];)r="<p "+("center"==i.floatStyle?'style="text-align: center" ':"")+'><img src="'+i.src+'" '+(i.width?'width="'+i.width+'" ':"")+(i._src?' _src="'+i._src+'" ':"")+(i.height?' height="'+i.height+'" ':"")+' style="'+(i.floatStyle&&"center"!=i.floatStyle?"float:"+i.floatStyle+";":"")+(i.border||"")+'" '+(i.title?' title="'+i.title+'"':"")+" /></p>",o.push(r);this.execCommand("insertHtml",o.join(""),!0)}}},UM.plugins.justify=function(){var e=this;g.each(["justifyleft","justifyright","justifycenter","justifyfull"],function(t,n){e.commands[n]={execCommand:function(e){return this.document.execCommand(e)},queryCommandValue:function(e){var t=this.document.queryCommandValue(e);return!0===t||"true"===t?e.replace(/justify/,""):""},queryCommandState:function(e){return this.document.queryCommandState(e)?1:0}}})},UM.plugins.font=function(){var e=this,t={forecolor:"forecolor",backcolor:"backcolor",fontsize:"fontsize",fontfamily:"fontname"},i={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"},o={forecolor:"color",fontsize:"size",fontfamily:"face"};e.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"},{name:"sans-serif",val:"sans-serif"}],fontsize:[10,12,16,18,24,32,48]}),e.addOutputRule(function(e){n.each(e.getNodesByTagName("font"),function(e){if("font"==e.tagName){var t,n=[];for(t in e.attrs)switch(t){case"size":var i=e.attrs[t];g.each({10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"},function(e,t){if(t==i)return i=e,!1}),n.push("font-size:"+i+"px");break;case"color":n.push("color:"+e.attrs[t]);break;case"face":n.push("font-family:"+e.attrs[t]);break;case"style":n.push(e.attrs[t])}e.attrs={style:n.join(";")}}e.tagName="span","span"==e.parentNode.tagName&&1==e.parentNode.children.length&&(g.each(e.attrs,function(t,n){e.parentNode.attrs[t]="style"==t?e.parentNode.attrs[t]+n:n}),e.parentNode.removeChild(e,!0))})});for(var r in t)(function(r){e.commands[r]={execCommand:function(e,n){if("transparent"!=n){var o=this.selection.getRange();if(!o.collapsed){if("fontsize"==e&&(n={10:"1",12:"2",16:"3",18:"4",24:"5",32:"6",48:"7"}[(n+"").replace(/px/,"")]),this.document.execCommand(t[e],!1,n),m.gecko&&g.each(this.$body.find("a"),function(e,t){var n=t.parentNode;if(n.lastChild===n.firstChild&&/FONT|SPAN/.test(n.tagName)){var i=n.cloneNode(!1);i.innerHTML=t.innerHTML,g(t).html("").append(i).insertBefore(n),g(n).remove()}}),!m.ie){var r=this.selection.getNative().getRangeAt(0).commonAncestorContainer,o=this.selection.getRange(),a=o.createBookmark(!0);g(r).find("a").each(function(e,t){var n=t.parentNode;"FONT"==n.nodeName&&(n=n.cloneNode(!1),n.innerHTML=t.innerHTML,g(t).html("").append(n))}),o.moveToBookmark(a).select()}return!0}var r=g("<span></span>").css(i[e],n)[0];o.insertNode(r).setStart(r,0).setCursor()}},queryCommandValue:function(t){var r=e.selection.getStart(),a=g(r).css(i[t]);return void 0===a&&(a=g(r).attr(o[t])),a?n.fixColor(t,a).replace(/px/,""):""},queryCommandState:function(e){return this.queryCommandValue(e)}}})(r)},UM.plugins.link=function(){this.setOpt("autourldetectinie",!1),m.ie&&!1===this.options.autourldetectinie&&this.addListener("keyup",function(e,t){var n=t.keyCode;if(13==n||32==n){var i=this.selection.getRange().startContainer;13==n?"P"==i.nodeName&&(n=i.previousSibling)&&1==n.nodeType&&(n=n.lastChild)&&"A"==n.nodeName&&!n.getAttribute("_href")&&k.remove(n,!0):32==n&&3==i.nodeType&&/^\s$/.test(i.nodeValue)&&(i=i.previousSibling)&&"A"==i.nodeName&&!i.getAttribute("_href")&&k.remove(i,!0)}}),this.addOutputRule(function(e){g.each(e.getNodesByTagName("a"),function(e,t){var i=n.html(t.getAttr("_href"));/^(ftp|https?|\/|file)/.test(i)||(i="http://"+i),t.setAttr("href",i),t.setAttr("_href"),""==t.getAttr("title")&&t.setAttr("title")})}),this.addInputRule(function(e){g.each(e.getNodesByTagName("a"),function(e,t){t.setAttr("_href",n.html(t.getAttr("href")))})}),this.commands.link={execCommand:function(e,t){var i=this.selection.getRange();if(i.collapsed){var o=i.startContainer;(o=k.findParentByTagName(o,"a",!0))?(g(o).attr(t),i.selectNode(o).select()):i.insertNode(g("<a>"+t.href+"</a>").attr(t)[0]).select()}else this.document.execCommand("createlink",!1,"_umeditor_link"),n.each(k.getElementsByTagName(this.body,"a",function(e){return"_umeditor_link"==e.getAttribute("href")}),function(e){"_umeditor_link"==g(e).text()&&g(e).text(t.href),k.setAttributes(e,t),i.selectNode(e).select()})},queryCommandState:function(){return this.queryCommandValue("link")?1:0},queryCommandValue:function(){var e,t=this.selection.getStartElementPath();return g.each(t,function(t,n){if("A"==n.nodeName)return e=n,!1}),e}},this.commands.unlink={execCommand:function(){this.document.execCommand("unlink")}}},UM.commands.print={execCommand:function(){var e="editor_print_"+ +new Date;g('<iframe src="" id="'+e+'" name="'+e+'" frameborder="0"></iframe>').attr("id",e).css({width:"0px",height:"0px",overflow:"hidden","float":"left",position:"absolute",top:"-10000px",left:"-10000px"}).appendTo(this.$container.find(".edui-dialog-container"));var t=window.open("",e,"").document;t.open(),t.write("<html><head></head><body><div>"+this.getContent(null,null,!0)+"</div><script>setTimeout(function(){window.print();setTimeout(function(){window.parent.$('#"+e+"').remove();},100);},200);</script></body></html>"),t.close()},notNeedUndo:1},UM.plugins.paragraph=function(){this.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""}),this.commands.paragraph={execCommand:function(e,t){return this.document.execCommand("formatBlock",!1,"<"+t+">")},queryCommandValue:function(){try{var e=this.document.queryCommandValue("formatBlock")}catch(t){}return e}}},UM.plugins.horizontal=function(){var e=this;e.commands.horizontal={execCommand:function(){this.document.execCommand("insertHorizontalRule");var t=e.selection.getRange().txtToElmBoundary(!0),n=t.startContainer;if(k.isBody(t.startContainer))(n=t.startContainer.childNodes[t.startOffset])||(n=g("<p></p>").appendTo(t.startContainer).html(m.ie?"&nbsp;":"<br/>")[0]),t.setStart(n,0).setCursor();else{for(;q.$inline[n.tagName]&&n.lastChild===n.firstChild;){var i=n.parentNode;i.appendChild(n.firstChild),i.removeChild(n),n=i}for(;q.$inline[n.tagName];)n=n.parentNode;1==n.childNodes.length&&"HR"==n.lastChild.nodeName?(i=n.lastChild,g(i).insertBefore(n),t.setStart(n,0).setCursor()):(i=g("hr",n)[0],k.breakParent(i,n),(n=i.previousSibling)&&k.isEmptyBlock(n)&&g(n).remove(),t.setStart(i.nextSibling,0).setCursor())}}}},UM.commands.cleardoc={execCommand:function(){var e=this,t=e.selection.getRange();e.body.innerHTML="<p>"+(E?"":"<br/>")+"</p>",t.setStart(e.body.firstChild,0).setCursor(!1,!0),setTimeout(function(){e.fireEvent("clearDoc")},0)}},UM.plugins.undo=function(){function e(e,t){if(e.length!=t.length)return 0;for(var n=0,i=e.length;n<i;n++)if(e[n]!=t[n])return 0;return 1}function t(){this.undoManger.save()}var i,o=this.options.maxUndoCount||20,r=this.options.maxInputCount||20,a=RegExp(k.fillChar+"|</hr>","gi"),s={ol:1,ul:1,table:1,tbody:1,tr:1,body:1},l=this.options.autoClearEmptyNode;this.undoManger=new function(){this.list=[],this.index=0,this.hasRedo=this.hasUndo=!1,this.undo=function(){if(this.hasUndo)if(this.list[this.index-1]||1!=this.list.length){for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}else this.reset()},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var e=this.editor,t=this.list[this.index],i=UM.htmlparser(t.content.replace(a,""));e.options.autoClearEmptyNode=!1,e.filterInputRule(i,!0),e.options.autoClearEmptyNode=l,e.body.innerHTML=i.toHtml(),e.fireEvent("afterscencerestore"),m.ie&&n.each(k.getElementsByTagName(e.document,"td th caption p"),function(t){k.isEmptyNode(t)&&k.fillNode(e.document,t)});try{var o=new B.Range(e.document,e.body).moveToAddress(t.address);if(m.ie&&o.collapsed&&1==o.startContainer.nodeType){var r=o.startContainer.childNodes[o.startOffset];(!r||1==r.nodeType&&q.$empty[r])&&o.insertNode(e.document.createTextNode(" ")).collapse(!0)}o.select(s[o.startContainer.nodeName.toLowerCase()])}catch(d){}this.update(),this.clearKey(),e.fireEvent("reset",!0)},this.getScene=function(){var e=this.editor,t=e.selection.getRange().createAddress(!1,!0);e.fireEvent("beforegetscene");var n=UM.htmlparser(e.body.innerHTML,!0);return e.options.autoClearEmptyNode=!1,e.filterOutputRule(n,!0),e.options.autoClearEmptyNode=l,n=n.toHtml(),m.ie&&(n=n.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">")),e.fireEvent("aftergetscene"),{address:t,content:n}},this.save=function(t,n){clearTimeout(i);var r,a=this.getScene(n),s=this.list[this.index];(r=s)&&(r=s.content==a.content)&&(t?s=1:(s=s.address,r=a.address,s=s.collapsed!=r.collapsed?0:e(s.startAddress,r.startAddress)&&e(s.endAddress,r.endAddress)?1:0),r=s),r||(this.list=this.list.slice(0,this.index+1),this.list.push(a),this.list.length>o&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=!!this.list[this.index+1],this.hasUndo=!!this.list[this.index-1]},this.reset=function(){this.list=[],this.index=0,this.hasRedo=this.hasUndo=!1,this.clearKey()},this.clearKey=function(){c=0}},this.undoManger.editor=this,this.addListener("saveScene",function(){var e=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,e)}),this.addListener("beforeexeccommand",t),this.addListener("afterexeccommand",t),this.addListener("reset",function(e,t){t||this.undoManger.reset()}),this.commands.redo=this.commands.undo={execCommand:function(e){this.undoManger[e]()},queryCommandState:function(e){return this.undoManger["has"+("undo"==e.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var d={16:1,17:1,18:1,37:1,38:1,39:1,40:1},c=0,u=!1;this.addListener("ready",function(){g(this.body).on("compositionstart",function(){u=!0}).on("compositionend",function(){u=!1})}),this.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89,shift+ctrl+z"});var h=!0;this.addListener("keydown",function(e,t){var n=this;if(!(d[t.keyCode||t.which]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey||u))if(n.selection.getRange().collapsed){0==n.undoManger.list.length&&n.undoManger.save(!0),clearTimeout(i);var o=function(e){e.selection.getRange().collapsed&&e.fireEvent("contentchange"),e.undoManger.save(!1,!0),e.fireEvent("selectionchange")};i=setTimeout(function(){if(u)var e=setInterval(function(){u||(o(n),clearInterval(e))},300);else o(n)},200),c++,c>=r&&o(n)}else n.undoManger.save(!1,!0),h=!1}),this.addListener("keyup",function(e,t){d[t.keyCode||t.which]||t.ctrlKey||t.metaKey||t.shiftKey||t.altKey||u||h||(this.undoManger.save(!1,!0),h=!0)})},UM.plugins.paste=function(){function e(e){var t=this.document;if(!t.getElementById("baidu_pastebin")){var n=this.selection.getRange(),i=n.createBookmark(),o=t.createElement("div");o.id="baidu_pastebin",m.webkit&&o.appendChild(t.createTextNode(k.fillChar+k.fillChar)),this.body.appendChild(o),i.start.style.display="",o.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+g(i.start).position().top+"px",n.selectNodeContents(o).select(!0),setTimeout(function(){if(m.webkit)for(var r,a=0,s=t.querySelectorAll("#baidu_pastebin");r=s[a++];){if(!k.isEmptyNode(r)){o=r;break}k.remove(r)}try{o.parentNode.removeChild(o)}catch(l){}n.moveToBookmark(i).select(!0),e(o)},0)}}function t(e){var t;if(e.firstChild){var o=k.getElementsByTagName(e,"span");t=0;for(var r;r=o[t++];)"_baidu_cut_start"!=r.id&&"_baidu_cut_end"!=r.id||k.remove(r);if(m.webkit){for(r=e.querySelectorAll("div br"),t=0;o=r[t++];)o=o.parentNode,"DIV"==o.tagName&&1==o.childNodes.length&&(o.innerHTML="<p><br/></p>",k.remove(o));for(o=e.querySelectorAll("#baidu_pastebin"),t=0;r=o[t++];){var a=i.document.createElement("p");for(r.parentNode.insertBefore(a,r);r.firstChild;)a.appendChild(r.firstChild);k.remove(r)}for(r=e.querySelectorAll("meta"),t=0;o=r[t++];)k.remove(o);for(r=e.querySelectorAll("br"),t=0;o=r[t++];)/^apple-/i.test(o.className)&&k.remove(o)}if(m.gecko)for(r=e.querySelectorAll("[_moz_dirty]"),t=0;o=r[t++];)o.removeAttribute("_moz_dirty");if(!m.ie)for(r=e.querySelectorAll("span.Apple-style-span"),t=0;o=r[t++];)k.remove(o,!0);t=e.innerHTML,t=UM.filterWord(t),e=UM.htmlparser(t),i.options.filterRules&&UM.filterNode(e,i.options.filterRules),i.filterInputRule(e),m.webkit&&((t=e.lastChild())&&"element"==t.type&&"br"==t.tagName&&e.removeChild(t),n.each(i.body.querySelectorAll("div"),function(e){k.isEmptyBlock(e)&&k.remove(e)})),t={html:e.toHtml()},i.fireEvent("beforepaste",t,e),t.html&&(i.execCommand("insertHtml",t.html,!0),i.fireEvent("afterpaste",t))}}var i=this;i.addListener("ready",function(){g(i.body).on("cut",function(){!i.selection.getRange().collapsed&&i.undoManger&&i.undoManger.save()}).on(m.ie||m.opera?"keydown":"paste",function(n){(!m.ie&&!m.opera||(n.ctrlKey||n.metaKey)&&"86"==n.keyCode)&&e.call(i,function(e){t(e)})})})},UM.plugins.list=function(){this.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}}),this.addInputRule(function(e){n.each(e.getNodesByTagName("li"),function(e){0==e.children.length&&e.parentNode.removeChild(e)})}),this.commands.insertorderedlist=this.commands.insertunorderedlist={execCommand:function(e){this.document.execCommand(e),e=this.selection.getRange();var t=e.createBookmark(!0);return this.$body.find("ol,ul").each(function(e,t){var n=t.parentNode;"P"==n.tagName&&n.lastChild===n.firstChild&&(g(t).children().each(function(e,t){var i=n.cloneNode(!1);g(i).append(t.innerHTML),g(t).html("").append(i)}),g(t).insertBefore(n),g(n).remove()),q.$inline[n.tagName]&&("SPAN"==n.tagName&&g(t).children().each(function(e,t){var i=n.cloneNode(!1);if("P"!=t.firstChild.nodeName){for(;t.firstChild;)i.appendChild(t.firstChild);g("<p></p>").appendTo(t).append(i)}else{for(;t.firstChild;)i.appendChild(t.firstChild);g(t.firstChild).append(i)}}),k.remove(n,!0))}),e.moveToBookmark(t).select(),!0},queryCommandState:function(e){return this.document.queryCommandState(e)}}},function(){var e={textarea:function(e,t){var n=t.ownerDocument.createElement("textarea");return n.style.cssText="resize:none;border:0;padding:0;margin:0;overflow-y:auto;outline:0",m.ie&&8>m.version&&(n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px",t.onresize=function(){n.style.width=t.offsetWidth+"px",n.style.height=t.offsetHeight+"px"}),t.appendChild(n),{container:n,setContent:function(e){n.value=e},getContent:function(){return n.value},select:function(){var e;m.ie?(e=n.createTextRange(),e.collapse(!0),e.select()):(n.setSelectionRange(0,0),n.focus())},dispose:function(){t.removeChild(n),t=n=t.onresize=null}}}};UM.plugins.source=function(){var t,n=this,i=!1;this.options.sourceEditor="textarea",n.setOpt({sourceEditorFirst:!1});var o,r=n.getContent;n.commands.source={execCommand:function(){if(i=!i){o=n.selection.getRange().createAddress(!1,!0),n.undoManger&&n.undoManger.save(!0),m.gecko&&(n.body.contentEditable=!1),n.body.style.cssText+=";position:absolute;left:-32768px;top:-32768px;",n.fireEvent("beforegetcontent");var a=UM.htmlparser(n.body.innerHTML);n.filterOutputRule(a),a.traversal(function(e){if("element"==e.type)switch(e.tagName){case"td":case"th":case"caption":e.children&&1==e.children.length&&"br"==e.firstChild().tagName&&e.removeChild(e.firstChild());break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}),n.fireEvent("aftergetcontent"),a=a.toHtml(!0),t=e.textarea(n,n.body.parentNode),t.setContent(a),g(t.container).width(g(n.body).width()+parseInt(g(n.body).css("padding-left"))+parseInt(g(n.body).css("padding-right"))).height(g(n.body).height()),setTimeout(function(){t.select()}),n.getContent=function(){return t.getContent()||"<p>"+(m.ie?"":"<br/>")+"</p>"}}else{n.$body.css({position:"",left:"",top:""}),a=t.getContent()||"<p>"+(m.ie?"":"<br/>")+"</p>",a=a.replace(RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){return t&&!q.$inlineWithA[t.toLowerCase()]?e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,""):e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")}),n.setContent(a),t.dispose(),t=null,n.getContent=r,n.body.firstChild||(n.body.innerHTML="<p>"+(m.ie?"":"<br/>")+"</p>"),n.undoManger&&n.undoManger.save(!0),m.gecko&&(n.body.contentEditable=!0);try{n.selection.getRange().moveToAddress(o).select()}catch(s){}}this.fireEvent("sourcemodechanged",i)},queryCommandState:function(){return 0|i},notNeedUndo:1};var a=n.queryCommandState;n.queryCommandState=function(e){return e=e.toLowerCase(),i?e in{source:1,fullscreen:1}?a.apply(this,arguments):-1:a.apply(this,arguments)}}}(),UM.plugins.enterkey=function(){var e,t=this,n=t.options.enterTag;t.addListener("keyup",function(n,i){if(13==(i.keyCode||i.which)){var o,r=t.selection.getRange(),a=r.startContainer;if(m.ie)t.fireEvent("saveScene",!0,!0);else{if(/h\d/i.test(e)){if(m.gecko)k.findParentByTagName(a,"h1 h2 h3 h4 h5 h6 blockquote caption table".split(" "),!0)||(t.document.execCommand("formatBlock",!1,"<p>"),o=1);else if(1==a.nodeType){var s,a=t.document.createTextNode("");if(r.insertNode(a),s=k.findParentByTagName(a,"div",!0)){for(o=t.document.createElement("p");s.firstChild;)o.appendChild(s.firstChild);s.parentNode.insertBefore(o,s),k.remove(s),r.setStartBefore(a).setCursor(),o=1}k.remove(a)}t.undoManger&&o&&t.undoManger.save()}m.opera&&r.select()}}}),t.addListener("keydown",function(i,o){if(13==(o.keyCode||o.which))if(t.fireEvent("beforeenterkeydown"))k.preventDefault(o);else{t.fireEvent("saveScene",!0,!0),e="";var r=t.selection.getRange();if(!r.collapsed){var a=r.startContainer,s=r.endContainer,a=k.findParentByTagName(a,"td",!0),s=k.findParentByTagName(s,"td",!0);if(a&&s&&a!==s||!a&&s||a&&!s)return void(o.preventDefault?o.preventDefault():o.returnValue=!1)}"p"!=n||m.ie||((a=k.findParentByTagName(r.startContainer,"ol ul p h1 h2 h3 h4 h5 h6 blockquote caption".split(" "),!0))||m.opera?(e=a.tagName,"p"==a.tagName.toLowerCase()&&m.gecko&&k.removeDirtyAttr(a)):(t.document.execCommand("formatBlock",!1,"<p>"),m.gecko&&(r=t.selection.getRange(),(a=k.findParentByTagName(r.startContainer,"p",!0))&&k.removeDirtyAttr(a))))}}),m.ie&&t.addListener("setDisabled",function(){g(t.body).find("p").each(function(e,t){k.isEmptyBlock(t)&&(t.innerHTML="&nbsp;")})})},UM.commands.preview={execCommand:function(){var e=window.open("","_blank","").document,t=this.getContent(null,null,!0),n=this.getOpt("UMEDITOR_HOME_URL"),n=-1!=t.indexOf("mathquill-embedded-latex")?'<link rel="stylesheet" href="'+n+'third-party/mathquill/mathquill.css"/><script src="'+n+'third-party/jquery.min.js"></script><script src="'+n+'third-party/mathquill/mathquill.min.js"></script>':"";e.open(),e.write("<html><head>"+n+"</head><body><div>"+t+"</div></body></html>"),e.close()},notNeedUndo:1},UM.plugins.basestyle=function(){var e=this;e.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+shift+85",strikeThrough:"ctrl+shift+83"}),e.addOutputRule(function(e){g.each(e.getNodesByTagName("b i u strike s"),function(e,t){switch(t.tagName){case"b":t.tagName="strong";break;case"i":t.tagName="em";break;case"u":t.tagName="span",t.setStyle("text-decoration","underline");break;case"s":case"strike":t.tagName="span",t.setStyle("text-decoration","line-through")}})}),g.each("bold underline superscript subscript italic strikethrough".split(" "),function(t,n){e.commands[n]={execCommand:function(e){var t=this.selection.getRange();return t.collapsed&&1!=this.queryCommandState(e)?(e=this.document.createElement({bold:"strong",underline:"u",superscript:"sup",subscript:"sub",italic:"em",strikethrough:"strike"}[e]),t.insertNode(e).setStart(e,0).setCursor(!1),!0):this.document.execCommand(e)},queryCommandState:function(e){if(m.gecko)return this.document.queryCommandState(e);var t=this.selection.getStartElementPath(),n=!1;return g.each(t,function(t,i){switch(e){case"bold":if("STRONG"==i.nodeName||"B"==i.nodeName)return n=1,!1;break;case"underline":if("U"==i.nodeName||"SPAN"==i.nodeName&&"underline"==g(i).css("text-decoration"))return n=1,!1;break;case"superscript":if("SUP"==i.nodeName)return n=1,!1;break;case"subscript":if("SUB"==i.nodeName)return n=1,!1;break;case"italic":if("EM"==i.nodeName||"I"==i.nodeName)return n=1,!1;break;case"strikethrough":if("S"==i.nodeName||"STRIKE"==i.nodeName||"SPAN"==i.nodeName&&"line-through"==g(i).css("text-decoration"))return n=1,!1}}),n}}})},UM.plugins.video=function(){function e(e,t,n,o,r,a){return a?'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+e+'" width="'+t+'" height="'+n+'"'+(r?' style="float:'+r+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >':"<img "+(o?'id="'+o+'"':"")+' width="'+t+'" height="'+n+'" _url="'+e+'" class="edui-faked-video" src="'+i.options.UMEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+i.options.UMEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(r?"float:"+r+";":"")+'" />'}function t(t,i){n.each(t.getNodesByTagName(i?"img":"embed"),function(t){if("edui-faked-video"==t.getAttr("class")){var n=e(i?t.getAttr("_url"):t.getAttr("src"),t.getAttr("width"),t.getAttr("height"),null,t.getStyle("float")||"",i);t.parentNode.replaceChild(UM.uNode.createElement(n),t)}})}var i=this;i.addOutputRule(function(e){t(e,!0)}),i.addInputRule(function(e){t(e)}),i.commands.insertvideo={execCommand:function(t,o){o=n.isArray(o)?o:[o];for(var r,a=[],s=0,l=o.length;s<l;s++)r=o[s],a.push(e(r.url,r.width||420,r.height||280,"tmpVedio"+s,r.align,!1));i.execCommand("inserthtml",a.join(""),!0)},queryCommandState:function(){var e=i.selection.getRange().getClosedNode();return e&&"edui-faked-video"==e.className?1:0}}},UM.plugins.selectall=function(){this.commands.selectall={execCommand:function(){var e=this.body,t=this.selection.getRange();t.selectNodeContents(e),k.isEmptyBlock(e)&&(m.opera&&e.firstChild&&1==e.firstChild.nodeType&&t.setStartAtFirst(e.firstChild),t.collapse(!0)),t.select(!0)},notNeedUndo:1},this.addshortcutkey({selectAll:"ctrl+65"})},UM.plugins.removeformat=function(){this.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),this.commands.removeformat={execCommand:function(e,t,n,i,o){function r(e){if(3==e.nodeType||"span"!=e.tagName.toLowerCase())return 0;if(m.ie){var t=e.attributes;if(t.length){e=0;for(var n=t.length;e<n;e++)if(t[e].specified)return 0;return 1}}return!e.attributes.length}function a(e){var t=e.createBookmark();if(e.collapsed&&e.enlarge(!0),!o){var i=k.findParentByTagName(e.startContainer,"a",!0);i&&e.setStartBefore(i),(i=k.findParentByTagName(e.endContainer,"a",!0))&&e.setEndAfter(i)}for(d=e.createBookmark(),i=d.start;(c=i.parentNode)&&!k.isBlockElm(c);)k.breakParent(i,c),k.clearEmptySibling(i);if(d.end){for(i=d.end;(c=i.parentNode)&&!k.isBlockElm(c);)k.breakParent(i,c),k.clearEmptySibling(i);for(var a,i=k.getNextDomNode(d.start,!1,u);i&&i!=d.end;)a=k.getNextDomNode(i,!0,u),q.$empty[i.tagName.toLowerCase()]||k.isBookmarkNode(i)||(s.test(i.tagName)?n?(k.removeStyle(i,n),r(i)&&"text-decoration"!=n&&k.remove(i,!0)):k.remove(i,!0):q.$tableContent[i.tagName]||q.$list[i.tagName]||(k.removeAttributes(i,l),r(i)&&k.remove(i,!0))),i=a}for(i=d.start.parentNode,!k.isBlockElm(i)||q.$tableContent[i.tagName]||q.$list[i.tagName]||k.removeAttributes(i,l),i=d.end.parentNode,d.end&&k.isBlockElm(i)&&!q.$tableContent[i.tagName]&&!q.$list[i.tagName]&&k.removeAttributes(i,l),e.moveToBookmark(d).moveToBookmark(t),i=e.startContainer,a=e.collapsed;1==i.nodeType&&k.isEmptyNode(i)&&q.$removeEmpty[i.tagName];)t=i.parentNode,e.setStartBefore(i),e.startContainer===e.endContainer&&e.endOffset--,k.remove(i),i=t;if(!a)for(i=e.endContainer;1==i.nodeType&&k.isEmptyNode(i)&&q.$removeEmpty[i.tagName];)t=i.parentNode,e.setEndBefore(i),k.remove(i),i=t}var s=RegExp("^(?:"+(t||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),l=n?[]:(i||this.options.removeFormatAttributes).split(",");e=new B.Range(this.document);var d,c,u=function(e){return 1==e.nodeType};e=this.selection.getRange(),e.collapsed||(a(e),e.select())}}},UM.plugins.keystrokes=function(){var e=this,t=!0;e.addListener("keydown",function(n,i){var o=i.keyCode||i.which,r=e.selection.getRange();if(!(r.collapsed||i.ctrlKey||i.shiftKey||i.altKey||i.metaKey)&&(65<=o&&90>=o||48<=o&&57>=o||96<=o&&111>=o||{13:1,8:1,46:1}[o])){var a=r.startContainer;if(k.isFillChar(a)&&r.setStartBefore(a),a=r.endContainer,k.isFillChar(a)&&r.setEndAfter(a),r.txtToElmBoundary(),r.endContainer&&1==r.endContainer.nodeType&&(a=r.endContainer.childNodes[r.endOffset])&&k.isBr(a)&&r.setEndAfter(a),0==r.startOffset&&(a=r.startContainer,k.isBoundaryNode(a,"firstChild")&&(a=r.endContainer,r.endOffset==(3==a.nodeType?a.nodeValue.length:a.childNodes.length)&&k.isBoundaryNode(a,"lastChild"))))return e.fireEvent("saveScene"),e.body.innerHTML="<p>"+(m.ie?"":"<br/>")+"</p>",r.setStart(e.body.firstChild,0).setCursor(!1,!0),void e._selectionChange()}if(8==o){if(r=e.selection.getRange(),t=r.collapsed,e.fireEvent("delkeydown",i))return;var s;if(r.collapsed&&r.inFillChar()&&(a=r.startContainer,k.isFillChar(a)?(r.setStartBefore(a).shrinkBoundary(!0).collapse(!0),k.remove(a)):(a.nodeValue=a.nodeValue.replace(RegExp("^"+k.fillChar),""),r.startOffset--,r.collapse(!0).select(!0))),a=r.getClosedNode())return e.fireEvent("saveScene"),r.setStartBefore(a),k.remove(a),r.setCursor(),e.fireEvent("saveScene"),void k.preventDefault(i);if(!m.ie&&(a=k.findParentByTagName(r.startContainer,"table",!0),s=k.findParentByTagName(r.endContainer,"table",!0),a&&!s||!a&&s||a!==s))return void i.preventDefault();if(a=r.startContainer,r.collapsed&&1==a.nodeType&&(a=a.childNodes[r.startOffset-1])&&1==a.nodeType&&"BR"==a.tagName&&(e.fireEvent("saveScene"),r.setStartBefore(a).collapse(!0),k.remove(a),r.select(),e.fireEvent("saveScene")),m.chrome&&r.collapsed){for(;0==r.startOffset&&!k.isEmptyBlock(r.startContainer);)r.setStartBefore(r.startContainer);(a=r.startContainer.childNodes[r.startOffset-1])&&"BR"==a.nodeName&&(r.setStartBefore(a),e.fireEvent("saveScene"),g(a).remove(),r.setCursor(),e.fireEvent("saveScene"))}}if(m.gecko&&46==o&&(o=e.selection.getRange(),o.collapsed&&(a=o.startContainer,k.isEmptyBlock(a)))){for(o=a.parentNode;1==k.getChildCount(o)&&!k.isBody(o);)a=o,o=o.parentNode;a===o.lastChild&&i.preventDefault()}}),e.addListener("keyup",function(e,n){var i;if(8==(n.keyCode||n.which)&&!this.fireEvent("delkeyup")){if(i=this.selection.getRange(),i.collapsed){var o;if((o=k.findParentByTagName(i.startContainer,"h1 h2 h3 h4 h5 h6".split(" "),!0))&&k.isEmptyBlock(o)){var r=o.previousSibling;if(r&&"TABLE"!=r.nodeName)return k.remove(o),void i.setStartAtLast(r).setCursor(!1,!0);if((r=o.nextSibling)&&"TABLE"!=r.nodeName)return k.remove(o),void i.setStartAtFirst(r).setCursor(!1,!0)}k.isBody(i.startContainer)&&(o=k.createElement(this.document,"p",{innerHTML:m.ie?k.fillChar:"<br/>"}),i.insertNode(o).setStart(o,0).setCursor(!1,!0))}!t&&(3==i.startContainer.nodeType||1==i.startContainer.nodeType&&k.isEmptyBlock(i.startContainer))&&(m.ie?(o=i.document.createElement("span"),i.insertNode(o).setStartBefore(o).collapse(!0),i.select(),k.remove(o)):i.select())}})},UM.plugins.autosave=function(){function e(e){var a=null;new Date-n<i||(e.hasContents()?(n=new Date,e._saveFlag=null,a=t.body.innerHTML,!1!==e.fireEvent("beforeautosave",{content:a})&&(r.saveLocalData(o,a),e.fireEvent("afterautosave",{content:a}))):o&&r.removeItem(o))}var t=this,n=new Date,i=20,o=null;t.setOpt("saveInterval",500);var r=UM.LocalStorage=function(){function e(){var e=document.createElement("div");return e.style.display="none",e.addBehavior?(e.addBehavior("#default#userdata"),{getItem:function(t){var i=null;try{document.body.appendChild(e),e.load(n),i=e.getAttribute(t),document.body.removeChild(e)}catch(o){}return i},setItem:function(t,i){document.body.appendChild(e),e.setAttribute(t,i),e.save(n),document.body.removeChild(e)},removeItem:function(t){document.body.appendChild(e),e.removeAttribute(t),e.save(n),document.body.removeChild(e)}}):null}var t=window.localStorage||e()||null,n="localStorage";return{saveLocalData:function(e,n){return!(!t||!n)&&(t.setItem(e,n),!0)},getLocalData:function(e){return t?t.getItem(e):null},removeItem:function(e){t&&t.removeItem(e)}}}();t.addListener("ready",function(){var e=null,e=t.key?t.key+"-drafts-data":(t.container.parentNode.id||"ue-common")+"-drafts-data";o=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+e}),t.addListener("contentchange",function(){o&&(t._saveFlag&&window.clearTimeout(t._saveFlag),0<t.options.saveInterval?t._saveFlag=window.setTimeout(function(){e(t)},t.options.saveInterval):e(t))}),t.commands.clearlocaldata={execCommand:function(e,t){o&&r.getLocalData(o)&&r.removeItem(o)},notNeedUndo:!0,ignoreContentChange:!0},t.commands.getlocaldata={execCommand:function(e,t){return o?r.getLocalData(o)||"":""},notNeedUndo:!0,ignoreContentChange:!0
},t.commands.drafts={execCommand:function(e,n){o&&(t.body.innerHTML=r.getLocalData(o)||"<p>"+(m.ie?"&nbsp;":"<br/>")+"</p>",t.focus(!0))},queryCommandState:function(){return o?null===r.getLocalData(o)?-1:0:-1},notNeedUndo:!0,ignoreContentChange:!0}},UM.plugins.autoupload=function(){var a=this;a.setOpt("pasteImageEnabled",!0),a.setOpt("dropFileEnabled",!0);var b=function(b,d){var e=new FormData;e.append(d.options.imageFieldName||"upfile",b,b.name||"blob."+b.type.substr(6)),e.append("type","ajax");var f=new XMLHttpRequest;f.open("post",a.options.imageUrl,!0),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.addEventListener("load",function(b){try{var c=eval("("+b.target.response+")").url,e=a.options.imagePath+c;d.execCommand("insertimage",{src:e,_src:e})}catch(f){}}),f.send(e)};a.addListener("ready",function(){if(window.FormData&&window.FileReader){var e=function(e){var t=!1;if("paste"==e.type?(e=e.originalEvent,e=e.clipboardData&&e.clipboardData.items&&1==e.clipboardData.items.length&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null):(e=e.originalEvent,e=e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null),e){for(var n,i=e.length;i--;)n=e[i],n.getAsFile&&(n=n.getAsFile()),n&&0<n.size&&/image\/\w+/i.test(n.type)&&(b(n,a),t=!0);if(t)return!1}};a.getOpt("pasteImageEnabled")&&a.$body.on("paste",e),a.getOpt("dropFileEnabled")&&a.$body.on("drop",e),a.$body.on("dragover",function(e){if("Files"==e.originalEvent.dataTransfer.types[0])return!1})}})},UM.plugins.formula=function(){function e(){return i.$body.find("iframe.edui-formula-active")[0]||null}function t(){var t=e();t&&t.contentWindow.formula.blur()}var i=this;i.addInputRule(function(e){g.each(e.getNodesByTagName("span"),function(e,t){if(t.hasClass("mathquill-embedded-latex")){for(var o,r="";o=t.firstChild();)r+=o.data,t.removeChild(o);t.tagName="iframe",t.setAttr({frameborder:"0",src:i.getOpt("UMEDITOR_HOME_URL")+"dialogs/formula/formula.html","data-latex":n.unhtml(r)})}})}),i.addOutputRule(function(e){g.each(e.getNodesByTagName("iframe"),function(e,t){t.hasClass("mathquill-embedded-latex")&&(t.tagName="span",t.appendChild(UM.uNode.createText(t.getAttr("data-latex"))),t.setAttr({frameborder:"",src:"","data-latex":""}))})}),i.addListener("click",function(){t()}),i.addListener("afterexeccommand",function(e,n){"formula"!=n&&t()}),i.commands.formula={execCommand:function(t,n){var o=e();o?o.contentWindow.formula.insertLatex(n):(i.execCommand("inserthtml",'<span class="mathquill-embedded-latex">'+n+"</span>"),m.ie&&m.ie9below&&setTimeout(function(){var e=i.selection.getRange(),t=e.startContainer;1!=t.nodeType||t.childNodes[e.startOffset]||(e.insertNode(i.document.createTextNode(" ")),e.setCursor())},100))},queryCommandState:function(e){return 0},queryCommandValue:function(t){return(t=e())&&t.contentWindow.formula.getLatex()}}},function(e){function t(t,n,i){return t.prototype=e.extend2(e.extend({},n),(UM.ui[i]||o).prototype,!0),t.prototype.supper=(UM.ui[i]||o).prototype,UM.ui[i]&&UM.ui[i].prototype.defaultOpt&&(t.prototype.defaultOpt=e.extend({},UM.ui[i].prototype.defaultOpt,t.prototype.defaultOpt||{})),t}function n(t,n){e[r+n]=t,e.fn[r+n]=function(n){var i,o=Array.prototype.slice.call(arguments,1);return this.each(function(r,a){var s=e(a),l=s.edui();if(l||(t(n&&e.isPlainObject(n)?n:{},s),s.edui(l)),"string"==e.type(n))if("this"==n)i=l;else{if(i=l[n].apply(l,o),i!==l&&void 0!==i)return!1;i=null}}),null!==i?i:this}}e.parseTmpl=function(e,t){var n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/<%=([\s\S]+?)%>/g,function(e,t){return"',"+t.replace(/\\'/g,"'")+",'"}).replace(/<%([\s\S]+?)%>/g,function(e,t){return"');"+t.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",n=new Function("obj",n);return t?n(t):n},e.extend2=function(t,n){for(var i=arguments,o="boolean"==e.type(i[i.length-1])&&i[i.length-1],r="boolean"==e.type(i[i.length-1])?i.length-1:i.length,a=1;a<r;a++){var s,l=i[a];for(s in l)o&&t.hasOwnProperty(s)||(t[s]=l[s])}return t},e.IE6=!!window.ActiveXObject&&6==parseFloat(navigator.userAgent.match(/msie (\d+)/i)[1]);var i=[],o=function(){},r="edui";o.prototype={on:function(t,n){return this.root().on(t,e.proxy(n,this)),this},off:function(t,n){return this.root().off(t,e.proxy(n,this)),this},trigger:function(e,t){return!1!==this.root().trigger(e,t)&&this},root:function(e){return this._$el||(this._$el=e)},destroy:function(){},data:function(e,t){return void 0!==t?(this.root().data(r+e,t),this):this.root().data(r+e)},register:function(t,n,o){i.push({evtname:t,$els:e.isArray(n)?n:[n],handler:e.proxy(o,n)})}},e.fn.edui=function(e){return e?this.data("eduiwidget",e):this.data("eduiwidget")};var a=1;UM.ui={define:function(i,o,s){var l=UM.ui[i]=t(function(t,n){var o=function(){};if(e.extend(o.prototype,l.prototype,{guid:i+a++,widgetName:i}),o=new o,"string"==e.type(t))return o.init&&o.init({}),o.root().edui(o),o.root().find("a").click(function(e){e.preventDefault()}),o.root()[r+i].apply(o.root(),arguments);n&&o.root(n),o.init&&o.init(!t||e.isPlainObject(t)?e.extend2(t||{},o.defaultOpt||{},!0):t);try{o.root().find("a").click(function(e){e.preventDefault()})}catch(s){}return o.root().edui(o)},o,s);n(l,i)}},e(function(){e(document).on("click mouseup mousedown dblclick mouseover",function(t){e.each(i,function(n,i){i.evtname==t.type&&e.each(i.$els,function(n,o){o[0]===t.target||e.contains(o[0],t.target)||i.handler(t)})})})})}(jQuery),UM.ui.define("button",{tpl:'<<%if(!texttype){%>div class="edui-btn edui-btn-<%=icon%> <%if(name){%>edui-btn-name-<%=name%><%}%>" unselectable="on" onmousedown="return false" <%}else{%>a class="edui-text-btn"<%}%><% if(title) {%> data-original-title="<%=title%>" <%};%>> <% if(icon) {%><div unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><% }; %><%if(text) {%><span unselectable="on" onmousedown="return false" class="edui-button-label"><%=text%></span><%}%><%if(caret && text){%><span class="edui-button-spacing"></span><%}%><% if(caret) {%><span unselectable="on" onmousedown="return false" class="edui-caret"></span><% };%></<%if(!texttype){%>div<%}else{%>a<%}%>>',defaultOpt:{text:"",title:"",icon:"",width:"",caret:!1,texttype:!1,click:function(){}},init:function(e){var t=this;return t.root(g(g.parseTmpl(t.tpl,e))).click(function(n){t.wrapclick(e.click,n)}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||(this.root().trigger("wrapclick"),g.proxy(e,this,t)()),this},label:function(e){return void 0===e?this.root().find(".edui-button-label").text():(this.root().find(".edui-button-label").text(e),this)},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e),this.root().hasClass("edui-disabled")&&this.root().removeClass("edui-hover"),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),g.contains(document.body,e[0])||e.appendTo(t.root()),t.on("click",function(){t.wrapclick(function(){e.edui().show()})}).register("click",t.root(),function(t){e.hide()})}}),function(){UM.ui.define("toolbar",{tpl:'<div class="edui-toolbar"  ><div class="edui-btn-toolbar" unselectable="on" onmousedown="return false"  ></div></div>',init:function(){var e=this.root(g(this.tpl));this.data("$btnToolbar",e.find(".edui-btn-toolbar"))},appendToBtnmenu:function(e){var t=this.data("$btnToolbar");e=g.isArray(e)?e:[e],g.each(e,function(e,n){t.append(n)})}})}(),UM.ui.define("menu",{show:function(e,t,n,i,o){n=n||"position",!1!==this.trigger("beforeshow")&&(this.root().css(g.extend({display:"block"},e?{top:e[n]().top+("right"==t?0:e.outerHeight())-(i||0),left:e[n]().left+("right"==t?e.outerWidth():0)-(o||0)}:{})),this.trigger("aftershow"))},hide:function(e){var t;!1!==this.trigger("beforehide")&&((t=this.root().data("parentmenu"))&&(t.data("parentmenu")||e)&&t.edui().hide(),this.root().css("display","none"),this.trigger("afterhide"))},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("wrapclick",function(e){t.show()}),t.register("click",e,function(e){t.hide()}),t.data("$mergeObj",e))}}),UM.ui.define("dropmenu",{tmpl:'<ul class="edui-dropdown-menu" aria-labelledby="dropdownMenu" ><%for(var i=0,ci;ci=data[i++];){%><%if(ci.divider){%><li class="edui-divider"></li><%}else{%><li <%if(ci.active||ci.disabled){%>class="<%= ci.active|| \'\' %> <%=ci.disabled||\'\' %>" <%}%> data-value="<%= ci.value%>"><a href="#" tabindex="-1"><em class="edui-dropmenu-checkbox"><i class="edui-icon-ok"></i></em><%= ci.label%></a></li><%}%><%}%></ul>',defaultOpt:{data:[],click:function(){}},init:function(e){var t=this,n={click:1,mouseover:1,mouseout:1};this.root(g(g.parseTmpl(this.tmpl,e))).on("click",'li[class!="edui-disabled edui-divider edui-dropdown-submenu"]',function(n){g.proxy(e.click,t,n,g(this).data("value"),g(this))()}).find("li").each(function(i,o){var r=g(this);if(!r.hasClass("edui-disabled edui-divider edui-dropdown-submenu")){var a=e.data[i];g.each(n,function(e){a[e]&&r[e](function(n){g.proxy(a[e],o)(n,a,t.root)})})}})},disabled:function(e){g("li[class!=edui-divider]",this.root()).each(function(){var t=g(this);!0===e?t.addClass("edui-disabled"):g.isFunction(e)?t.toggleClass("edui-disabled",e(li)):t.removeClass("edui-disabled")})},val:function(e){var t;if(g('li[class!="edui-divider edui-disabled edui-dropdown-submenu"]',this.root()).each(function(){var n=g(this);if(void 0===e){if(n.find("em.edui-dropmenu-checked").length)return t=n.data("value"),!1}else n.find("em").toggleClass("edui-dropmenu-checked",n.data("value")==e)}),void 0===e)return t},addSubmenu:function(e,t,n){n=n||0;var i=g("li[class!=edui-divider]",this.root());e=g('<li class="edui-dropdown-submenu"><a tabindex="-1" href="#">'+e+"</a></li>").append(t),0<=n&&n<i.length?e.insertBefore(i[n]):0>n?e.insertBefore(i[0]):n>=i.length&&e.appendTo(i)}},"menu"),UM.ui.define("splitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{text:"",title:"",click:function(){}},init:function(e){var t=this;return t.root(g(g.parseTmpl(t.tpl,e))),t.root().find(".edui-btn:first").click(function(n){t.disabled()||g.proxy(e.click,t)()}),t.root().find(".edui-dropdown-toggle").click(function(){t.disabled()||t.trigger("arrowclick")}),t.root().hover(function(){t.root().hasClass("edui-disabled")||t.root().toggleClass("edui-hover")}),t},wrapclick:function(e,t){return this.disabled()||g.proxy(e,this,t)(),this},disabled:function(e){return void 0===e?this.root().hasClass("edui-disabled"):(this.root().toggleClass("edui-disabled",e).find(".edui-btn").toggleClass("edui-disabled",e),this)},active:function(e){return void 0===e?this.root().hasClass("edui-active"):(this.root().toggleClass("edui-active",e).find(".edui-btn:first").toggleClass("edui-active",e),this)},mergeWith:function(e){var t=this;t.data("$mergeObj",e),e.edui().data("$mergeObj",t.root()),g.contains(document.body,e[0])||e.appendTo(t.root()),t.root().delegate(".edui-dropdown-toggle","click",function(){t.wrapclick(function(){e.edui().show()})}),t.register("click",t.root().find(".edui-dropdown-toggle"),function(t){e.hide()})}}),UM.ui.define("colorsplitbutton",{tpl:'<div class="edui-splitbutton <%if (name){%>edui-splitbutton-<%= name %><%}%>"  unselectable="on" <%if(title){%>data-original-title="<%=title%>"<%}%>><div class="edui-btn"  unselectable="on" ><%if(icon){%><div  unselectable="on" class="edui-icon-<%=icon%> edui-icon"></div><%}%><div class="edui-splitbutton-color-label" <%if (color) {%>style="background: <%=color%>"<%}%>></div><%if(text){%><%=text%><%}%></div><div  unselectable="on" class="edui-btn edui-dropdown-toggle" ><div  unselectable="on" class="edui-caret"></div></div></div>',defaultOpt:{color:""},init:function(e){this.supper.init.call(this,e)},colorLabel:function(){return this.root().find(".edui-splitbutton-color-label")}},"splitbutton"),UM.ui.define("popup",{tpl:'<div class="edui-dropdown-menu edui-popup"<%if(!<%=stopprop%>){%>onmousedown="return false"<%}%>><div class="edui-popup-body" unselectable="on" onmousedown="return false"><%=subtpl%></div><div class="edui-popup-caret"></div></div>',defaultOpt:{stopprop:!1,subtpl:"",width:"",height:""},init:function(e){return this.root(g(g.parseTmpl(this.tpl,e))),this},mergeTpl:function(e){return g.parseTmpl(this.tpl,{subtpl:e})},show:function(e,t){t||(t={});var n=t.fnname||"position";!1!==this.trigger("beforeshow")&&(this.root().css(g.extend({display:"block"},e?{top:e[n]().top+("right"==t.dir?0:e.outerHeight())-(t.offsetTop||0),left:e[n]().left+("right"==t.dir?e.outerWidth():0)-(t.offsetLeft||0),position:"absolute"}:{})),this.root().find(".edui-popup-caret").css({top:t.caretTop||0,left:t.caretLeft||0,position:"absolute"}).addClass(t.caretDir||"up"),this.trigger("aftershow"))},hide:function(){this.root().css("display","none"),this.trigger("afterhide")},attachTo:function(e,t){var n=this;e.data("$mergeObj")||(e.data("$mergeObj",n.root()),e.on("wrapclick",function(i){n.show(e,t)}),n.register("click",e,function(e){n.hide()}),n.data("$mergeObj",e))},getBodyContainer:function(){return this.root().find(".edui-popup-body")}}),UM.ui.define("scale",{tpl:'<div class="edui-scale" unselectable="on"><span class="edui-scale-hand0"></span><span class="edui-scale-hand1"></span><span class="edui-scale-hand2"></span><span class="edui-scale-hand3"></span><span class="edui-scale-hand4"></span><span class="edui-scale-hand5"></span><span class="edui-scale-hand6"></span><span class="edui-scale-hand7"></span></div>',defaultOpt:{$doc:g(document),$wrap:g(document)},init:function(e){return e.$doc&&(this.defaultOpt.$doc=e.$doc),e.$wrap&&(this.defaultOpt.$wrap=e.$wrap),this.root(g(g.parseTmpl(this.tpl,e))),this.initStyle(),this.startPos=this.prePos={x:0,y:0},this.dragId=-1,this},initStyle:function(){n.cssRule("edui-style-scale",".edui-scale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;}.edui-scale span{position:absolute;left:0;top:0;width:7px;height:7px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}.edui-scale .edui-scale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}.edui-scale .edui-scale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}.edui-scale .edui-scale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}.edui-scale .edui-scale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},_eventHandler:function(e){var t=this.defaultOpt.$doc;switch(e.type){case"mousedown":var n=e.target||e.srcElement;-1!=n.className.indexOf("edui-scale-hand")&&(this.dragId=n.className.slice(-1),this.startPos.x=this.prePos.x=e.clientX,this.startPos.y=this.prePos.y=e.clientY,t.bind("mousemove",g.proxy(this._eventHandler,this)));break;case"mousemove":-1!=this.dragId&&(this.updateContainerStyle(this.dragId,{x:e.clientX-this.prePos.x,y:e.clientY-this.prePos.y}),this.prePos.x=e.clientX,this.prePos.y=e.clientY,this.updateTargetElement());break;case"mouseup":-1!=this.dragId&&(this.dragId=-1,this.updateTargetElement(),this.data("$scaleTarget").parent()&&this.attachTo(this.data("$scaleTarget"))),t.unbind("mousemove",g.proxy(this._eventHandler,this))}},updateTargetElement:function(){var e=this.root(),t=this.data("$scaleTarget");t.css({width:e.width(),height:e.height()}),this.attachTo(t)},updateContainerStyle:function(e,t){var n,i=this.root(),o=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];0!=o[e][0]&&(n=parseInt(i.offset().left)+t.x,i.css("left",this._validScaledProp("left",n))),0!=o[e][1]&&(n=parseInt(i.offset().top)+t.y,i.css("top",this._validScaledProp("top",n))),0!=o[e][2]&&(n=i.width()+o[e][2]*t.x,i.css("width",this._validScaledProp("width",n))),0!=o[e][3]&&(n=i.height()+o[e][3]*t.y,i.css("height",this._validScaledProp("height",n)))},_validScaledProp:function(e,t){var n=this.root(),i=this.defaultOpt.$doc,o=function(e,n,i){return e+n>i?i-n:t};switch(t=isNaN(t)?0:t,e){case"left":return 0>t?0:o(t,n.width(),i.width());case"top":return 0>t?0:o(t,n.height(),i.height());case"width":return 0>=t?1:o(t,n.offset().left,i.width());case"height":return 0>=t?1:o(t,n.offset().top,i.height())}},show:function(e){e&&this.attachTo(e),this.root().bind("mousedown",g.proxy(this._eventHandler,this)),this.defaultOpt.$doc.bind("mouseup",g.proxy(this._eventHandler,this)),this.root().show(),this.trigger("aftershow")},hide:function(){this.root().unbind("mousedown",g.proxy(this._eventHandler,this)),this.defaultOpt.$doc.unbind("mouseup",g.proxy(this._eventHandler,this)),this.root().hide(),this.trigger("afterhide")},attachTo:function(e){var t=e.offset(),n=this.root(),i=this.defaultOpt.$wrap,o=i.offset();this.data("$scaleTarget",e),this.root().css({position:"absolute",width:e.width(),height:e.height(),left:t.left-o.left-parseInt(i.css("border-left-width"))-parseInt(n.css("border-left-width")),top:t.top-o.top-parseInt(i.css("border-top-width"))-parseInt(n.css("border-top-width"))})},getScaleTarget:function(){return this.data("$scaleTarget")[0]}}),UM.ui.define("colorpicker",{tpl:function(e){for(var t="ffffff 000000 eeece1 1f497d 4f81bd c0504d 9bbb59 8064a2 4bacc6 f79646 f2f2f2 7f7f7f ddd9c3 c6d9f0 dbe5f1 f2dcdb ebf1dd e5e0ec dbeef3 fdeada d8d8d8 595959 c4bd97 8db3e2 b8cce4 e5b9b7 d7e3bc ccc1d9 b7dde8 fbd5b5 bfbfbf 3f3f3f 938953 548dd4 95b3d7 d99694 c3d69b b2a2c7 92cddc fac08f a5a5a5 262626 494429 17365d 366092 953734 76923c 5f497a 31859b e36c09 7f7f7f 0c0c0c 1d1b10 0f243e 244061 632423 4f6128 3f3151 205867 974806 c00000 ff0000 ffc000 ffff00 92d050 00b050 00b0f0 0070c0 002060 7030a0 ".split(" "),n='<div unselectable="on" onmousedown="return false" class="edui-colorpicker<%if (name){%> edui-colorpicker-<%=name%><%}%>" ><table unselectable="on" onmousedown="return false"><tr><td colspan="10">'+e.lang_themeColor+'</td> </tr><tr class="edui-colorpicker-firstrow" >',i=0;i<t.length;i++)i&&0===i%10&&(n+="</tr>"+(60==i?'<tr><td colspan="10">'+e.lang_standardColor+"</td></tr>":"")+"<tr"+(60==i?' class="edui-colorpicker-firstrow"':"")+">"),n+=70>i?'<td><a unselectable="on" onmousedown="return false" title="'+t[i]+'" class="edui-colorpicker-colorcell" data-color="#'+t[i]+'" style="background-color:#'+t[i]+";border:solid #ccc;"+(10>i||60<=i?"border-width:1px;":10<=i&&20>i?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':"";return n+"</tr></table></div>"},init:function(e){var t=this;t.root(g(g.parseTmpl(t.supper.mergeTpl(t.tpl(e)),e))),t.root().on("click",function(e){t.trigger("pickcolor",g(e.target).data("color"))})}},"popup"),function(){UM.ui.define("combobox",function(){return{tpl:'<ul class="dropdown-menu edui-combobox-menu<%if (comboboxName!==\'\') {%> edui-combobox-<%=comboboxName%><%}%>" unselectable="on" onmousedown="return false" role="menu" aria-labelledby="dropdownMenu"><%if(autoRecord) {%><%for( var i=0, len = recordStack.length; i<len; i++ ) {%><%var index = recordStack[i];%><li class="<%=itemClassName%><%if( selected == index ) {%> edui-combobox-checked<%}%>" data-item-index="<%=index%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ index ]%>" unselectable="on" onmousedown="return false"><%=items[index]%></label></li><%}%><%if( i ) {%><li class="edui-combobox-item-separator"></li><%}%><%}%><%for( var i=0, label; label = items[i]; i++ ) {%><li class="<%=itemClassName%><%if( selected == i ) {%> edui-combobox-checked<%}%> edui-combobox-item-<%=i%>" data-item-index="<%=i%>" unselectable="on" onmousedown="return false"><span class="edui-combobox-icon" unselectable="on" onmousedown="return false"></span><label class="<%=labelClassName%>" style="<%=itemStyles[ i ]%>" unselectable="on" onmousedown="return false"><%=label%></label></li><%}%></ul>',defaultOpt:{recordStack:[],items:[],value:[],comboboxName:"",selected:"",autoRecord:!0,recordCount:5},init:function(e){g.extend(this._optionAdaptation(e),this._createItemMapping(e.recordStack,e.items),{itemClassName:"edui-combobox-item",iconClass:"edui-combobox-checked-icon",labelClassName:"edui-combobox-item-label"}),this._transStack(e),this.root(g(g.parseTmpl(this.tpl,e))),this.data("options",e).initEvent()},initEvent:function(){this.initSelectItem(),this.initItemActive()},initSelectItem:function(){var e=this;e.root().delegate(".edui-combobox-item","click",function(){var t=g(this),n=t.attr("data-item-index");return e.trigger("comboboxselect",{index:n,label:t.find(".edui-combobox-item-label").text(),value:e.data("options").value[n]}).select(n),e.hide(),!1})},initItemActive:function(){var e={mouseenter:"addClass",mouseleave:"removeClass"};g.IE6&&this.root().delegate(".edui-combobox-item","mouseenter mouseleave",function(t){g(this)[e[t.type]]("edui-combobox-item-hover")}).one("afterhide",function(){})},select:function(e){var t=this.data("options").itemCount,n=this.data("options").autowidthitem;return n&&!n.length&&(n=this.data("options").items),0==t?null:(0>e?e=t+e%t:e>=t&&(e=t-1),this.trigger("changebefore",n[e]),this._update(e),this.trigger("changeafter",n[e]),null)},selectItemByLabel:function(e){var t=this.data("options").itemMapping,n=this,i=null;!g.isArray(e)&&(e=[e]),g.each(e,function(e,o){if(i=t[o],void 0!==i)return n.select(i),!1})},_transStack:function(e){var t=[],n=-1,i=-1;g.each(e.recordStack,function(o,r){n=e.itemMapping[r],g.isNumeric(n)&&(t.push(n),r==e.selected&&(i=n))}),e.recordStack=t,e.selected=i,t=null},_optionAdaptation:function(e){if(!("itemStyles"in e)){e.itemStyles=[];for(var t=0,n=e.items.length;t<n;t++)e.itemStyles.push("")}return e.autowidthitem=e.autowidthitem||e.items,e.itemCount=e.items.length,e},_createItemMapping:function(e,t){var n={},i={recordStack:[],mapping:{}};return g.each(t,function(e,t){n[t]=e}),i.itemMapping=n,g.each(e,function(e,t){void 0!==n[t]&&(i.recordStack.push(n[t]),i.mapping[t]=n[t])}),i},_update:function(e){var t=this.data("options"),n=[],i=null;g.each(t.recordStack,function(t,i){i!=e&&n.push(i)}),n.unshift(e),n.length>t.recordCount&&(n.length=t.recordCount),t.recordStack=n,t.selected=e,i=g(g.parseTmpl(this.tpl,t)),this.root().html(i.html()),n=i=null}}}(),"menu")}(),function(){UM.ui.define("buttoncombobox",function(){return{defaultOpt:{label:"",title:""},init:function(e){var t=this,n=g.eduibutton({caret:!0,name:e.comboboxName,title:e.title,text:e.label,click:function(){t.show(this.root())}});t.supper.init.call(t,e),t.on("changebefore",function(e,t){n.eduibutton("label",t)}),t.data("button",n),t.attachTo(n)},button:function(){return this.data("button")}}}(),"combobox")}(),UM.ui.define("modal",{tpl:'<div class="edui-modal" tabindex="-1" ><div class="edui-modal-header"><div class="edui-close" data-hide="modal"></div><h3 class="edui-title"><%=title%></h3></div><div class="edui-modal-body"  style="<%if(width){%>width:<%=width%>px;<%}%><%if(height){%>height:<%=height%>px;<%}%>"> </div><% if(cancellabel || oklabel) {%><div class="edui-modal-footer"><div class="edui-modal-tip"></div><%if(oklabel){%><div class="edui-btn edui-btn-primary" data-ok="modal"><%=oklabel%></div><%}%><%if(cancellabel){%><div class="edui-btn" data-hide="modal"><%=cancellabel%></div><%}%></div><%}%></div>',defaultOpt:{title:"",cancellabel:"",oklabel:"",width:"",height:"",backdrop:!0,keyboard:!0},init:function(e){this.root(g(g.parseTmpl(this.tpl,e||{}))),this.data("options",e),e.okFn&&this.on("ok",g.proxy(e.okFn,this)),e.cancelFn&&this.on("beforehide",g.proxy(e.cancelFn,this)),this.root().delegate('[data-hide="modal"]',"click",g.proxy(this.hide,this)).delegate('[data-ok="modal"]',"click",g.proxy(this.ok,this)),g('[data-hide="modal"],[data-ok="modal"]',this.root()).hover(function(){g(this).toggleClass("edui-hover")})},toggle:function(){return this[this.data("isShown")?"hide":"show"]()},show:function(){var e=this;e.trigger("beforeshow"),e.data("isShown")||(e.data("isShown",!0),e.escape(),e.backdrop(function(){e.autoCenter(),e.root().show().focus().trigger("aftershow")}))},showTip:function(e){g(".edui-modal-tip",this.root()).html(e).fadeIn()},hideTip:function(e){g(".edui-modal-tip",this.root()).fadeOut(function(){g(this).html("")})},autoCenter:function(){!g.IE6&&this.root().css("margin-left",-(this.root().width()/2))},hide:function(){this.trigger("beforehide"),this.data("isShown")&&(this.data("isShown",!1),this.escape(),this.hideModal())},escape:function(){var e=this;e.data("isShown")&&e.data("options").keyboard?e.root().on("keyup",function(t){27==t.which&&e.hide()}):e.data("isShown")||e.root().off("keyup")},hideModal:function(){var e=this;e.root().hide(),e.backdrop(function(){e.removeBackdrop(),e.trigger("afterhide")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(e){this.data("isShown")&&this.data("options").backdrop&&(this.$backdrop=g('<div class="edui-modal-backdrop" />').click("static"==this.data("options").backdrop?g.proxy(this.root()[0].focus,this.root()[0]):g.proxy(this.hide,this))),this.trigger("afterbackdrop"),e&&e()},attachTo:function(e){var t=this;e.data("$mergeObj")||(e.data("$mergeObj",t.root()),e.on("click",function(){t.toggle(e)}),t.data("$mergeObj",e))},ok:function(){this.trigger("beforeok"),!1!==this.trigger("ok",this)&&this.hide()},getBodyContainer:function(){return this.root().find(".edui-modal-body")}}),UM.ui.define("tooltip",{tpl:'<div class="edui-tooltip" unselectable="on" onmousedown="return false"><div class="edui-tooltip-arrow" unselectable="on" onmousedown="return false"></div><div class="edui-tooltip-inner" unselectable="on" onmousedown="return false"></div></div>',init:function(e){this.root(g(g.parseTmpl(this.tpl,e||{})))},content:function(e){e=g(e.currentTarget).attr("data-original-title"),this.root().find(".edui-tooltip-inner").text(e)},position:function(e){e=g(e.currentTarget),this.root().css(g.extend({display:"block"},e?{top:e.outerHeight(),left:(e.outerWidth()-this.root().outerWidth())/2}:{}))},show:function(e){g(e.currentTarget).hasClass("edui-disabled")||(this.content(e),this.root().appendTo(g(e.currentTarget)),this.position(e),this.root().css("display","block"))},hide:function(){this.root().css("display","none")},attachTo:function(e){function t(e){var t=this;g.contains(document.body,t.root()[0])||t.root().appendTo(e),t.data("tooltip",t.root()),e.each(function(){g(this).attr("data-original-title")&&g(this).on("mouseenter",g.proxy(t.show,t)).on("mouseleave click",g.proxy(t.hide,t))})}var n=this;"undefined"===g.type(e)?g("[data-original-title]").each(function(e,i){t.call(n,g(i))}):e.data("tooltip")||t.call(n,e)}}),UM.ui.define("tab",{init:function(e){var t=this,n=e.selector;g.type(n)&&(t.root(g(n,e.context)),t.data("context",e.context),g(n,t.data("context")).on("click",function(e){t.show(e)}))},show:function(e){var t,n,i=this,o=g(e.target),r=o.closest("ul");t=(t=o.attr("data-context"))&&t.replace(/.*(?=#[^\s]*$)/,""),e=o.parent("li"),e.length&&!e.hasClass("edui-active")&&(n=r.find(".edui-active:last a")[0],e=g.Event("beforeshow",{target:o[0],relatedTarget:n}),i.trigger(e),e.isDefaultPrevented()||(t=g(t,i.data("context")),i.activate(o.parent("li"),r),i.activate(t,t.parent(),function(){i.trigger({type:"aftershow",relatedTarget:n})})))},activate:function(e,t,n){return void 0===e?g(".edui-tab-item.edui-active",this.root()).index():(t.find("> .edui-active").removeClass("edui-active"),e.addClass("edui-active"),void(n&&n()))}}),UM.ui.define("separator",{tpl:'<div class="edui-separator" unselectable="on" onmousedown="return false" ></div>',init:function(e){return this.root(g(g.parseTmpl(this.tpl,e))),this}}),function(){var e={},t={},i=[],o={},r={},a={},s=null;n.extend(UM,{defaultWidth:500,defaultHeight:500,registerUI:function(t,i){n.each(t.split(/\s+/),function(t){e[t]=i})},setEditor:function(e){!t[e.id]&&(t[e.id]=e)},registerWidget:function(e,t,n){o[e]=g.extend2(t,{$root:"",_preventDefault:!1,root:function(e){return this.$root||(this.$root=e)},preventDefault:function(){this._preventDefault=!0},clear:!1}),n&&(r[e]=n)},getWidgetData:function(e){return o[e]},setWidgetBody:function(e,t,i){i._widgetData||n.extend(i,{_widgetData:{},getWidgetData:function(e){return this._widgetData[e]},getWidgetCallback:function(e){var n=this;return function(){return r[e].apply(n,[n,t].concat(Array.prototype.slice.call(arguments,0)))}}});var a=o[e];return a?(a=i._widgetData[e],a||(a=o[e],a=i._widgetData[e]="function"==g.type(a)?a:n.clone(a)),a.root(t.edui().getBodyContainer()),a.initContent(i,t),a._preventDefault||a.initEvent(i,t),void(a.width&&t.width(a.width))):null},setActiveWidget:function(e){},getEditor:function(e,n){var i=t[e]||(t[e]=this.createEditor(e,n));return s=s?Math.max(i.getOpt("zIndex"),s):i.getOpt("zIndex"),i},setTopEditor:function(e){g.each(t,function(t,n){e==n?e.$container&&e.$container.css("zIndex",s+1):n.$container&&n.$container.css("zIndex",n.getOpt("zIndex"))})},clearCache:function(e){t[e]&&delete t[e]},delEditor:function(e){var n;(n=t[e])&&n.destroy()},ready:function(e){i.push(e)},createEditor:function(e,t){function n(){var t=this.createUI("#"+e,o);o.key=e,o.ready(function(){g.each(i,function(e,t){g.proxy(t,o)()})});var n=o.options;n.minFrameWidth=n.initialFrameWidth?n.initialFrameWidth:n.initialFrameWidth=o.$body.width()||UM.defaultWidth,t.css({width:n.initialFrameWidth,zIndex:o.getOpt("zIndex")}),UM.browser.ie&&6===UM.browser.version&&document.execCommand("BackgroundImageCache",!1,!0),o.render(e),g.eduitooltip&&g.eduitooltip("attachTo",g("[data-original-title]",t)).css("z-index",o.getOpt("zIndex")+1),t.find("a").click(function(e){e.preventDefault()}),o.fireEvent("afteruiready")}var o=new UM.Editor(t);return o.langIsReady?g.proxy(n,this)():o.addListener("langReady",g.proxy(n,this)),o},createUI:function(t,n){var i=g(t),o=g('<div class="edui-container"><div class="edui-editor-body"></div></div>').insertBefore(i);return n.$container=o,n.container=o[0],n.$body=i,m.ie&&m.ie9above&&g('<span style="padding:0;margin:0;height:0;width:0"></span>').insertAfter(o),g.each(e,function(e,t){var i=t.call(n,e);i&&(a[e]=i)}),o.find(".edui-editor-body").append(i).before(this.createToolbar(n.options,n)),o.find(".edui-toolbar").append(g('<div class="edui-dialog-container"></div>')),o},createToolbar:function(e,t){var n=g.eduitoolbar(),i=n.edui();if(e.toolbar&&e.toolbar.length){var o=[];g.each(e.toolbar,function(e,t){g.each(t.split(/\s+/),function(e,t){if("|"==t)g.eduiseparator&&o.push(g.eduiseparator());else{var n=a[t];"fullscreen"==t?n&&o.unshift(n):n&&o.push(n)}}),o.length&&i.appendToBtnmenu(o)})}else n.find(".edui-btn-toolbar").remove();return n}})}(),UM.registerUI("bold italic redo undo underline strikethrough superscript subscript insertorderedlist insertunorderedlist cleardoc selectall link unlink print preview justifyleft justifycenter justifyright justifyfull removeformat horizontal drafts",function(e){var t=this,n=g.eduibutton({icon:e,click:function(){t.execCommand(e)},title:this.getLang("labelMap")[e]||""
});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),n}),function(){function e(e){var t=this;if(!e)throw Error("invalid params, notfound editor");t.editor=e,a[e.uid]=this,e.addListener("destroy",function(){delete a[e.uid],t.editor=null})}var t={},n="width height position top left margin padding overflowX overflowY".split(" "),i={},o={},r={},a={};UM.registerUI("fullscreen",function(t){var n=this,i=g.eduibutton({icon:"fullscreen",title:n.options.labelMap&&n.options.labelMap[t]||n.getLang("labelMap."+t),click:function(){n.execCommand(t),UM.setTopEditor(n)}});return n.addListener("selectionchange",function(){var e=this.queryCommandState(t);i.edui().disabled(-1==e).active(1==e)}),n.addListener("ready",function(){n.options.fullscreen&&e.getInstance(n).toggle()}),i}),UM.commands.fullscreen={execCommand:function(t){e.getInstance(this).toggle()},queryCommandState:function(e){return this._edui_fullscreen_status},notNeedUndo:1},e.prototype={toggle:function(){var e=this.editor,t=this.isFullState();e.fireEvent("beforefullscreenchange",!t),this.update(!t),t?this.revert():this.enlarge(),e.fireEvent("afterfullscreenchange",!t),"true"===e.body.contentEditable&&e.fireEvent("fullscreenchanged",!t),e.fireEvent("selectionchange")},enlarge:function(){this.saveSataus(),this.setDocumentStatus(),this.resize()},revert:function(){var e=this.editor.options,e=/%$/.test(e.initialFrameHeight)?"100%":e.initialFrameHeight-this.getStyleValue("padding-top")-this.getStyleValue("padding-bottom")-this.getStyleValue("border-width");g.IE6&&this.getEditorHolder().style.setExpression("height","this.scrollHeight <= "+e+' ? "'+e+'px" : "auto"'),this.revertContainerStatus(),this.revertContentAreaStatus(),this.revertDocumentStatus()},update:function(e){this.editor._edui_fullscreen_status=e},resize:function(){var e=null,t=e=0,n=0,i=0,o=this.editor,r=null,a=null;this.isFullState()&&(e=g(window),t=e.width(),e=e.height(),a=this.getEditorHolder(),n=parseInt(k.getComputedStyle(a,"border-width"),10)||0,n+=parseInt(k.getComputedStyle(o.container,"border-width"),10)||0,i+=parseInt(k.getComputedStyle(a,"padding-left"),10)+parseInt(k.getComputedStyle(a,"padding-right"),10)||0,g.IE6&&a.style.setExpression("height",null),r=this.getBound(),g(o.container).css({width:t+"px",height:e+"px",position:g.IE6?"absolute":"fixed",top:r.top,left:r.left,margin:0,padding:0,overflowX:"hidden",overflowY:"hidden"}),g(a).css({width:t-2*n-i+"px",height:e-2*n-(o.options.withoutToolbar?0:g(".edui-toolbar",o.container).outerHeight())-g(".edui-bottombar",o.container).outerHeight()+"px",overflowX:"hidden",overflowY:"auto"}))},saveSataus:function(){for(var e=this.editor.container.style,i=null,o={},r=0,a=n.length;r<a;r++)i=n[r],o[i]=e[i];t[this.editor.uid]=o,this.saveContentAreaStatus(),this.saveDocumentStatus()},saveContentAreaStatus:function(){var e=g(this.getEditorHolder());i[this.editor.uid]={width:e.css("width"),overflowX:e.css("overflowX"),overflowY:e.css("overflowY"),height:e.css("height")}},saveDocumentStatus:function(){var e=g(this.getEditorDocumentBody());o[this.editor.uid]={overflowX:e.css("overflowX"),overflowY:e.css("overflowY")},r[this.editor.uid]={overflowX:g(this.getEditorDocumentElement()).css("overflowX"),overflowY:g(this.getEditorDocumentElement()).css("overflowY")}},revertContainerStatus:function(){g(this.editor.container).css(this.getEditorStatus())},revertContentAreaStatus:function(){var e=this.getEditorHolder(),t=this.getContentAreaStatus();this.supportMin()&&(delete t.height,e.style.height=null),g(e).css(t)},revertDocumentStatus:function(){var e=this.getDocumentStatus();g(this.getEditorDocumentBody()).css("overflowX",e.body.overflowX),g(this.getEditorDocumentElement()).css("overflowY",e.html.overflowY)},setDocumentStatus:function(){g(this.getEditorDocumentBody()).css({overflowX:"hidden",overflowY:"hidden"}),g(this.getEditorDocumentElement()).css({overflowX:"hidden",overflowY:"hidden"})},isFullState:function(){return!!this.editor._edui_fullscreen_status},getEditorStatus:function(){return t[this.editor.uid]},getContentAreaStatus:function(){return i[this.editor.uid]},getEditorDocumentElement:function(){return this.editor.container.ownerDocument.documentElement},getEditorDocumentBody:function(){return this.editor.container.ownerDocument.body},getEditorHolder:function(){return this.editor.body},getDocumentStatus:function(){return{body:o[this.editor.uid],html:r[this.editor.uid]}},supportMin:function(){var e=null;return this._support||(e=document.createElement("div"),this._support="minWidth"in e.style),this._support},getBound:function(){var e={html:!0,body:!0},t={top:0,left:0},n=null;return g.IE6?((n=this.editor.container.offsetParent)&&!e[n.nodeName.toLowerCase()]&&(e=n.getBoundingClientRect(),t.top=-e.top,t.left=-e.left),t):t},getStyleValue:function(e){return parseInt(k.getComputedStyle(this.getEditorHolder(),e))}},g.extend(e,{listen:function(){var t=null;e._hasFullscreenListener||(e._hasFullscreenListener=!0,g(window).on("resize",function(){null!==t&&(window.clearTimeout(t),t=null),t=window.setTimeout(function(){for(var e in a)a[e].resize();t=null},50)}))},getInstance:function(t){return a[t.uid]||new e(t),a[t.uid]}}),e.listen()}(),UM.registerUI("link image video map formula",function(e){var t,i,o=this,r={title:o.options.labelMap&&o.options.labelMap[e]||o.getLang("labelMap."+e),url:o.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js"},a=g.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return n.loadFile(document,{src:r.url,tag:"script",type:"text/javascript",defer:"defer"},function(){var n=UM.getWidgetData(e);if(n){if(n.buttons){var s=n.buttons.ok;s&&(r.oklabel=s.label||o.getLang("ok"),s.exec&&(r.okFn=function(){return g.proxy(s.exec,null,o,i)()}));var l=n.buttons.cancel;l&&(r.cancellabel=l.label||o.getLang("cancel"),l.exec&&(r.cancelFn=function(){return g.proxy(l.exec,null,o,i)()}))}n.width&&(r.width=n.width),n.height&&(r.height=n.height),i=g.eduimodal(r),i.attr("id","edui-dialog-"+e).addClass("edui-dialog-"+e).find(".edui-modal-body").addClass("edui-dialog-"+e+"-body"),i.edui().on("beforehide",function(){var e=o.selection.getRange();e.equals(t)&&e.select()}).on("beforeshow",function(){var n=this.root(),r=null,a=null;t=o.selection.getRange(),n.parent()[0]||o.$container.find(".edui-dialog-container").append(n),g.IE6&&(r={width:g(window).width(),height:g(window).height()},a=n.parents(".edui-toolbar")[0].getBoundingClientRect(),n.css({position:"absolute",margin:0,left:(r.width-n.width())/2-a.left,top:100-a.top})),UM.setWidgetBody(e,i,o),UM.setTopEditor(o)}).on("afterbackdrop",function(){this.$backdrop.css("zIndex",o.getOpt("zIndex")+1).appendTo(o.$container.find(".edui-dialog-container")),i.css("zIndex",o.getOpt("zIndex")+2)}).on("beforeok",function(){try{t.select()}catch(e){}}).attachTo(a)}}),o.addListener("selectionchange",function(){var t=this.queryCommandState(e);a.edui().disabled(-1==t).active(1==t)}),a}),UM.registerUI("emotion formula",function(e){var t=this,i=t.options.UMEDITOR_HOME_URL+"dialogs/"+e+"/"+e+".js",o=g.eduibutton({icon:e,title:this.getLang("labelMap")[e]||""});return n.loadFile(document,{src:i,tag:"script",type:"text/javascript",defer:"defer"},function(){var n={url:i},r=UM.getWidgetData(e);r.width&&(n.width=r.width),r.height&&(n.height=r.height),g.eduipopup(n).css("zIndex",t.options.zIndex+1).addClass("edui-popup-"+e).edui().on("beforeshow",function(){var n=this.root();n.parent().length||t.$container.find(".edui-dialog-container").append(n),UM.setWidgetBody(e,n,t),UM.setTopEditor(t)}).attachTo(o,{offsetTop:-5,offsetLeft:10,caretLeft:11,caretTop:-8}),t.addListener("selectionchange",function(){var t=this.queryCommandState(e);o.edui().disabled(-1==t).active(1==t)})}),o}),UM.registerUI("imagescale",function(){var e,t=this;t.setOpt("imageScaleEnabled",!0),m.webkit&&t.getOpt("imageScaleEnabled")&&(t.addListener("click",function(n,i){var o=t.selection.getRange().getClosedNode(),r=i.target;if(o&&"IMG"==o.tagName&&r==o){if(!e){e=g.eduiscale({$wrap:t.$container}).css("zIndex",t.options.zIndex),t.$container.append(e);var a,s=function(){e.edui().hide()},l=function(e){var t=e.target||e.srcElement;t&&-1==t.className.indexOf("edui-scale")&&s(e)};e.edui().on("aftershow",function(){g(document).bind("keydown",s),g(document).bind("mousedown",l),t.selection.getNative().removeAllRanges()}).on("afterhide",function(){g(document).unbind("keydown",s),g(document).unbind("mousedown",l);var n=e.edui().getScaleTarget();n.parentNode&&t.selection.getRange().selectNode(n).select()}).on("mousedown",function(n){t.selection.getNative().removeAllRanges(),(n=n.target||n.srcElement)&&-1==n.className.indexOf("edui-scale-hand")&&(a=setTimeout(function(){e.edui().hide()},200))}).on("mouseup",function(e){(e=e.target||e.srcElement)&&-1==e.className.indexOf("edui-scale-hand")&&clearTimeout(a)})}e.edui().show(g(o))}else e&&"none"!=e.css("display")&&e.edui().hide()}),t.addListener("click",function(e,n){"IMG"==n.target.tagName&&new B.Range(t.document,t.body).selectNode(n.target).select()}))}),UM.registerUI("autofloat",function(){var e=this,t=e.getLang();e.setOpt({autoFloatEnabled:!0,topOffset:0});var i=e.options.topOffset;!1!==e.options.autoFloatEnabled&&e.ready(function(){function o(){var e=document.body.style;e.backgroundImage='url("about:blank")',e.backgroundAttachment="fixed"}function r(){h.parentNode&&h.parentNode.removeChild(h),l.style.cssText=s}function a(){var t,n=e.container;try{t=n.getBoundingClientRect()}catch(o){t={left:0,top:0,height:0,width:0}}Math.round(t.left);var a=Math.round(t.top),s=Math.round(t.bottom-t.top);Math.round(t.right-t.left);for(var p;(p=n.ownerDocument)!==document&&(n=k.getWindow(p).frameElement);)t=n.getBoundingClientRect(),a+=t.top;n=e.options.toolbarTopOffset||0,0>a&&a+s-l.offsetHeight>n?f||(a=k.getXY(l),s=k.getComputedStyle(l,"position"),n=k.getComputedStyle(l,"left"),l.style.width=l.offsetWidth+"px",l.style.zIndex=1*e.options.zIndex+1,l.parentNode.insertBefore(h,l),c||u&&m.ie?("absolute"!=l.style.position&&(l.style.position="absolute"),l.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-d+i+"px"):"fixed"!=l.style.position&&(l.style.position="fixed",l.style.top=i+"px",("absolute"==s||"relative"==s)&&parseFloat(n)&&(l.style.left=a.x+"px"))):r()}var s,l,d,c=m.ie&&6>=m.version,u=m.quirks,h=document.createElement("div"),f=!1,p=n.defer(function(){a()},m.ie?200:100,!0);e.addListener("destroy",function(){g(window).off("scroll resize",a),e.removeListener("keydown",p)});var v;UM.ui?v=1:(alert(t.autofloatMsg),v=0),v&&(l=g(".edui-toolbar",e.container)[0],e.addListener("afteruiready",function(){setTimeout(function(){d=g(l).offset().top},100)}),s=l.style.cssText,h.style.height=l.offsetHeight+"px",c&&o(),g(window).on("scroll resize",a),e.addListener("keydown",p),e.addListener("resize",function(){r(),h.style.height=l.offsetHeight+"px",a()}),e.addListener("beforefullscreenchange",function(e,t){t&&(r(),f=t)}),e.addListener("fullscreenchanged",function(e,t){t||a(),f=t}),e.addListener("sourcemodechanged",function(e,t){setTimeout(function(){a()},0)}),e.addListener("clearDoc",function(){setTimeout(function(){a()},0)}))})}),UM.registerUI("source",function(e){var t=this;t.addListener("fullscreenchanged",function(){t.$container.find("textarea").width(t.$body.width()-10).height(t.$body.height())});var n=g.eduibutton({icon:e,click:function(){t.execCommand(e),UM.setTopEditor(t)},title:this.getLang("labelMap")[e]||""});return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);n.edui().disabled(-1==t).active(1==t)}),n}),UM.registerUI("paragraph fontfamily fontsize",function(e){function t(e,n){var i=g("<span>").html(e).css({display:"inline",position:"absolute",top:-1e7,left:-1e5}).appendTo(document.body),o=i.width();return i.remove(),50>o?e:(e=e.slice(0,n?-4:-1),e.length?t(e+"...",!0):"...")}function n(e){var n,i=[];for(n in e.items)e.value.push(n),i.push(n),e.autowidthitem.push(t(n));return e.items=i,e.autoRecord=!1,e}function i(e){for(var n=null,i=[],o=0,r=e.items.length;o<r;o++)n=e.items[o].val,i.push(n.split(/\s*,\s*/)[0]),e.itemStyles.push("font-family: "+n),e.value.push(n),e.autowidthitem.push(t(i[o]));return e.items=i,e}function o(e){var t=null,n=[];e.itemStyles=[],e.value=[];for(var i=0,o=e.items.length;i<o;i++)t=e.items[i],n.push(t),e.itemStyles.push("font-size: "+t+"px");return e.value=e.items,e.items=n,e.autoRecord=!1,e}var r=this,a=r.options.labelMap&&r.options.labelMap[e]||r.getLang("labelMap."+e),a={label:a,title:a,comboboxName:e,items:r.options[e]||[],itemStyles:[],value:[],autowidthitem:[]},s=null,l=null;if(0==a.items.length)return null;switch(e){case"paragraph":a=n(a);break;case"fontfamily":a=i(a);break;case"fontsize":a=o(a)}return s=g.eduibuttoncombobox(a).css("zIndex",r.getOpt("zIndex")+1),l=s.edui(),l.on("comboboxselect",function(t,n){r.execCommand(e,n.value)}).on("beforeshow",function(){0===s.parent().length&&s.appendTo(r.$container.find(".edui-dialog-container")),UM.setTopEditor(r)}),this.addListener("selectionchange",function(t){t=this.queryCommandState(e);var n=this.queryCommandValue(e);l.button().edui().disabled(-1==t).active(1==t),n&&(n=n.replace(/['"]/g,"").toLowerCase().split(/['|"]?\s*,\s*[\1]?/),l.selectItemByLabel(n))}),l.button().addClass("edui-combobox")}),UM.registerUI("forecolor backcolor",function(e){var t=this,n=null,i=null,o=null;return this.addListener("selectionchange",function(){var t=this.queryCommandState(e);o.edui().disabled(-1==t).active(1==t)}),o=g.eduicolorsplitbutton({icon:e,caret:!0,name:e,title:t.getLang("labelMap")[e],click:function(){t.execCommand(e,k.getComputedStyle(i[0],"background-color"))}}),i=o.edui().colorLabel(),n=g.eduicolorpicker({name:e,lang_clearColor:t.getLang("clearColor")||"",lang_themeColor:t.getLang("themeColor")||"",lang_standardColor:t.getLang("standardColor")||""}).on("pickcolor",function(n,o){window.setTimeout(function(){i.css("backgroundColor",o),t.execCommand(e,o)},0)}).on("show",function(){UM.setActiveWidget(colorPickerWidget.root())}).css("zIndex",t.getOpt("zIndex")+1),o.edui().on("arrowclick",function(){n.parent().length||t.$container.find(".edui-dialog-container").append(n),n.edui().show(o,{caretDir:"down",offsetTop:-5,offsetLeft:8,caretLeft:11,caretTop:-8}),UM.setTopEditor(t)}).register("click",o,function(){n.edui().hide()}),o})}(jQuery)}});